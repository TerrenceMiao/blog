<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Terrence Miao&#39;s Adventures</title>
  
  <subtitle>A journey of a thousand miles begins with a single step</subtitle>
  <link href="https://terrencemiao.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://terrencemiao.github.io/blog/"/>
  <updated>2024-10-17T05:45:11.179Z</updated>
  <id>https://terrencemiao.github.io/blog/</id>
  
  <author>
    <name>Terrence Miao</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Running latest MacOS Sequoia in VMware on Windows 11</title>
    <link href="https://terrencemiao.github.io/blog/2024/10/16/Running-latest-MacOS-Sequoia-in-VMWare-on-Windows-11/"/>
    <id>https://terrencemiao.github.io/blog/2024/10/16/Running-latest-MacOS-Sequoia-in-VMWare-on-Windows-11/</id>
    <published>2024-10-16T05:06:59.000Z</published>
    <updated>2024-10-17T05:45:11.179Z</updated>
    
    <content type="html"><![CDATA[<p>This is the step by step guide to install latest <code>MacOS Sequoia 15.0.1</code> in <code>VMware Workstation Pro</code> on <code>Windows 11</code>.</p><ul><li>Build a bootable MacOS ISO image</li></ul><p>Do it on a Mac. </p><p>Clone <code>gibmasOS</code> repo <em><a href="https://github.com/corpnewt/gibMacOS">https://github.com/corpnewt/gibMacOS</a></em> and run:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">$ ./gibMacOS.command</span><br><span class="line">#######################################################</span><br><span class="line">#                      gibMacOS                       #</span><br><span class="line">#######################################################</span><br><span class="line"></span><br><span class="line">Available Products:</span><br><span class="line"></span><br><span class="line">1. macOS Sequoia 15.0.1 (24A348)</span><br><span class="line">   - 072-01382 - Added 2024-10-03 21:26:40 - 14.48 GB</span><br><span class="line">2. macOS Ventura 13.7 (22H123)</span><br><span class="line">   - 062-78643 - Added 2024-09-16 17:44:05 - 12.22 GB</span><br><span class="line">3. macOS Sonoma 14.7 (23H124)</span><br><span class="line">   - 062-78824 - Added 2024-09-16 17:42:25 - 13.68 GB</span><br><span class="line">4. macOS Sequoia 15.0 (24A335)</span><br><span class="line">   - 062-78429 - Added 2024-09-16 17:30:21 - 14.48 GB</span><br><span class="line">5. macOS Monterey 12.7.6 (21H1320)</span><br><span class="line">   - 062-40406 - Added 2024-08-14 20:45:56 - 12.42 GB</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">24. macOS High Sierra 10.13.6 (17G66)</span><br><span class="line">   - 041-91758 - Added 2019-10-19 18:19:55 - 5.71 GB</span><br><span class="line">25. macOS Mojave 10.14.6 (18G103)</span><br><span class="line">   - 061-26589 - Added 2019-10-14 20:51:08 - 6.52 GB</span><br><span class="line">26. macOS Mojave 10.14.5 (18F2059)</span><br><span class="line">   - 061-26578 - Added 2019-10-14 20:38:26 - 6.52 GB</span><br><span class="line"></span><br><span class="line">M. Change Max-OS Version (Currently 12)</span><br><span class="line">C. Change Catalog (Currently publicrelease)</span><br><span class="line">I. Only Print URLs (Currently Off)</span><br><span class="line">S. Set Current Catalog to SoftwareUpdate Catalog</span><br><span class="line">L. Clear SoftwareUpdate Catalog</span><br><span class="line">R. Toggle Recovery-Only (Currently Off)</span><br><span class="line">U. Show Catalog URL</span><br><span class="line">Q. Quit</span><br><span class="line"></span><br><span class="line">Please select an option: 1</span><br><span class="line"></span><br><span class="line">Downloading InstallAssistant.pkg for 072-01382 - 15.0.1 macOS Sequoia (24A348)...</span><br><span class="line"></span><br><span class="line">1.35 GB/14.48 GB | =                    9.34% | 101.7 MB/s | 00:02:10 left</span><br><span class="line"></span><br><span class="line">Succeeded:</span><br><span class="line">  InstallAssistant.pkg</span><br><span class="line">  MajorOSInfo.pkg</span><br><span class="line">  com_apple_MobileAsset_MacSoftwareUpdate.plist</span><br><span class="line">  InstallInfo.plist</span><br><span class="line">  UpdateBrain.zip</span><br><span class="line"></span><br><span class="line">Failed:</span><br><span class="line">  None</span><br><span class="line"></span><br><span class="line">Files saved to:</span><br><span class="line">  /Users/terrence/Projects/gibMacOS/macOS Downloads/publicrelease/072-01382 - 15.0.1 macOS Sequoia (24A348)</span><br></pre></td></tr></table></figure><p>Run <code>InstallAssistant.pkg</code> from above MacOS download directory. It will be using to build ISO image.</p><p>Create a disk image with size 16GB:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ hdiutil create -o /tmp/MacOS -size 16000m -volname MacOS -layout SPUD -fs HFS+J</span><br><span class="line">created: /tmp/MacOS.dmg</span><br></pre></td></tr></table></figure><p> Mount the disk image created above:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> $ hdiutil attach /tmp/MacOS.dmg -noverify -mountpoint /Volumes/MacOSISO</span><br><span class="line">/dev/disk6          Apple_partition_scheme         </span><br><span class="line">/dev/disk6s1        Apple_partition_map            </span><br><span class="line">/dev/disk6s2        Apple_HFS                      /Volumes/MacOSISO</span><br></pre></td></tr></table></figure><p>Create ISO image from <code>Install masOS app</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo /Applications/Install\ macOS\ Sequoia.app/Contents/Resources/createinstallmedia --volume /Volumes/MacOSISO --nointeraction</span><br><span class="line">Erasing disk: 0%... 10%... 20%... 30%... 100%</span><br><span class="line">Copying essential files...</span><br><span class="line">Copying the macOS RecoveryOS...</span><br><span class="line">Making disk bootable...</span><br><span class="line">Copying to disk: 0%... 10%... 20%... 30%... 40%... 50%... 60%... 100%</span><br><span class="line">Install media now available at &quot;/Volumes/Install macOS Sequoia&quot;</span><br></pre></td></tr></table></figure><p>Unmount disk image and convert to an ISO image:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ hdiutil detach -force /Volumes/Install\ macOS\ Sequoia</span><br><span class="line">&quot;disk6&quot; ejected.</span><br><span class="line"></span><br><span class="line">$ ls -al /tmp/MacOS.dmg</span><br><span class="line">-rw-r--r--@ 1 terrence  wheel  16777216000 15 Oct 21:54 /tmp/MacOS.dmg</span><br><span class="line"></span><br><span class="line">$ hdiutil convert /tmp/MacOS.dmg -format UDTO -o /tmp/MacOS-Sequoia-15.0.1.cdr</span><br><span class="line">Reading Driver Descriptor Map (DDM : 0)…</span><br><span class="line">Reading Apple (Apple_partition_map : 1)…</span><br><span class="line">Reading  (Apple_Free : 2)…</span><br><span class="line">Reading disk image (Apple_HFS : 3)…</span><br><span class="line">........................................</span><br><span class="line">Elapsed Time: 19.139s</span><br><span class="line">Speed: 835.9MB/s</span><br><span class="line">Savings: 0.0%</span><br><span class="line">created: /tmp/MacOS-Sequoia-15.0.1.cdr</span><br><span class="line"></span><br><span class="line">$ mv /tmp/MacOS-Sequoia-15.0.1.cdr /tmp/MacOS-Sequoia-15.0.1.iso</span><br><span class="line"></span><br><span class="line">$ rm /tmp/MacOS.dmg</span><br></pre></td></tr></table></figure><ul><li>Install VMware Workstation Pro</li></ul><p>Download VMware Workstation Pro from e.g. <em><a href="https://softwareupdate.vmware.com/cds/vmw-desktop/ws/17.6.1/24319023/windows/core/VMware-workstation-17.6.1-24319023.exe.tar">https://softwareupdate.vmware.com/cds/vmw-desktop/ws/17.6.1/24319023/windows/core/VMware-workstation-17.6.1-24319023.exe.tar</a></em></p><ul><li>Patch VMware Workstation Pro</li></ul><p>Clone <code>unlocker</code> <em><a href="https://github.com/paolo-projects/unlocker">https://github.com/paolo-projects/unlocker</a></em> repo on Windows and enable <strong>Apple macOS</strong> option in <code>VMware Workstation Pro</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Projects\unlocker&gt; .\win-install.cmd</span><br><span class="line"></span><br><span class="line">Unlocker 3.0.2 for VMware Workstation</span><br><span class="line">=====================================</span><br><span class="line">(c) Dave Parsons 2011-18</span><br><span class="line"></span><br><span class="line">Set encoding parameters...</span><br><span class="line">Active code page: 850</span><br><span class="line"></span><br><span class="line">VMware is installed at: C:\Program Files (x86)\VMware\VMware Workstation\</span><br><span class="line">VMware product version: 17.6.1.24319023</span><br><span class="line"></span><br><span class="line">Stopping VMware services...</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">Starting VMware services...</span><br><span class="line"></span><br><span class="line">Finished!</span><br></pre></td></tr></table></figure><p><img src="/blog/img/VMware%20-%20Apple%20macOS.png" alt="VMware - Apple macOS" title="VMware - Apple macOS"></p><ul><li>Add <code>VMware Tools</code></li></ul><p>Copy <code>darwin.iso</code> and <code>darwinPre15.iso</code> files extracted from <code>VMware Fusion</code> e.g. _<a href="https://softwareupdate.vmware.com/cds/vmw-desktop/fusion/12.2.5/20904517/x86/core/com.vmware.fusion.zip.tar">https://softwareupdate.vmware.com/cds/vmw-desktop/fusion/12.2.5/20904517/x86/core/com.vmware.fusion.zip.tar</a> _ into <code>VMware Workstation Pro</code> directory:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Projects\unlocker\tools\darwin.iso -&gt; C:\Program Files (x86)\VMware\VMware Workstation\darwin.iso</span><br><span class="line">C:\Projects\unlocker\tools\darwinPre15.iso -&gt; C:\Program Files (x86)\VMware\VMware Workstation\darwinPre15.iso</span><br></pre></td></tr></table></figure><ul><li>Create Virtual Machine for MacOS 15 Sequoia</li></ul><p>Change and add: </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smc.version = &quot;0&quot;</span><br></pre></td></tr></table></figure><p>in <strong>MacOS Sequoia.vmx</strong> file.</p><p><img src="/blog/img/VMware%20-%20MacOS%20Sequoia.png" alt="VMware - MacOS Sequoia" title="VMware - MacOS Sequoia"></p><ul><li>Mount MacOS ISO image and install</li></ul><p><img src="/blog/img/VMware%20-%20MacOS%20Sequoia%20settings.png" alt="VMware - MacOS Sequoia settings" title="VMware - MacOS Sequoia settings"></p><p><strong>DON’T login Apple ID during the installation!</strong></p><p>Since <code>MacOS Sequoia</code> has added the ability to detect whether OS is running in Virtual Machine environment, so for now can’t login Apple ID directly in VM if the version is <code>MacOS Sequoia</code>.</p><p><img src="/blog/img/VMware%20-%20Apple%20ID.png" alt="VMware - Apple ID" title="VMware - Apple ID"></p><ul><li>Install <code>VMware Tools</code></li></ul><p>After MacOS installed and VM restarted, install <code>VMware Tools</code>. Then Display Memory in MacOS becomes 128 MB, and support Full Screen mode.</p><ul><li>Generated Apple product serial number</li></ul><p>Clone <code>GenSMBIOS</code> repo <em><a href="https://github.com/corpnewt/GenSMBIOS">https://github.com/corpnewt/GenSMBIOS</a></em> and generate serial number on Windows:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ ./GenSMBIOS.bat</span><br><span class="line">#######################################################</span><br><span class="line">#                     GenSMBIOS                       #</span><br><span class="line">#######################################################</span><br><span class="line"></span><br><span class="line">MacSerial not found!</span><br><span class="line">Remote Version v2.1.8</span><br><span class="line">Current plist: None</span><br><span class="line">Plist type:    Unknown</span><br><span class="line"></span><br><span class="line">1. Install/Update MacSerial</span><br><span class="line">2. Select config.plist</span><br><span class="line">3. Generate SMBIOS</span><br><span class="line">4. Generate UUID</span><br><span class="line">5. Generate ROM</span><br><span class="line">6. List Current SMBIOS</span><br><span class="line">7. Generate ROM With SMBIOS (Currently Enabled)</span><br><span class="line"></span><br><span class="line">Q. Quit</span><br><span class="line"></span><br><span class="line">Please select an option:  3</span><br><span class="line"></span><br><span class="line">Please type the SMBIOS to gen and the number</span><br><span class="line">of times to generate [max 20] (i.e. iMac18,3 5): MacBookPro16,4</span><br><span class="line"></span><br><span class="line">Type:         MacBookPro16,4</span><br><span class="line">Serial:       C..........T</span><br><span class="line">Board Serial: C0.............FB</span><br><span class="line">SmUUID:       A0D50403-F256-4E17-A2EC-29964D889A1D</span><br><span class="line">Apple ROM:    6..........7</span><br></pre></td></tr></table></figure><p>Copy <strong>Serial</strong>, <strong>Board Serial</strong> and <strong>Apple ROM</strong> number, apply to:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">board-id = &quot;Mac-A61BADE1FDAD7B05&quot;</span><br><span class="line">hw.model.reflectHost = &quot;FALSE&quot;</span><br><span class="line">hw.model = &quot;MacBookPro16,4&quot;</span><br><span class="line">serialNumber.reflectHost = &quot;FALSE&quot;</span><br><span class="line">serialNumber = &quot;C..........T&quot;</span><br><span class="line">smbios.reflectHost = &quot;FALSE&quot;</span><br><span class="line">efi.nvram.var.ROM.reflectHost = &quot;FALSE&quot;</span><br><span class="line">efi.nvram.var.MLB.reflectHost = &quot;FALSE&quot;</span><br><span class="line">efi.nvram.var.ROM = &quot;6..........7&quot;</span><br><span class="line">efi.nvram.var.MLB = &quot;C0.............FB&quot;</span><br></pre></td></tr></table></figure><p>then add above block into <strong>MacOS Sequoia.vmx</strong> file.</p><ul><li>Ethernet settings</li></ul><p>Based on Apple Ethernet MAC Address range <em><a href="https://hwaddress.com/company/apple-inc/">https://hwaddress.com/company/apple-inc/</a></em>, change network settings from:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ethernet0.addressType = &quot;generated&quot;</span><br><span class="line">ethernet0.generatedAddress = &quot;00:0c:29:c0:92:76&quot;</span><br><span class="line">ethernet0.generatedAddressOffset = &quot;0&quot;</span><br></pre></td></tr></table></figure><p>to:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ethernet0.addressType = &quot;static&quot;</span><br><span class="line">ethernet0.Address = &quot;00:21:E9:c0:92:76&quot;</span><br><span class="line">ethernet0.CheckMacAddress = &quot;FALSE&quot;</span><br></pre></td></tr></table></figure><p>Run MacOS in <code>VMware Player</code>:</p><p><img src="/blog/img/VMware%20-%20Player.png" alt="VMware - Player" title="VMware - Player"></p><p><img src="/blog/img/VMware%20-%20In%20Action.png" alt="VMware - In Action" title="VMware - In Action"></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li>How to Install macOS Sequoia on VMware on Windows PC, <em><a href="https://www.youtube.com/watch?v=0ohUXE0Pj_U">https://www.youtube.com/watch?v=0ohUXE0Pj_U</a></em></li><li>The Definitive Guide to Running MacOS in Proxmox, <em><a href="https://klabsdev.com/definitive-guide-to-running-macos-in-proxmox/">https://klabsdev.com/definitive-guide-to-running-macos-in-proxmox/</a></em></li><li>List of Mac BoardID, DeviceID, Model Identifiers &amp; Machine Models, <em><a href="https://mrmacintosh.com/list-of-mac-boardid-deviceid-model-identifiers-machine-models/">https://mrmacintosh.com/list-of-mac-boardid-deviceid-model-identifiers-machine-models/</a></em></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;This is the step by step guide to install latest &lt;code&gt;MacOS Sequoia 15.0.1&lt;/code&gt; in &lt;code&gt;VMware Workstation Pro&lt;/code&gt; on &lt;code&gt;Window</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>How to access Ollama runs on localhost from internet</title>
    <link href="https://terrencemiao.github.io/blog/2024/10/12/How-to-access-Ollama-runs-on-localhost-from-internet/"/>
    <id>https://terrencemiao.github.io/blog/2024/10/12/How-to-access-Ollama-runs-on-localhost-from-internet/</id>
    <published>2024-10-12T11:53:37.000Z</published>
    <updated>2024-10-12T13:23:22.608Z</updated>
    
    <content type="html"><![CDATA[<p>By default, <code>Ollama</code> is only accessible from <strong>localhost</strong>. CORS error and HTTP 403 returned if try to invoke from other hosts.</p><p>To enable <code>Ollama</code> can be visited from hosts on intranet, run:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ launchctl setenv OLLAMA_HOST &quot;0.0.0.0&quot;</span><br></pre></td></tr></table></figure><p>in MacOS. Then restart <code>Ollama</code>. Then invoke it from hosts on intranet.</p><p>To enable <code>Ollama</code> can be visited from internet, with the help from <code>ngrok</code>, run:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ ngrok http 11434</span><br><span class="line"></span><br><span class="line">ngrok                                                     (Ctrl+C to quit)</span><br><span class="line"></span><br><span class="line">Session Status  online</span><br><span class="line">Account         Terrence Miao (Plan: Free)</span><br><span class="line">Version         3.17.0</span><br><span class="line">Region          Australia (au)</span><br><span class="line">Web Interface   http://127.0.0.1:4040</span><br><span class="line">Forwarding      https://294b-2403-5802-1c44-0-341c-aae8-a501-8b73.ngrok-free.app -&gt; http://localhost:11434</span><br><span class="line"></span><br><span class="line">Connections     ttl     opn     rt1     rt5     p50     p90</span><br><span class="line">                0       0       0.00    0.00    0.00    0.00</span><br></pre></td></tr></table></figure><p>Then can visit <code>Ollama</code> on <strong>localhost</strong> from internet. <code>11434</code> is default port of <code>Ollama</code>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$ curl --location &#x27;https://294b-2403-5802-1c44-0-341c-aae8-a501-8b73.ngrok-free.app/v1/models&#x27;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;object&quot;: &quot;list&quot;,</span><br><span class="line">    &quot;data&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;id&quot;: &quot;codellama:latest&quot;,</span><br><span class="line">            &quot;object&quot;: &quot;model&quot;,</span><br><span class="line">            &quot;created&quot;: 1728736149,</span><br><span class="line">            &quot;owned_by&quot;: &quot;library&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;id&quot;: &quot;deepseek-coder-v2:latest&quot;,</span><br><span class="line">            &quot;object&quot;: &quot;model&quot;,</span><br><span class="line">            &quot;created&quot;: 1728735883,</span><br><span class="line">            &quot;owned_by&quot;: &quot;library&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;id&quot;: &quot;mxbai-embed-large:latest&quot;,</span><br><span class="line">            &quot;object&quot;: &quot;model&quot;,</span><br><span class="line">            &quot;created&quot;: 1713401203,</span><br><span class="line">            &quot;owned_by&quot;: &quot;library&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;id&quot;: &quot;nomic-embed-text:latest&quot;,</span><br><span class="line">            &quot;object&quot;: &quot;model&quot;,</span><br><span class="line">            &quot;created&quot;: 1708780687,</span><br><span class="line">            &quot;owned_by&quot;: &quot;library&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>To write some code:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">$ curl --location &#x27;https://294b-2403-5802-1c44-0-341c-aae8-a501-8b73.ngrok-free.app/v1/chat/completions&#x27; \</span><br><span class="line">--header &#x27;Content-Type: application/json&#x27; \</span><br><span class="line">--data &#x27;&#123;</span><br><span class="line">    &quot;model&quot;: &quot;deepseek-coder-v2&quot;,</span><br><span class="line">    &quot;messages&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;role&quot;: &quot;system&quot;,</span><br><span class="line">            &quot;content&quot;: &quot;You are a helpful assistant.&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;role&quot;: &quot;user&quot;,</span><br><span class="line">            &quot;content&quot;: &quot;Write a function that outputs the fibonacci sequence in TypeScript.&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;&#x27;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;: &quot;chatcmpl-174&quot;,</span><br><span class="line">  &quot;object&quot;: &quot;chat.completion&quot;,</span><br><span class="line">  &quot;created&quot;: 1728738926,</span><br><span class="line">  &quot;model&quot;: &quot;deepseek-coder-v2&quot;,</span><br><span class="line">  &quot;system_fingerprint&quot;: &quot;fp_ollama&quot;,</span><br><span class="line">  &quot;choices&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;index&quot;: 0,</span><br><span class="line">      &quot;message&quot;: &#123;</span><br><span class="line">        &quot;role&quot;: &quot;assistant&quot;,</span><br><span class="line">        &quot;content&quot;: &quot;</span><br><span class="line">        Certainly! Below is a TypeScript function that outputs the Fibonacci sequence up to a specified number of terms:</span><br><span class="line"></span><br><span class="line">        This function starts with the initial terms of the Fibonacci sequence `[0, 1]` and then iteratively calculates each subsequent term</span><br><span class="line">        by summing the two preceding terms. The function returns an array containing the first `n` terms of the Fibonacci sequence.</span><br><span class="line">        &quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;finish_reason&quot;: &quot;stop&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  &quot;usage&quot;: &#123;</span><br><span class="line">    &quot;prompt_tokens&quot;: 29,</span><br><span class="line">    &quot;completion_tokens&quot;: 243,</span><br><span class="line">    &quot;total_tokens&quot;: 272</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function fibonacciSequence(n: number): number[] &#123;</span><br><span class="line">  if (n &lt;= 0) return [];</span><br><span class="line">  if (n === 1) return [0];</span><br><span class="line"></span><br><span class="line">  const result: number[] = [0, 1];</span><br><span class="line"></span><br><span class="line">  for (let i = 2; i &lt; n; i++) &#123;</span><br><span class="line">    result.push(result[i - 1] + result[i - 2]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Example usage: console.log(fibonacciSequence(10));</span><br><span class="line">// Output: [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]</span><br></pre></td></tr></table></figure><p>Check <code>Ollama</code> log:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tail -f ~/.ollama/logs/server.log</span><br></pre></td></tr></table></figure><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li>Ollama FAQ, <em><a href="https://github.com/ollama/ollama/blob/main/docs/faq.md">https://github.com/ollama/ollama/blob/main/docs/faq.md</a></em></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;By default, &lt;code&gt;Ollama&lt;/code&gt; is only accessible from &lt;strong&gt;localhost&lt;/strong&gt;. CORS error and HTTP 403 returned if try to invoke fro</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Proxmox VE Helper Scripts</title>
    <link href="https://terrencemiao.github.io/blog/2024/09/27/Proxmox-VE-Helper-Scripts/"/>
    <id>https://terrencemiao.github.io/blog/2024/09/27/Proxmox-VE-Helper-Scripts/</id>
    <published>2024-09-27T12:58:54.000Z</published>
    <updated>2024-09-27T13:03:22.619Z</updated>
    
    <content type="html"><![CDATA[<p>Run <code>Proxmox VE Post Install</code> script:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bash -c &quot;$(wget -qLO - https://github.com/tteck/Proxmox/raw/main/misc/post-pve-install.sh)&quot;</span><br></pre></td></tr></table></figure><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li>Proxmox VE Helper-Scripts, <em><a href="https://tteck.github.io/Proxmox">https://tteck.github.io/Proxmox</a></em></li><li>Virtualizing OPNsense on Proxmox as Your Primary Router, <em><a href="https://www.youtube.com/watch?v=VcTGKBHcqmk">https://www.youtube.com/watch?v=VcTGKBHcqmk</a></em></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Run &lt;code&gt;Proxmox VE Post Install&lt;/code&gt; script:&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Running a Mac app from Unidentified Developer on MacOS Sequoia</title>
    <link href="https://terrencemiao.github.io/blog/2024/09/19/Running-a-Mac-app-from-Unidentified-Developer-on-MacOS-Sequoia/"/>
    <id>https://terrencemiao.github.io/blog/2024/09/19/Running-a-Mac-app-from-Unidentified-Developer-on-MacOS-Sequoia/</id>
    <published>2024-09-19T00:16:23.000Z</published>
    <updated>2024-09-19T00:34:04.803Z</updated>
    
    <content type="html"><![CDATA[<p>Latest <code>MacOS Sequoia</code> has made another security enforcement. To open and run a Mac application, e.g. <code>VLC</code> nightly build at <em><a href="https://nightlies.videolan.org/">https://nightlies.videolan.org/</a></em>, <strong>Unidentified Developer</strong> , the following steps can take.</p><ul><li>Enable “Allow Applications from Anywhere”</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">base ~</span><br><span class="line">sudo spctl --master-disable</span><br><span class="line">Password:</span><br><span class="line">Globally disabling the assessment system needs to be confirmed in System Settings.</span><br></pre></td></tr></table></figure><p>Go to <strong>System Settings</strong> -&gt; <strong>Privacy &amp; Security</strong>, select “Allow Applications from Anywhere”:</p><p><img src="/blog/img/MacOS%20-%20Allow%20Applications%20from%20Anywhere.png" alt="MacOS - Allow Applications from Anywhere" title="MacOS - Allow Applications from Anywhere"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">base ~</span><br><span class="line">sudo spctl --master-enable</span><br><span class="line">Password:</span><br><span class="line">This operation is no longer supported. Please see the man page for more information.</span><br></pre></td></tr></table></figure><ul><li>Disable MacOS Quarantine on the application</li></ul><p>In this case application <code>VLC</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">base ~</span><br><span class="line">xattr -dr com.apple.quarantine /Applications/VLC.app</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Latest &lt;code&gt;MacOS Sequoia&lt;/code&gt; has made another security enforcement. To open and run a Mac application, e.g. &lt;code&gt;VLC&lt;/code&gt; nightly</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Configure and setup Mellanox network adapter</title>
    <link href="https://terrencemiao.github.io/blog/2024/09/17/Configure-and-setup-Mellanox-network-adapter/"/>
    <id>https://terrencemiao.github.io/blog/2024/09/17/Configure-and-setup-Mellanox-network-adapter/</id>
    <published>2024-09-17T01:42:01.000Z</published>
    <updated>2024-09-19T02:43:19.482Z</updated>
    
    <content type="html"><![CDATA[<p>A <em>Mellanox ConnectX-4 MCX455A-ECAT PCIe x16 3.0 100GBe VPI EDR IB</em> network adapter. Enable <code>VT-d</code>(Intel Virtualization Technology for Directed I&#x2F;O), <code>SR-IOV</code> (Single Root IO Virtualization), and the number of Virtual Functions in Chipset and Network in BIOS.</p><h2 id="Configuration-and-Setup"><a href="#Configuration-and-Setup" class="headerlink" title="Configuration and Setup"></a>Configuration and Setup</h2><p>Go to NVIDIA Firmware Tools (MFT) <em><a href="https://network.nvidia.com/products/adapter-software/firmware-tools/">https://network.nvidia.com/products/adapter-software/firmware-tools/</a></em> and download the <code>MFT</code>; go to Updating Firmware for ConnectX®-4 VPI PCI Express Adapter Cards (InfiniBand, Ethernet, VPI) <em><a href="https://network.nvidia.com/support/firmware/connectx4ib/">https://network.nvidia.com/support/firmware/connectx4ib/</a></em> and download the updated firmware e.g. <code>mft-4.26.1-6-x86_64-deb.tgz</code>.</p><p>After installation, start up <strong>Mellanox Software Tools</strong> service:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# mst start</span><br><span class="line">Starting MST (Mellanox Software Tools) driver set</span><br><span class="line">Loading MST PCI module - Success</span><br><span class="line">Loading MST PCI configuration module - Success</span><br><span class="line">Create devices</span><br><span class="line">Unloading MST PCI module (unused) - Success</span><br></pre></td></tr></table></figure><p>Check status:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# mst status</span><br><span class="line">MST modules:</span><br><span class="line">------------</span><br><span class="line">    MST PCI module is not loaded</span><br><span class="line">    MST PCI configuration module loaded</span><br><span class="line"></span><br><span class="line">MST devices:</span><br><span class="line">------------</span><br><span class="line">/dev/mst/mt4115_pciconf0         - PCI configuration cycles access.</span><br><span class="line">                                   domain:bus:dev.fn=0000:06:00.0 addr.reg=88 data.reg=92 cr_bar.gw_offset=-1</span><br><span class="line">                                   Chip revision is: 00</span><br></pre></td></tr></table></figure><p>Query Mellanox network adapter:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# flint -d /dev/mst/mt4115_pciconf0 query</span><br><span class="line">Image type:            FS3</span><br><span class="line">FW Version:            12.28.2006</span><br><span class="line">FW Release Date:       15.9.2020</span><br><span class="line">Product Version:       12.28.2006</span><br><span class="line">Rom Info:              type=UEFI version=14.21.17 cpu=AMD64</span><br><span class="line">                       type=PXE version=3.6.102 cpu=AMD64</span><br><span class="line">Description:           UID                GuidsNumber</span><br><span class="line">Base GUID:             ec0d9a030076eae2        4</span><br><span class="line">Base MAC:              ec0d9a76eae2            4</span><br><span class="line">Image VSD:             N/A</span><br><span class="line">Device VSD:            N/A</span><br><span class="line">PSID:                  LNV2180110032</span><br><span class="line">Security Attributes:   N/A</span><br></pre></td></tr></table></figure><p>Check Mellanox network adapter configuration:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# mlxconfig -d /dev/mst/mt4115_pciconf0 query</span><br><span class="line">Device #1:</span><br><span class="line">----------</span><br><span class="line"></span><br><span class="line">Device type:        ConnectX4</span><br><span class="line">Name:               00KH925_Ax</span><br><span class="line">Description:        Mellanox ConnectX-4 EDR IB VPI Single-port x16 PCIe 3.0 HCA</span><br><span class="line">Device:             /dev/mst/mt4115_pciconf0</span><br><span class="line"></span><br><span class="line">Configurations:</span><br><span class="line">        LINK_TYPE_P1                                ETH(2)</span><br><span class="line">        SRIOV_EN                                    True(1)</span><br><span class="line">        NUM_OF_VFS                                  8</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>Verify network adapter configuration:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">terrence@pve:~# ethtool enp1s0np0</span><br><span class="line">Settings for enp1s0np0:</span><br><span class="line">Supported ports: [ Backplane ]</span><br><span class="line">Supported link modes:   1000baseKX/Full</span><br><span class="line">                        10000baseKR/Full</span><br><span class="line">                        40000baseKR4/Full</span><br><span class="line">                        40000baseCR4/Full</span><br><span class="line">                        40000baseSR4/Full</span><br><span class="line">                        40000baseLR4/Full</span><br><span class="line">                        56000baseKR4/Full</span><br><span class="line">                        25000baseCR/Full</span><br><span class="line">                        25000baseKR/Full</span><br><span class="line">                        25000baseSR/Full</span><br><span class="line">                        50000baseCR2/Full</span><br><span class="line">                        50000baseKR2/Full</span><br><span class="line">                        100000baseKR4/Full</span><br><span class="line">                        100000baseSR4/Full</span><br><span class="line">                        100000baseCR4/Full</span><br><span class="line">                        100000baseLR4_ER4/Full</span><br><span class="line">Supported pause frame use: Symmetric</span><br><span class="line">Supports auto-negotiation: Yes</span><br><span class="line">Supported FEC modes: None RS BASER</span><br><span class="line">Advertised link modes:  1000baseKX/Full</span><br><span class="line">                        10000baseKR/Full</span><br><span class="line">                        40000baseKR4/Full</span><br><span class="line">                        40000baseCR4/Full</span><br><span class="line">                        40000baseSR4/Full</span><br><span class="line">                        40000baseLR4/Full</span><br><span class="line">                        56000baseKR4/Full</span><br><span class="line">                        25000baseCR/Full</span><br><span class="line">                        25000baseKR/Full</span><br><span class="line">                        25000baseSR/Full</span><br><span class="line">                        50000baseCR2/Full</span><br><span class="line">                        50000baseKR2/Full</span><br><span class="line">                        100000baseKR4/Full</span><br><span class="line">                        100000baseSR4/Full</span><br><span class="line">                        100000baseCR4/Full</span><br><span class="line">                        100000baseLR4_ER4/Full</span><br><span class="line">Advertised pause frame use: Symmetric</span><br><span class="line">Advertised auto-negotiation: Yes</span><br><span class="line">Advertised FEC modes: RS</span><br><span class="line">Speed: 100000Mb/s</span><br><span class="line">Duplex: Full</span><br><span class="line">Auto-negotiation: on</span><br><span class="line">Port: Direct Attach Copper</span><br><span class="line">PHYAD: 0</span><br><span class="line">Transceiver: internal</span><br><span class="line">Link detected: yes</span><br></pre></td></tr></table></figure><h2 id="Virtualization"><a href="#Virtualization" class="headerlink" title="Virtualization"></a>Virtualization</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lspci | grep Mellanox</span><br><span class="line">06:00.0 Ethernet controller: Mellanox Technologies MT27700 Family [ConnectX-4]</span><br><span class="line"></span><br><span class="line">root@pve:~# ip link show</span><br><span class="line">...</span><br><span class="line">4: enp1s0np0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq master vmbr2 state UP mode DEFAULT group default qlen 1000</span><br><span class="line">    link/ether ec:0d:9a:76:eb:2a brd ff:ff:ff:ff:ff:ff</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>Write to the sysfs file the number of Virtual Functions:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# echo 8 &gt; /sys/class/infiniband/mlx5_0/device/sriov_numvfs</span><br></pre></td></tr></table></figure><p>Verify that the Virtual Functions were created:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lspci | grep Mellanox</span><br><span class="line">01:00.0 Ethernet controller: Mellanox Technologies MT27700 Family [ConnectX-4]</span><br><span class="line">01:00.1 Ethernet controller: Mellanox Technologies MT27700 Family [ConnectX-4 Virtual Function]</span><br><span class="line">01:00.2 Ethernet controller: Mellanox Technologies MT27700 Family [ConnectX-4 Virtual Function]</span><br><span class="line">01:00.3 Ethernet controller: Mellanox Technologies MT27700 Family [ConnectX-4 Virtual Function]</span><br><span class="line">01:00.4 Ethernet controller: Mellanox Technologies MT27700 Family [ConnectX-4 Virtual Function]</span><br><span class="line">01:00.5 Ethernet controller: Mellanox Technologies MT27700 Family [ConnectX-4 Virtual Function]</span><br><span class="line">01:00.6 Ethernet controller: Mellanox Technologies MT27700 Family [ConnectX-4 Virtual Function]</span><br><span class="line">01:00.7 Ethernet controller: Mellanox Technologies MT27700 Family [ConnectX-4 Virtual Function]</span><br><span class="line">01:01.0 Ethernet controller: Mellanox Technologies MT27700 Family [ConnectX-4 Virtual Function]</span><br><span class="line"></span><br><span class="line">root@pve:~# ip link show</span><br><span class="line">...</span><br><span class="line">4: enp1s0np0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq master vmbr2 state UP mode DEFAULT group default qlen 1000</span><br><span class="line">    link/ether ec:0d:9a:76:eb:2a brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    vf 0     link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff, spoof checking off, link-state auto, trust off, query_rss off</span><br><span class="line">    vf 1     link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff, spoof checking off, link-state auto, trust off, query_rss off</span><br><span class="line">    vf 2     link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff, spoof checking off, link-state auto, trust off, query_rss off</span><br><span class="line">    vf 3     link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff, spoof checking off, link-state auto, trust off, query_rss off</span><br><span class="line">    vf 4     link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff, spoof checking off, link-state auto, trust off, query_rss off</span><br><span class="line">    vf 5     link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff, spoof checking off, link-state auto, trust off, query_rss off</span><br><span class="line">    vf 6     link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff, spoof checking off, link-state auto, trust off, query_rss off</span><br><span class="line">    vf 7     link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff, spoof checking off, link-state auto, trust off, query_rss off</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="Persistence"><a href="#Persistence" class="headerlink" title="Persistence"></a>Persistence</h2><p>Print out device information:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# udevadm info /sys/class/infiniband/mlx5_0</span><br><span class="line">P: /devices/pci0000:00/0000:00:01.0/0000:01:00.0/infiniband/mlx5_0</span><br><span class="line">M: mlx5_0</span><br><span class="line">R: 0</span><br><span class="line">U: infiniband</span><br><span class="line">E: DEVPATH=/devices/pci0000:00/0000:00:01.0/0000:01:00.0/infiniband/mlx5_0</span><br><span class="line">E: SUBSYSTEM=infiniband</span><br><span class="line">E: NAME=mlx5_0</span><br></pre></td></tr></table></figure><p>Make the network adapter Virtual Functions persistent after reboot:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# cat /etc/udev/rules.d/mlx.rules</span><br><span class="line">ACTION==&quot;add&quot;, SUBSYSTEM==&quot;infiniband&quot;, ENV&#123;NAME&#125;==&quot;mlx5_0&quot;, ATTR&#123;device/sriov_numvfs&#125;=&quot;8&quot;</span><br></pre></td></tr></table></figure><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li>Mellanox ConnectX-4 100Gb NIC Firmware Update and Ethernet Mode, <em><a href="https://www.youtube.com/watch?v=D1qN7Qg3bSg">https://www.youtube.com/watch?v=D1qN7Qg3bSg</a></em></li><li>Single Root IO Virtualization (SR-IOV), <em><a href="https://docs.nvidia.com/networking/display/mlnxofedv53100143/single+root+io+virtualization+(sr-iov)">https://docs.nvidia.com/networking/display/mlnxofedv53100143/single+root+io+virtualization+(sr-iov)</a></em></li><li>Persisting SR-IOV virtual functions after reboot, <em><a href="https://www.reddit.com/r/homelab/comments/hf12mv/persisting_sriov_virtual_functions_after_reboot/">https://www.reddit.com/r/homelab/comments/hf12mv/persisting_sriov_virtual_functions_after_reboot/</a></em></li><li>PCI Device Assignment with SR-IOV Devices, <em><a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/7/html/virtualization_deployment_and_administration_guide/sect-pci_devices-pci_passthrough">https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/7/html/virtualization_deployment_and_administration_guide/sect-pci_devices-pci_passthrough</a></em></li><li>100 Gbe &amp; TrueNAS Scale 23.10 iSCSI - Performance Unleashed, <em><a href="https://forum.level1techs.com/t/100-gbe-truenas-scale-23-10-iscsi-performance-unleashed/206452">https://forum.level1techs.com/t/100-gbe-truenas-scale-23-10-iscsi-performance-unleashed/206452</a></em></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;A &lt;em&gt;Mellanox ConnectX-4 MCX455A-ECAT PCIe x16 3.0 100GBe VPI EDR IB&lt;/em&gt; network adapter. Enable &lt;code&gt;VT-d&lt;/code&gt;(Intel Virtualization</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Create Storage Pool in Windows Server 2022</title>
    <link href="https://terrencemiao.github.io/blog/2024/09/15/Create-Storage-Pool-in-Windows-Server-2022/"/>
    <id>https://terrencemiao.github.io/blog/2024/09/15/Create-Storage-Pool-in-Windows-Server-2022/</id>
    <published>2024-09-15T11:39:18.000Z</published>
    <updated>2024-09-15T11:46:28.435Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/img/Storage%20Pool%20-%20Create.png" alt="Storage Pool - Create" title="Storage Pool - Create"></p><p><img src="/blog/img/Storage%20Pool%20-%20Physical%20Disks.png" alt="Storage Pool - Physical Disks" title="Storage Pool - Physical Disks"></p><p><img src="/blog/img/Storage%20Pool%20-%20Storage%20Layout.png" alt="Storage Pool - Storage Layout" title="Storage Pool - Storage Layout"></p><p><img src="/blog/img/Storage%20Pool%20-%20Virtual%20Disk.png" alt="Storage Pool - Virtual Disk" title="Storage Pool - Virtual Disk"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;/blog/img/Storage%20Pool%20-%20Create.png&quot; alt=&quot;Storage Pool - Create&quot; title=&quot;Storage Pool - Create&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/im</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Fix network object name already existed issue in Windows</title>
    <link href="https://terrencemiao.github.io/blog/2024/09/15/Fix-network-object-name-already-existed-issue-in-Windows/"/>
    <id>https://terrencemiao.github.io/blog/2024/09/15/Fix-network-object-name-already-existed-issue-in-Windows/</id>
    <published>2024-09-15T11:18:03.000Z</published>
    <updated>2024-09-15T11:27:42.438Z</updated>
    
    <content type="html"><![CDATA[<p>When rename a network adapter in <code>Windows</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Rename-NetAdapter -Name Ethernet -NewName Mellanox</span><br></pre></td></tr></table></figure><p>an error <strong>Rename-NetAdapter : {Object Exists} An attempt was made to create an object and the object name already existed</strong> thrown.</p><p>Work around solution is:</p><ol><li>Open <strong>Device Manager</strong> in Windows Control Panel</li><li>Under menu <strong>View</strong> enable <strong>Show hidden devices</strong></li><li>Uninstall the old network adapter with the old name</li><li>Then rename the network adapter again</li></ol><p><img src="/blog/img/Rename%20Network%20in%20Windows.png" alt="Rename Network in Windows" title="Rename Network in Windows"></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li>Registry mismatch Get-NetAdapter, <em><a href="https://stackoverflow.com/questions/42220423/registry-mismatch-get-netadapter">https://stackoverflow.com/questions/42220423/registry-mismatch-get-netadapter</a></em></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;When rename a network adapter in &lt;code&gt;Windows&lt;/code&gt;:&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span c</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>How to enable SMB Direct client/server in Windows 11 Pro for Workstations</title>
    <link href="https://terrencemiao.github.io/blog/2024/09/14/How-to-enable-SMB-Direct-client-server-in-Windows-11-Pro-for-Workstations/"/>
    <id>https://terrencemiao.github.io/blog/2024/09/14/How-to-enable-SMB-Direct-client-server-in-Windows-11-Pro-for-Workstations/</id>
    <published>2024-09-14T07:52:08.000Z</published>
    <updated>2024-09-15T11:09:04.507Z</updated>
    
    <content type="html"><![CDATA[<p>In <code>Windows 11 Pro Station</code>, a <em>Mellanox ConnectX-4 MCX455A-ECAT PCIe x16 3.0 100GBe VPI EDR IB network adatper</em>, goes to support <strong>SMB Direct</strong>, client and server side <strong>SMB Multichannel</strong> and <strong>RDMA</strong> (Remote Direct Memory Access):</p><p><img src="/blog/img/Windows%2011%20Pro%20for%20Workstations.png" alt="Windows 11 Pro for Workstations" title="Windows 11 Pro for Workstations"></p><p>Open Windows Terminal as Administrator.</p><p>Enable SMB Direct:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Enable-WindowsOptionalFeature -Online -FeatureName SMBDirect</span><br><span class="line">Path          :</span><br><span class="line">Online        : True</span><br><span class="line">RestartNeeded : False</span><br></pre></td></tr></table></figure><p>Enable SMB Multichannel on the client-side:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Set-SmbClientConfiguration -EnableMultiChannel $true</span><br><span class="line">Confirm</span><br><span class="line">Are you sure you want to perform this action?</span><br><span class="line">Performing operation &#x27;Modify&#x27; on Target &#x27;SMB Client Configuration&#x27;.</span><br><span class="line">[Y] Yes  [A] Yes to All  [N] No  [L] No to All  [S] Suspend  [?] Help (default is &quot;Y&quot;):</span><br><span class="line"></span><br><span class="line">PS C:\&gt; Get-SmbClientConfiguration</span><br><span class="line">...</span><br><span class="line">EnableMultiChannel                    : True</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>Enable SMB Multichannel on the server-side:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Set-SmbServerConfiguration -EnableMultiChannel $true</span><br><span class="line">Confirm</span><br><span class="line">Are you sure you want to perform this action?</span><br><span class="line">Performing operation &#x27;Modify&#x27; on Target &#x27;SMB Server Configuration&#x27;.</span><br><span class="line">[Y] Yes  [A] Yes to All  [N] No  [L] No to All  [S] Suspend  [?] Help (default is &quot;Y&quot;):</span><br><span class="line"></span><br><span class="line">PS C:\&gt; Get-SmbServerConfiguration</span><br><span class="line">...</span><br><span class="line">EnableMultiChannel                     : True</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>Enable RDMA for a specific interface:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Enable-NetAdapterRDMA Mellanox</span><br></pre></td></tr></table></figure><p>Verify which state of operability SMB Direct is currently configured to:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Get-WindowsOptionalFeature -Online -FeatureName SMBDirect</span><br><span class="line">FeatureName      : SmbDirect</span><br><span class="line">DisplayName      : SMB Direct</span><br><span class="line">Description      : Remote Direct Memory Access (RDMA) support for the SMB 3.x file sharing protocol</span><br><span class="line">RestartRequired  : Possible</span><br><span class="line">State            : Enabled</span><br><span class="line">CustomProperties :</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Get-SmbClientNetworkInterface</span><br><span class="line">Interface Index RSS Capable RDMA Capable Speed       IpAddresses                                 Friendly Name</span><br><span class="line">--------------- ----------- ------------ -----       -----------                                 -------------</span><br><span class="line">22              True        True         100 Gbps    &#123;fe80::708:c529:1bcb:2432, 192.168.68.67&#125;   Mellanox</span><br><span class="line"></span><br><span class="line">PS C:\&gt; Get-SmbServerNetworkInterface</span><br><span class="line">Scope Name Interface Index RSS Capable RDMA Capable Speed    IpAddress</span><br><span class="line">---------- --------------- ----------- ------------ -----    ---------</span><br><span class="line">*          22              True        True         100 Gbps fe80::708:c529:1bcb:2432</span><br><span class="line">*          22              True        True         100 Gbps 192.168.68.67</span><br></pre></td></tr></table></figure><p>Have a look <code>TrueNAS</code> disk speed benchmark, over a 100Gbps ethernet network, from <code>Windows 11 Pro for Workstations</code> with <strong>SMB Direct</strong>, client&#x2F;server <strong>SMB Multichannel</strong> and <strong>RDMA</strong> enabled:</p><p><img src="/blog/img/TrueNAS%20disk%20speed%20benchmark.png" alt="TrueNAS disk speed benchmark" title="TrueNAS disk speed benchmark"></p><p>In <code>Windows Server 2022</code>, with SMB shared folder in <strong>Storage Spaces</strong>:</p><p><img src="/blog/img/Windows%20Server%202022.png" alt="Windows Server 2022" title="Windows Server 2022"></p><p>Run Windows Powershell as <strong>Administrator</strong> user , which <strong>RDMA Capable</strong> are all True for both SMB client&#x2F;server:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Windows PowerShell</span><br><span class="line">Copyright (C) Microsoft Corporation. All rights reserved.</span><br><span class="line">Install the latest PowerShell for new features and improvements! https://aka.ms/PSWindows</span><br><span class="line"></span><br><span class="line">PS C:\Users\Administrator&gt; Get-SmbServerNetworkInterface</span><br><span class="line">Scope Name Interface Index RSS Capable RDMA Capable Speed    IpAddress</span><br><span class="line">---------- --------------- ----------- ------------ -----    ---------</span><br><span class="line">*          5               True        True         100 Gbps fe80::9ee0:7f4c:5128:863b</span><br><span class="line">*          5               True        True         100 Gbps 192.168.68.66</span><br><span class="line"></span><br><span class="line">PS C:\Users\Administrator&gt; Get-SmbClientNetworkInterface</span><br><span class="line">Interface Index RSS Capable RDMA Capable Speed    IpAddresses                                Friendly Name</span><br><span class="line">--------------- ----------- ------------ -----    -----------                                -------------</span><br><span class="line">5               True        True         100 Gbps &#123;fe80::9ee0:7f4c:5128:863b, 192.168.68.66&#125; Mellanox</span><br></pre></td></tr></table></figure><p>Have a look <code>Windows Server 2022</code> disk speed benchmark, over a 100Gbps ethernet network, from <code>Windows 11 Pro for Workstations</code> with <strong>SMB Direct</strong>, client&#x2F;server <strong>SMB Multichannel</strong> and <strong>RDMA</strong> enabled:</p><p><img src="/blog/img/Windows%20Server%202022%20disk%20speed%20benchmark.png" alt="Windows Server 2022 disk speed benchmark" title="Windows Server 2022 disk speed benchmark"></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li>SMB Direct, <em><a href="https://learn.microsoft.com/en-us/windows-server/storage/file-server/smb-direct">https://learn.microsoft.com/en-us/windows-server/storage/file-server/smb-direct</a></em></li><li>100 Gbe &amp; TrueNAS Scale 23.10 iSCSI - Performance Unleashed, <em><a href="https://forum.level1techs.com/t/100-gbe-truenas-scale-23-10-iscsi-performance-unleashed/206452">https://forum.level1techs.com/t/100-gbe-truenas-scale-23-10-iscsi-performance-unleashed/206452</a></em></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;In &lt;code&gt;Windows 11 Pro Station&lt;/code&gt;, a &lt;em&gt;Mellanox ConnectX-4 MCX455A-ECAT PCIe x16 3.0 100GBe VPI EDR IB network adatper&lt;/em&gt;, goes </summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Fixing TrueNAS SMB IP binding</title>
    <link href="https://terrencemiao.github.io/blog/2024/09/14/Fixing-TrueNAS-SMB-IP-binding/"/>
    <id>https://terrencemiao.github.io/blog/2024/09/14/Fixing-TrueNAS-SMB-IP-binding/</id>
    <published>2024-09-14T02:37:53.000Z</published>
    <updated>2024-09-14T02:53:10.659Z</updated>
    
    <content type="html"><![CDATA[<p>After changing network settings, <code>TrueNAS</code> IP address has been updated. If modify SMB configuration, error like:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smb_update.bindip.0: IP address [192.168.0.51] is not a configured address for this server</span><br></pre></td></tr></table></figure><p>thrown.</p><p>To reset and clean up already bind IP, login TrueNAS Console and run:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">root@TrueNAS[~]# midclt call smb.update &#x27;&#123;&quot;bindip&quot;: []&#125;&#x27;</span><br><span class="line">&#123;</span><br><span class="line">    &quot;id&quot;: 1,</span><br><span class="line">    &quot;netbiosname&quot;: &quot;TRUENAS&quot;,</span><br><span class="line">    &quot;netbiosalias&quot;: [],</span><br><span class="line">    &quot;workgroup&quot;: &quot;IGLOO STUDIO&quot;,</span><br><span class="line">    &quot;description&quot;: &quot;TrueNAS Server&quot;,</span><br><span class="line">    &quot;unixcharset&quot;: &quot;UTF-8&quot;,</span><br><span class="line">    &quot;loglevel&quot;: &quot;MINIMUM&quot;,</span><br><span class="line">    &quot;syslog&quot;: false,</span><br><span class="line">    &quot;aapl_extensions&quot;: true,</span><br><span class="line">    &quot;Localmaster&quot;: true,</span><br><span class="line">    &quot;guest&quot;: &quot;nobody&quot;,</span><br><span class="line">    &quot;filemask&quot;&#x27;: &quot;&quot;,</span><br><span class="line">    &quot;dirmask&quot;&#x27;: &quot;&quot;,</span><br><span class="line">    &quot;smb_options&quot;: &quot;&quot;,</span><br><span class="line">    &quot;bindip&quot;: [],</span><br><span class="line">    &quot;cifs_SID&quot;: &quot;S-1-5-21-2487580926-3122677641-100607549&quot;,</span><br><span class="line">    &quot;ntImv1_auth&quot;: false,</span><br><span class="line">    &quot;enable_smb1&quot;: false,</span><br><span class="line">    &quot;admin_group&quot;: null,</span><br><span class="line">    &quot;next_rid&quot;: 0,</span><br><span class="line">    &quot;multichannel&quot;: true,</span><br><span class="line">    &quot;netbiosname_local&quot;: &quot;TRUENAS&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>then can modify SMB configuration successfully.</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li>Help with SMB IP binding, <em><a href="https://www.reddit.com/r/freenas/comments/fovpfz/help_with_smb_ip_binding">https://www.reddit.com/r/freenas/comments/fovpfz/help_with_smb_ip_binding</a></em></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;After changing network settings, &lt;code&gt;TrueNAS&lt;/code&gt; IP address has been updated. If modify SMB configuration, error like:&lt;/p&gt;
&lt;figure c</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Running MacOS on Proxmox</title>
    <link href="https://terrencemiao.github.io/blog/2024/09/08/Running-MacOS-on-Proxmox/"/>
    <id>https://terrencemiao.github.io/blog/2024/09/08/Running-MacOS-on-Proxmox/</id>
    <published>2024-09-08T01:34:16.000Z</published>
    <updated>2024-09-08T02:29:17.004Z</updated>
    
    <content type="html"><![CDATA[<p>Following the instructions to run the latest MacOS, <em>Sonoma 14.6.1</em>, on Proxmox - <a href="https://klabsdev.com/definitive-guide-to-running-macos-in-proxmox">The Definitive Guide to Running MacOS in Proxmox</a>.</p><p><img src="/blog/img/Proxmox%20-%20MacOS.png" alt="Proxmox - MacOS" title="Proxmox - MacOS"></p><p>A few more put on notes:</p><ul><li>You can login with <code>Apple ID</code></li><li>Modify <code>config.plist</code> file under EFI folder -&gt; OC folder, change the default Screen Resolution from <code>1080P</code> <strong>1920x1080@32</strong> to <code>2K</code> <strong>2560x1440@32</strong>. Look more information in <code>Configuration.pdf</code> file in <a href="https://github.com/thenickdude/KVM-Opencore/releases"><strong>KVM-Opencore</strong> release</a></li></ul><p>Connect with <strong>Apple Remote Desktop</strong>, so can use exact same Apple Keyboard mapping:</p><p><img src="/blog/img/Proxmox%20-%20Apple%20Remote%20Desktop.png" alt="Proxmox - Apple Remote Desktop" title="Proxmox - Apple Remote Desktop"></p><p>Current <a href="https://github.com/thenickdude/KVM-Opencore"><strong>KVM-Opencore</strong></a> hasn’t setup support for Audio device and GPU accelerator.</p><p>Also try to setup <a href="https://parsec.app/"><strong>Parsec</strong></a> in MacOS on Proxmox, without success.</p><p><img src="/blog/img/Proxmox%20-%20Parsec.png" alt="Proxmox - Parsec" title="Proxmox - Parsec"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Following the instructions to run the latest MacOS, &lt;em&gt;Sonoma 14.6.1&lt;/em&gt;, on Proxmox - &lt;a href=&quot;https://klabsdev.com/definitive-guide-t</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Setup MikroTik CRS504-4XQ-IN and run a speed test</title>
    <link href="https://terrencemiao.github.io/blog/2024/09/02/Setup-MikroTik-CRS504-4XQ-IN-and-run-a-speed-test/"/>
    <id>https://terrencemiao.github.io/blog/2024/09/02/Setup-MikroTik-CRS504-4XQ-IN-and-run-a-speed-test/</id>
    <published>2024-09-02T04:17:37.000Z</published>
    <updated>2024-09-02T05:09:49.841Z</updated>
    
    <content type="html"><![CDATA[<p><code>MikroTik CRS504-4XQ-IN</code>, the Cloud Switch can handle FOUR QSFP28 100Gbps ports, equal to 16 x 25Gbps bandwidth.</p><p><img src="/blog/img/MikroTik%20-%20Interfaces.png" alt="MikroTik - Interfaces" title="MikroTik - Interfaces"></p><p>Setup single link mode, only the first QSFP28 sub-interface needs to be configured, while the remaining three sub-interfaces should remain enabled. For example, connect <code>Mellanox MCX455A-ECAT ConnectX-4 InfiniBand/Ethernet adapter card (EDR IB 100Gbps and 100GbE, single-port QSFP28, PCIe 3.0x16)</code> using <code>ONTi DAC QSFP28 100Gbps</code> cable to the switch.</p><p>Change <strong>FEC Mode</strong> to <code>fec91</code>.</p><p><em>Ethernet Forward Error Correction (FEC) is a technique used to improve the reliability of data transmission over Ethernet networks by detecting and correcting errors in data packets. The two most common types of FEC used in Ethernet networks are CL74 and CL91.</em></p><p><em>CL74 and CL91 refer to two different types of FEC codes, each with its own characteristics and performance. Here’s a brief comparison between the two:</em></p><p><em>Code Rate:</em></p><p><em>CL91 has a higher code rate of 91.6%, which means that only 8.4% of the data transmitted is used for error correction.</em></p><p>In addition, setup the swith port connected to <code>ONTi QSFP28 40Gbps TO 4SFP+</code> breakout cable:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -l admin MikroTik.local</span><br><span class="line"></span><br><span class="line">[admin@MikroTik] &gt; /interface ethernet set qsfp28-1-1 auto-negotiation=no speed=10G-baseCR</span><br><span class="line">[admin@MikroTik] &gt; /interface ethernet set qsfp28-1-2 auto-negotiation=no speed=10G-baseCR</span><br><span class="line">[admin@MikroTik] &gt; /interface ethernet set qsfp28-1-3 auto-negotiation=no speed=10G-baseCR</span><br><span class="line">[admin@MikroTik] &gt; /interface ethernet set qsfp28-1-4 auto-negotiation=no speed=10G-baseCR</span><br></pre></td></tr></table></figure><h2 id="Speed-test"><a href="#Speed-test" class="headerlink" title="Speed test"></a>Speed test</h2><p>In <code>iperf3</code> server, run listens to 4 ports to manage connections in parallel:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ iperf3 -s -p 5201 &amp; iperf3 -s -p 5202 &amp; iperf3 -s -p 5203 &amp; iperf3 -s -p 5204 &amp;</span><br></pre></td></tr></table></figure><p>In a MacBook Pro with WiFi-6 connection, run:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ iperf3 -c MikroTik.local -p 5201 -P 4 -t 1000</span><br></pre></td></tr></table></figure><p>In a Mac Studio with 10Gbps Ethernet connection, run:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ iperf3 -c MikroTik.local -p 5202 -P 8 -t 1000 -B 192.168.0.104</span><br></pre></td></tr></table></figure><p>In a Windows 11 PC with 100Gbps Ethernet connection, run:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ iperf3 -c MikroTik.local -p 5203 -P 2 -t 1000</span><br></pre></td></tr></table></figure><p>Check the speed on switch console:</p><p><img src="/blog/img/MikroTik%20-%20Speed.png" alt="MikroTik - Speed" title="MikroTik - Speed"></p><p>and in graph:</p><p><img src="/blog/img/MikroTik%20-%20Performance.png" alt="MikroTik - Performance" title="MikroTik - Performance"></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li>MikroTik wired interface compatibility, <em><a href="https://help.mikrotik.com/docs/display/ROS/MikroTik+wired+interface+compatibility">https://help.mikrotik.com/docs/display/ROS/MikroTik+wired+interface+compatibility</a></em></li><li>MikroTik RouterOS, <em><a href="https://help.mikrotik.com/docs/display/ROS/RouterOS">https://help.mikrotik.com/docs/display/ROS/RouterOS</a></em></li><li>MikroTik CRS504-4XQ-IN Quick Guide, <em><a href="https://help.mikrotik.com/docs/display/QG/Quick+Guide+-+CRS504-4XQ-IN">https://help.mikrotik.com/docs/display/QG/Quick+Guide+-+CRS504-4XQ-IN</a></em></li><li>FEC (Forward Error Correction), <em><a href="https://www.reddit.com/r/fortinet/comments/127z3wd/fec_forward_error_correction/">https://www.reddit.com/r/fortinet/comments/127z3wd/fec_forward_error_correction/</a></em></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;code&gt;MikroTik CRS504-4XQ-IN&lt;/code&gt;, the Cloud Switch can handle FOUR QSFP28 100Gbps ports, equal to 16 x 25Gbps bandwidth.&lt;/p&gt;
&lt;p&gt;&lt;img s</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Setup network bond in Synology NAS</title>
    <link href="https://terrencemiao.github.io/blog/2024/08/11/Setup-network-bond-in-Synology-NAS/"/>
    <id>https://terrencemiao.github.io/blog/2024/08/11/Setup-network-bond-in-Synology-NAS/</id>
    <published>2024-08-11T05:45:25.000Z</published>
    <updated>2024-08-11T06:08:33.048Z</updated>
    
    <content type="html"><![CDATA[<p>Synology NAS DS920+ with two build-in 1Gbps ethernet adapters, and two 2.5Gbps USB 3.0 Ethernet Adapters. Now setup network bond &#x2F; link aggregation on them.</p><ul><li>Enable Network Link Aggregation Mode</li></ul><p><img src="/blog/img/Synology%20-%20Network%20Link%20Aggregation.png" alt="Synology - Network Link Aggregation Mode" title="Synology - Network Link Aggregation Mode"></p><ul><li>Pickup network devices into bond</li></ul><p><img src="/blog/img/Synology%20-%20Physical%20devices.png" alt="Synology - Physical devices" title="Synology - Physical devices"></p><ul><li>Setup network</li></ul><p><img src="/blog/img/Synology%20-%20Physical%20devices%20network%20setup.png" alt="Synology - Physical devices network setup" title="Synology - Physical devices network setup"></p><ul><li>Accept network interface change after network bond</li></ul><p><img src="/blog/img/Synology%20-%20Bond%20warning%20message.png" alt="Synology - Bond warning message" title="Synology - Bond warning message"></p><ul><li>Network bonded</li></ul><p><img src="/blog/img/Synology%20-%20Network%20bonded.png" alt="Synology - Network bonded" title="Synology - Network bonded"></p><ul><li>Network bond service order</li></ul><p><img src="/blog/img/Synology%20-%20Network%20bonded.png" alt="Synology - Network bond service order" title="Synology - Network bond service order"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Synology NAS DS920+ with two build-in 1Gbps ethernet adapters, and two 2.5Gbps USB 3.0 Ethernet Adapters. Now setup network bond &amp;#x2F; l</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Setup TrueNAS Network and Link Aggregation</title>
    <link href="https://terrencemiao.github.io/blog/2024/08/09/Setup-TrueNAS-Network-and-Link-Aggregation/"/>
    <id>https://terrencemiao.github.io/blog/2024/08/09/Setup-TrueNAS-Network-and-Link-Aggregation/</id>
    <published>2024-08-08T15:03:40.000Z</published>
    <updated>2024-08-08T15:12:52.764Z</updated>
    
    <content type="html"><![CDATA[<p>Two network adapters have been setup with DHCP allocated addresses:</p><ol><li><code>ens18</code> 192.168.0.246</li><li><code>ens19</code> 192.168.0.105</li></ol><ul><li>Create a Network Link Aggregation Interface</li></ul><p><img src="/blog/img/TrueNAS%20-%20Link%20Aggregation.png" alt="TrueNAS - Link Aggregation" title="TrueNAS - Link Aggregation"></p><p>After Link Aggregation Interface <code>bond1</code> created, original two network adapters <code>ens18</code> and <code>ens19</code> IP addresses are gone. <code>bond1</code> with the ONLY ONE network interface address for <code>TrueNAS</code>.</p><p><img src="/blog/img/TrueNAS%20-%20Network.png" alt="TrueNAS - Network" title="TrueNAS - Network"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Two network adapters have been setup with DHCP allocated addresses:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;ens18&lt;/code&gt; 192.168.0.246&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ens19&lt;/c</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Samba setup and share in TrueNAS</title>
    <link href="https://terrencemiao.github.io/blog/2024/08/07/Samba-setup-and-share-in-TrueNAS/"/>
    <id>https://terrencemiao.github.io/blog/2024/08/07/Samba-setup-and-share-in-TrueNAS/</id>
    <published>2024-08-07T12:19:00.000Z</published>
    <updated>2024-09-02T10:24:20.287Z</updated>
    
    <content type="html"><![CDATA[<p><code>TrueNAS</code> installed and a few steps to setup to let users access shared <code>Samba</code> directories.</p><ul><li>Enable <code>SMB</code> Samba service in <code>TrueNAS</code></li></ul><p><img src="/blog/img/TrueNAS%20-%20Enable%20SMB%20service.png" alt="TrueNAS - Enable SMB service" title="TrueNAS - Enable SMB service"></p><p><img src="/blog/img/TrueNAS%20-%20SMB%20Settings.png" alt="TrueNAS - SMB Settings" title="TrueNAS - SMB Settings"></p><ul><li>Create an user account with home directory and all access permisssions</li></ul><p><img src="/blog/img/TrueNAS%20-%20Create%20user.png" alt="TrueNAS - Create user" title="TrueNAS - Create user"></p><ul><li>Share <code>TrueNAS</code> pool created</li></ul><p><img src="/blog/img/TrueNAS%20-%20Sharing.png" alt="TrueNAS - Sharing" title="TrueNAS - Sharing"></p><p>Then can access shared directory from <code>TrunNAS</code> in both Windows and Mac:</p><p><img src="/blog/img/TrueNAS%20-%20Access.png" alt="TrueNAS - Access" title="TrueNAS - Access"></p><p>Make sure there is NO a lock icon on the folder (can unlock the folder in MacOS Finder)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;code&gt;TrueNAS&lt;/code&gt; installed and a few steps to setup to let users access shared &lt;code&gt;Samba&lt;/code&gt; directories.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Enable &lt;c</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Increase, decrease and resize Proxmox disk volume</title>
    <link href="https://terrencemiao.github.io/blog/2024/08/07/Increase-decrease-and-resize-Proxmox-disk-volume/"/>
    <id>https://terrencemiao.github.io/blog/2024/08/07/Increase-decrease-and-resize-Proxmox-disk-volume/</id>
    <published>2024-08-07T03:29:22.000Z</published>
    <updated>2024-08-07T04:17:50.445Z</updated>
    
    <content type="html"><![CDATA[<p>After a default installation, a tiny disk space given to <code>Proxmox</code> root volume. Insufficient disk space issue raised up after several VMs installed and backup made, as iinstallation image files <code>*.ISO</code> and backup all put into root volume.</p><p>In <code>storage.cfg</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# cat /etc/pve/storage.cfg</span><br><span class="line">dir: local</span><br><span class="line">        path /var/lib/vz</span><br><span class="line">        content iso,vztmpl,backup</span><br><span class="line"></span><br><span class="line">lvmthin: local-lvm</span><br><span class="line">        thinpool data</span><br><span class="line">        vgname pve</span><br><span class="line">        content rootdir,images</span><br></pre></td></tr></table></figure><p>Run <code>lvdisplay</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lvdisplay</span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Name                data</span><br><span class="line">  VG Name                pve</span><br><span class="line">  # open                 0</span><br><span class="line">  LV Size                &lt;3.58 TiB</span><br><span class="line"></span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/pve/swap</span><br><span class="line">  LV Name                swap</span><br><span class="line">  VG Name                pve</span><br><span class="line">  LV Status              available</span><br><span class="line">  # open                 2</span><br><span class="line">  LV Size                8.00 GiB</span><br><span class="line"></span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/pve/root</span><br><span class="line">  LV Name                root</span><br><span class="line">  VG Name                pve</span><br><span class="line">  LV Status              available</span><br><span class="line">  # open                 1</span><br><span class="line">  LV Size                &lt;112.25 GiB</span><br></pre></td></tr></table></figure><p>Solution is to decrease the size of <code>pve/data</code> volume, as this volume doesn’t support reducing thin pools in size yet, and then to increase the size of <code>pdev/root</code> volume.</p><p>Backup all VMs, then remove <code>pve/data</code> volume:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lvremove pve/data</span><br><span class="line">Removing pool pve/data will remove 7 dependent volume(s). Proceed? [y/n]: y</span><br></pre></td></tr></table></figure><p>Based on the disk space has just released, increase the size of <code>pdev/root</code> volume, <strong>20%</strong> for current FREE space in this case:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lvextend -l +20%FREE /dev/pve/root</span><br><span class="line">  Size of logical volume pve/root changed from &lt;112.25 GiB (28735 extents) to &lt;851.09 GiB (217878 extents).</span><br><span class="line">  Logical volume pve/root successfully resized.</span><br><span class="line"></span><br><span class="line">root@pve:~# resize2fs /dev/pve/root</span><br><span class="line">resize2fs 1.47.0 (5-Feb-2023)</span><br><span class="line">Filesystem at /dev/pve/root is mounted on /; on-line resizing required</span><br><span class="line">old_desc_blocks = 15, new_desc_blocks = 107</span><br><span class="line">The filesystem on /dev/pve/root is now 223107072 (4k) blocks long.</span><br></pre></td></tr></table></figure><p>Create a new <code>pve/data</code> volume:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lvcreate -L2920G -ndata pve</span><br><span class="line">  Logical volume &quot;data&quot; created.</span><br></pre></td></tr></table></figure><p>Check free disk space:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# vgdisplay</span><br><span class="line">  --- Volume group ---</span><br><span class="line">  VG Name               pve</span><br><span class="line">  System ID</span><br><span class="line">  Format                lvm2</span><br><span class="line">  Metadata Areas        1</span><br><span class="line">  Metadata Sequence No  126</span><br><span class="line">  VG Access             read/write</span><br><span class="line">  VG Status             resizable</span><br><span class="line">  MAX LV                0</span><br><span class="line">  Cur LV                3</span><br><span class="line">  Open LV               2</span><br><span class="line">  Max PV                0</span><br><span class="line">  Cur PV                1</span><br><span class="line">  Act PV                1</span><br><span class="line">  VG Size               &lt;3.73 TiB</span><br><span class="line">  PE Size               4.00 MiB</span><br><span class="line">  Total PE              976498</span><br><span class="line">  Alloc PE / Size       967446 / 3.69 TiB</span><br><span class="line">  Free  PE / Size       9052 / &lt;35.36 GiB</span><br><span class="line">  VG UUID               UEsIZR-TBsz-UYlP-u2FO-2AbC-uq4d-vcb35f</span><br></pre></td></tr></table></figure><p>Create thin pool volume of the metadata, usually size of 1% of <code>pve/data</code> volume:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lvconvert --type thin-pool --poolmetadatasize 36G pve/data</span><br><span class="line">  Reducing pool metadata size 36.00 GiB to maximum usable size &lt;15.88 GiB.</span><br><span class="line">  Thin pool volume with chunk size 64.00 KiB can address at most &lt;15.88 TiB of data.</span><br><span class="line">  WARNING: Converting pve/data to thin pool&#x27;s data volume with metadata wiping.</span><br><span class="line">  THIS WILL DESTROY CONTENT OF LOGICAL VOLUME (filesystem etc.)</span><br><span class="line">Do you really want to convert pve/data? [y/n]: y</span><br><span class="line">  Converted pve/data to thin pool.</span><br></pre></td></tr></table></figure><p>Verify current disk volumes, <code>pve/root</code> disk volume has more space now:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# df -h</span><br><span class="line">Filesystem            Size  Used Avail Use% Mounted on</span><br><span class="line">udev                   16G     0   16G   0% /dev</span><br><span class="line">tmpfs                 3.2G  1.8M  3.2G   1% /run</span><br><span class="line">/dev/mapper/pve-root  841G   71G  736G   9% /</span><br><span class="line">tmpfs                  16G   46M   16G   1% /dev/shm</span><br><span class="line">tmpfs                 5.0M     0  5.0M   0% /run/lock</span><br><span class="line">efivarfs               192K  114K   74K  61% /sys/firmware/efi/efivars</span><br><span class="line">/dev/nvme3n1p2       1022M   12M 1011M   2% /boot/efi</span><br><span class="line">/dev/fuse             128M   20K  128M   1% /etc/pve</span><br><span class="line">tmpfs                 3.2G     0  3.2G   0% /run/user/0</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lsblk</span><br><span class="line">NAME                         MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">sda                            8:0    0 223.6G  0 disk</span><br><span class="line">├─sda1                         8:1    0   100M  0 part</span><br><span class="line">├─sda2                         8:2    0    16M  0 part</span><br><span class="line">├─sda3                         8:3    0 120.3G  0 part</span><br><span class="line">├─sda4                         8:4    0   625M  0 part</span><br><span class="line">└─sda5                         8:5    0 102.5G  0 part</span><br><span class="line">nvme2n1                      259:0    0   3.6T  0 disk</span><br><span class="line">nvme4n1                      259:1    0   3.6T  0 disk</span><br><span class="line">nvme0n1                      259:2    0   3.6T  0 disk</span><br><span class="line">nvme1n1                      259:3    0   3.6T  0 disk</span><br><span class="line">nvme5n1                      259:4    0   3.6T  0 disk</span><br><span class="line">nvme3n1                      259:5    0   3.7T  0 disk</span><br><span class="line">├─nvme3n1p1                  259:6    0  1007K  0 part</span><br><span class="line">├─nvme3n1p2                  259:7    0     1G  0 part /boot/efi</span><br><span class="line">└─nvme3n1p3                  259:8    0   3.7T  0 part</span><br><span class="line">  ├─pve-swap                 252:0    0     8G  0 lvm  [SWAP]</span><br><span class="line">  ├─pve-root                 252:1    0 854.7G  0 lvm  /</span><br><span class="line">  ├─pve-data_tmeta           252:2    0  15.9G  0 lvm</span><br><span class="line">  │ └─pve-data-tpool         252:4    0   2.9T  0 lvm</span><br><span class="line">  │   ├─pve-data             252:5    0   2.9T  1 lvm</span><br><span class="line">  │   ├─pve-vm--100--disk--0 252:6    0   240G  0 lvm</span><br><span class="line">  │   ├─pve-vm--101--disk--0 252:7    0     4M  0 lvm</span><br><span class="line">  │   ├─pve-vm--101--disk--1 252:8    0   240G  0 lvm</span><br><span class="line">  │   ├─pve-vm--101--disk--2 252:9    0     4M  0 lvm</span><br><span class="line">  │   ├─pve-vm--102--disk--0 252:10   0     4M  0 lvm</span><br><span class="line">  │   ├─pve-vm--102--disk--1 252:11   0   240G  0 lvm</span><br><span class="line">  │   └─pve-vm--102--disk--2 252:12   0     4M  0 lvm</span><br><span class="line">  └─pve-data_tdata           252:3    0   2.9T  0 lvm</span><br><span class="line">    └─pve-data-tpool         252:4    0   2.9T  0 lvm</span><br><span class="line">      ├─pve-data             252:5    0   2.9T  1 lvm</span><br><span class="line">      ├─pve-vm--100--disk--0 252:6    0   240G  0 lvm</span><br><span class="line">      ├─pve-vm--101--disk--0 252:7    0     4M  0 lvm</span><br><span class="line">      ├─pve-vm--101--disk--1 252:8    0   240G  0 lvm</span><br><span class="line">      ├─pve-vm--101--disk--2 252:9    0     4M  0 lvm</span><br><span class="line">      ├─pve-vm--102--disk--0 252:10   0     4M  0 lvm</span><br><span class="line">      ├─pve-vm--102--disk--1 252:11   0   240G  0 lvm</span><br><span class="line">      └─pve-vm--102--disk--2 252:12   0     4M  0 lvm</span><br><span class="line"></span><br><span class="line">root@pve:~# lvs</span><br><span class="line">  LV            VG  Attr       LSize    Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  data          pve twi-aotz--    2.85t             3.19   0.32</span><br><span class="line">  root          pve -wi-ao---- &lt;854.69g</span><br><span class="line">  swap          pve -wi-ao----    8.00g</span><br><span class="line">  vm-100-disk-0 pve Vwi-a-tz--  240.00g data        10.38</span><br><span class="line">  vm-101-disk-0 pve Vwi-a-tz--    4.00m data        14.06</span><br><span class="line">  vm-101-disk-1 pve Vwi-a-tz--  240.00g data        19.50</span><br><span class="line">  vm-101-disk-2 pve Vwi-a-tz--    4.00m data        1.56</span><br><span class="line">  vm-102-disk-0 pve Vwi-a-tz--    4.00m data        14.06</span><br><span class="line">  vm-102-disk-1 pve Vwi-a-tz--  240.00g data        8.98</span><br><span class="line">  vm-102-disk-2 pve Vwi-a-tz--    4.00m data        1.56</span><br></pre></td></tr></table></figure><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li>Reduce size of local-lvm <em><a href="https://forum.proxmox.com/threads/reduce-size-of-local-lvm.78676/">https://forum.proxmox.com/threads/reduce-size-of-local-lvm.78676/</a></em></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;After a default installation, a tiny disk space given to &lt;code&gt;Proxmox&lt;/code&gt; root volume. Insufficient disk space issue raised up after </summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Proxmox and SR-IOV support for Intel GPU and Mellanox network adapter</title>
    <link href="https://terrencemiao.github.io/blog/2024/08/04/Proxmox-and-SR-IOV-support-for-Intel-GPU-and-Mellanox-network-adapter/"/>
    <id>https://terrencemiao.github.io/blog/2024/08/04/Proxmox-and-SR-IOV-support-for-Intel-GPU-and-Mellanox-network-adapter/</id>
    <published>2024-08-04T01:56:12.000Z</published>
    <updated>2024-09-17T00:03:53.347Z</updated>
    
    <content type="html"><![CDATA[<ul><li><p>Enable <code>VT-d</code>(Intel Virtualization Technology for Directed I&#x2F;O), for <code>IOMMU</code>(Input Output Memory Management Unit) services, and <code>SR-IOV</code> (Single Root IO Virtualization), a technology that allows a physical PCIe device to present itself multiple times through the PCIe bus, in motherboard BIOS in Chipset, e.g. <em>ASRock Z790 Riptide WiFi</em>.</p></li><li><p>Enable <code>SR-IOV</code> for Mellonax network adapter e.g. <em>Mellanox ConnectX-4 MCX455A-ECAT PCIe x16 3.0 100GBe VPI EDR IB</em> in the same motherboard BIOS.</p></li><li><p>Add Proxmox No Subscription URL:</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# cat /etc/apt/sources.list</span><br><span class="line">deb http://ftp.au.debian.org/debian bookworm main contrib</span><br><span class="line"></span><br><span class="line">deb http://ftp.au.debian.org/debian bookworm-updates main contrib</span><br><span class="line"></span><br><span class="line"># security updates</span><br><span class="line">deb http://security.debian.org bookworm-security main contrib</span><br><span class="line"></span><br><span class="line"># Proxmox VE pve-no-subscription repository provided by proxmox.com,</span><br><span class="line"># NOT recommended for production use</span><br><span class="line">deb http://download.proxmox.com/debian/pve bookworm pve-no-subscription</span><br></pre></td></tr></table></figure><p>and run packages update:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# apt update</span><br></pre></td></tr></table></figure><p>and install all build tools:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# apt install build-* dkms</span><br></pre></td></tr></table></figure><ul><li>Set&#x2F;Pin Proxmox kernel version:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# proxmox-boot-tool kernel pin 6.8.4-2-pve</span><br><span class="line">Setting &#x27;6.8.4-2-pve&#x27; as grub default entry and running update-grub.</span><br><span class="line">Generating grub configuration file ...</span><br><span class="line">Found linux image: /boot/vmlinuz-6.8.4-2-pve</span><br><span class="line">Found initrd image: /boot/initrd.img-6.8.4-2-pve</span><br><span class="line">Found memtest86+ 64bit EFI image: /boot/memtest86+x64.efi</span><br><span class="line">Adding boot menu entry for UEFI Firmware Settings ...</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>and verify Proxmox kernal version:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# proxmox-boot-tool kernel list</span><br><span class="line">Manually selected kernels:</span><br><span class="line">None.</span><br><span class="line"></span><br><span class="line">Automatically selected kernels:</span><br><span class="line">6.8.4-2-pve</span><br><span class="line"></span><br><span class="line">Pinned kernel:</span><br><span class="line">6.8.4-2-pve</span><br></pre></td></tr></table></figure><ul><li>Install Proxmox kernel headers source code package:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# apt install proxmox-headers-6.8.4-2-pve</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree... Done</span><br><span class="line">Reading state information... Done</span><br><span class="line">The following NEW packages will be installed:</span><br><span class="line">  proxmox-headers-6.8.4-2-pve</span><br><span class="line">0 upgraded, 1 newly installed, 0 to remove and 39 not upgraded.</span><br><span class="line">Need to get 13.7 MB of archives.</span><br><span class="line">After this operation, 97.0 MB of additional disk space will be used.</span><br><span class="line">Get:1 http://download.proxmox.com/debian/pve bookworm/pve-no-subscription amd64 proxmox-headers-6.8.4-2-pve amd64 6.8.4-2 [13.7 MB]</span><br><span class="line">Fetched 13.7 MB in 1s (23.8 MB/s)</span><br><span class="line">Selecting previously unselected package proxmox-headers-6.8.4-2-pve.</span><br><span class="line">(Reading database ... 70448 files and directories currently installed.)</span><br><span class="line">Preparing to unpack .../proxmox-headers-6.8.4-2-pve_6.8.4-2_amd64.deb ...</span><br><span class="line">Unpacking proxmox-headers-6.8.4-2-pve (6.8.4-2) ...</span><br><span class="line">Setting up proxmox-headers-6.8.4-2-pve (6.8.4-2) ...</span><br></pre></td></tr></table></figure><ul><li>Download <code>Linux i915 driver with SR-IOV</code> support for Linux kernel:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# git clone https://github.com/strongtz/i915-sriov-dkms</span><br></pre></td></tr></table></figure><p>and change into the cloned repository and run:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~/i915-sriov-dkms# cat VERSION</span><br><span class="line">2024.07.24</span><br><span class="line"></span><br><span class="line">root@pve:~/i915-sriov-dkms# dkms add .</span><br><span class="line">Creating symlink /var/lib/dkms/i915-sriov-dkms/2024.07.24/source -&gt; /usr/src/i915-sriov-dkms-2024.07.24</span><br></pre></td></tr></table></figure><p>and build, install <code>i915-sriov-dkms</code> Linux kernel module:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~/i915-sriov-dkms# dkms install -m i915-sriov-dkms -v $(cat VERSION) --force</span><br><span class="line">Sign command: /lib/modules/6.8.4-2-pve/build/scripts/sign-file</span><br><span class="line">Signing key: /var/lib/dkms/mok.key</span><br><span class="line">Public certificate (MOK): /var/lib/dkms/mok.pub</span><br><span class="line">Certificate or key are missing, generating self signed certificate for MOK...</span><br><span class="line"></span><br><span class="line">Building module:</span><br><span class="line">Cleaning build area...</span><br><span class="line">make -j20 KERNELRELEASE=6.8.4-2-pve -C /lib/modules/6.8.4-2-pve/build M=/var/lib/dkms/i915-sriov-dkms/2024.07.24/build.......</span><br><span class="line">Signing module /var/lib/dkms/i915-sriov-dkms/2024.07.24/build/i915.ko</span><br><span class="line">Cleaning build area...</span><br><span class="line"></span><br><span class="line">i915.ko:</span><br><span class="line">Running module version sanity check.</span><br><span class="line"> - Original module</span><br><span class="line"> - Installation</span><br><span class="line">   - Installing to /lib/modules/6.8.4-2-pve/updates/dkms/</span><br><span class="line">depmod...</span><br></pre></td></tr></table></figure><p>and enable <code>i915-sriov-dkms</code> module with upto maximum <strong>7</strong> VFS (Virtual File System) in Linux kernel:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# cat /etc/default/grub | grep GRUB_CMDLINE_LINUX_DEFAULT</span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on i915.enable_guc=3 i915.max_vfs=7&quot;</span><br></pre></td></tr></table></figure><ul><li>Reboot Proxmox:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lspci | grep VGA</span><br><span class="line">00:02.0 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br><span class="line">00:02.1 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br><span class="line">00:02.2 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br><span class="line">00:02.3 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br><span class="line">00:02.4 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br><span class="line">00:02.5 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br><span class="line">00:02.6 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br><span class="line">00:02.7 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br></pre></td></tr></table></figure><p>First VGA <code>00:02.0</code> is the <strong>REAL</strong> GPU. Other <strong>7</strong> are <strong>Virtual</strong> ones.</p><p>Verify IOMMU has been enabled:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# dmesg | grep -i iommu</span><br><span class="line">[    0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-6.8.4-2-pve root=/dev/mapper/pve-root ro quiet intel_iommu=on i915.enable_guc=3 i915.max_vfs=7</span><br><span class="line">[    0.036486] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-6.8.4-2-pve root=/dev/mapper/pve-root ro quiet intel_iommu=on i915.enable_guc=3 i915.max_vfs=7</span><br><span class="line">[    0.036515] DMAR: IOMMU enabled</span><br><span class="line">[    0.090320] DMAR-IR: IOAPIC id 2 under DRHD base  0xfed91000 IOMMU 1</span><br><span class="line">[    0.244292] pci 0000:00:02.0: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    0.270125] iommu: Default domain type: Translated</span><br><span class="line">[    0.270125] iommu: DMA domain TLB invalidation policy: lazy mode</span><br><span class="line">[    0.303735] DMAR: IOMMU feature fl1gp_support inconsistent</span><br><span class="line">[    0.303735] DMAR: IOMMU feature pgsel_inv inconsistent</span><br><span class="line">[    0.303736] DMAR: IOMMU feature nwfs inconsistent</span><br><span class="line">[    0.303736] DMAR: IOMMU feature dit inconsistent</span><br><span class="line">[    0.303737] DMAR: IOMMU feature sc_support inconsistent</span><br><span class="line">[    0.303737] DMAR: IOMMU feature dev_iotlb_support inconsistent</span><br><span class="line">[    0.304175] pci 0000:00:02.0: Adding to iommu group 0</span><br><span class="line">[    0.304544] pci 0000:00:00.0: Adding to iommu group 1</span><br><span class="line">[    0.304554] pci 0000:00:01.0: Adding to iommu group 2</span><br><span class="line">[    0.304562] pci 0000:00:01.1: Adding to iommu group 3</span><br><span class="line">[    0.304570] pci 0000:00:06.0: Adding to iommu group 4</span><br><span class="line">[    0.304582] pci 0000:00:14.0: Adding to iommu group 5</span><br><span class="line">[    0.304589] pci 0000:00:14.2: Adding to iommu group 5</span><br><span class="line">[    0.304598] pci 0000:00:15.0: Adding to iommu group 6</span><br><span class="line">[    0.304607] pci 0000:00:16.0: Adding to iommu group 7</span><br><span class="line">[    0.304614] pci 0000:00:17.0: Adding to iommu group 8</span><br><span class="line">[    0.304630] pci 0000:00:1a.0: Adding to iommu group 9</span><br><span class="line">[    0.304641] pci 0000:00:1b.0: Adding to iommu group 10</span><br><span class="line">[    0.304651] pci 0000:00:1c.0: Adding to iommu group 11</span><br><span class="line">[    0.304662] pci 0000:00:1c.1: Adding to iommu group 12</span><br><span class="line">[    0.304671] pci 0000:00:1c.2: Adding to iommu group 13</span><br><span class="line">[    0.304681] pci 0000:00:1c.3: Adding to iommu group 14</span><br><span class="line">[    0.304692] pci 0000:00:1c.4: Adding to iommu group 15</span><br><span class="line">[    0.304703] pci 0000:00:1d.0: Adding to iommu group 16</span><br><span class="line">[    0.304721] pci 0000:00:1f.0: Adding to iommu group 17</span><br><span class="line">[    0.304728] pci 0000:00:1f.3: Adding to iommu group 17</span><br><span class="line">[    0.304735] pci 0000:00:1f.4: Adding to iommu group 17</span><br><span class="line">[    0.304742] pci 0000:00:1f.5: Adding to iommu group 17</span><br><span class="line">[    0.304750] pci 0000:01:00.0: Adding to iommu group 18</span><br><span class="line">[    0.304758] pci 0000:02:00.0: Adding to iommu group 19</span><br><span class="line">[    0.304765] pci 0000:03:00.0: Adding to iommu group 20</span><br><span class="line">[    0.304781] pci 0000:04:00.0: Adding to iommu group 21</span><br><span class="line">[    0.304791] pci 0000:05:00.0: Adding to iommu group 22</span><br><span class="line">[    0.304801] pci 0000:06:00.0: Adding to iommu group 23</span><br><span class="line">[    0.304810] pci 0000:07:00.0: Adding to iommu group 24</span><br><span class="line">[    0.304834] pci 0000:08:00.0: Adding to iommu group 25</span><br><span class="line">[    0.304845] pci 0000:09:00.0: Adding to iommu group 26</span><br><span class="line">[    0.304857] pci 0000:0a:00.0: Adding to iommu group 27</span><br><span class="line">[    0.304866] pci 0000:0b:00.0: Adding to iommu group 28</span><br><span class="line">[    4.659395] pci 0000:00:02.1: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    4.659438] pci 0000:00:02.1: Adding to iommu group 29</span><br><span class="line">[    4.664441] pci 0000:00:02.2: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    4.664479] pci 0000:00:02.2: Adding to iommu group 30</span><br><span class="line">[    4.667692] pci 0000:00:02.3: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    4.667727] pci 0000:00:02.3: Adding to iommu group 31</span><br><span class="line">[    4.671096] pci 0000:00:02.4: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    4.671129] pci 0000:00:02.4: Adding to iommu group 32</span><br><span class="line">[    4.673545] pci 0000:00:02.5: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    4.673572] pci 0000:00:02.5: Adding to iommu group 33</span><br><span class="line">[    4.676357] pci 0000:00:02.6: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    4.676402] pci 0000:00:02.6: Adding to iommu group 34</span><br><span class="line">[    4.679192] pci 0000:00:02.7: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    4.679221] pci 0000:00:02.7: Adding to iommu group 35</span><br></pre></td></tr></table></figure><ul><li>Enable Virtual GPU for <code>Windows 11</code> VM in Proxmox</li></ul><p>Add a PCI device for <code>Windows 11</code> VM, and choose one Virtual GPU:</p><p><img src="/blog/img/Proxmox%20-%20Windows%2011,%20PCI%20device.png" alt="Proxmox - Windows 11, PCI device" title="Proxmox - Windows 11, PCI device"></p><p>Enable <code>Primary GPU</code> and <code>PCI Express</code> in options:</p><p><img src="/blog/img/Proxmox%20-%20Windows%2011,%20Primary%20GPU%20and%20PCI%20Express.png" alt="Proxmox - Windows 11, Primary GPU and PCI Express" title="Proxmox - Windows 11, Primary GPU and PCI Express"></p><p>Choose <code>none</code> in Display and <code>host</code> in Processors options for <code>Windows 11</code> VM:</p><p><img src="/blog/img/Proxmox%20-%20Windows%2011,%20Display.png" alt="Proxmox - Windows 11, Display" title="Proxmox - Windows 11, Display"></p><p><img src="/blog/img/Proxmox%20-%20Windows%2011,%20Display%20none.png" alt="Proxmox - Windows 11, Display none" title="Proxmox - Windows 11, Display none"></p><p>Start <code>Windows 11</code> VM, login with <code>Microsoft Remote Desktop</code> <em><a href="https://apps.microsoft.com/detail/9wzdncrfj3ps">https://apps.microsoft.com/detail/9wzdncrfj3ps</a></em> and a Virtual GPU is available now. Run <code>Task Manager</code> and check CPU and GPU load:</p><p><img src="/blog/img/Proxmox%20-%20Windows%2011,%20Performance.png" alt="Proxmox - Windows 11, Performance" title="Proxmox - Windows 11, Performance"></p><ul><li>Enable Virtual GPU for <code>Ubuntu</code> VM in Proxmox</li></ul><p>Ubuntu version 22.04.4 for desktop.</p><p>Add a PCI device for <code>Ubuntu</code> VM, and choose one Virtual GPU; Enable <code>Primary GPU</code> and <code>PCI Express</code> in options; Choose <code>none</code> in Display and <code>host</code> in Processors options:</p><p><img src="/blog/img/Proxmox%20-%20Ubuntu.png" alt="Proxmox - Ubuntu" title="Proxmox - Ubuntu"></p><p>Setup remote desktop connection to Ubuntu:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@nucleus:~# apt install ubuntu-desktop</span><br><span class="line"></span><br><span class="line">root@nucleus:~# apt install xrdp</span><br><span class="line"></span><br><span class="line">root@nucleus:~# systemctl enable xrdp</span><br></pre></td></tr></table></figure><p><img src="/blog/img/Proxmox%20-%20Remote%20Desktop.png" alt="Proxmox - Remote Desktop" title="Proxmox - Remote Desktop"></p><ul><li>Fix Remote Desktop audio over HDMI issue with the script, enable the sound redirection:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terrence@nucleus:~$ ./xrdp-installer-1.5.1.sh -s</span><br></pre></td></tr></table></figure><p>then reboot VM.</p><p><img src="/blog/img/Proxmox%20-%20Ubuntu%20Remote%20Desktop.png" alt="Proxmox - Ubuntu Remote Desktop" title="Proxmox - Ubuntu Remote Desktop"></p><p>Now Audio device becomes xrdp input &#x2F; output.</p><ul><li>Windows Server 2022</li></ul><p>Windows Server 2022 is similar to Windows 11 setup in Proxmox. A few issues like <strong>GPU</strong>:</p><p><img src="/blog/img/Proxmox%20-%20Windows%20Server%202022,%20GPU.png" alt="Proxmox - Windows Server 2022, GPU" title="Proxmox - Windows Server 2022, GPU"></p><p>just disable GPU then enable it, it will work correctly.</p><p>And no sound after installation, but can enable <strong>Windows Audio Service</strong> and choose <strong>Remote Audio</strong>:</p><p><img src="/blog/img/Proxmox%20-%20Windows%20Server%202022,%20Sound.png" alt="Proxmox - Windows Server 2022, Sound" title="Proxmox - Windows Server 2022, Sound"></p><p>then audio over HDMI to remote desktop can work.</p><p>In addition, can setup User Auto Logon after Windows Server 2022 startup. And check Windows license by running:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\Administrator&gt; slmgr -dlv</span><br></pre></td></tr></table></figure><p>Now can remote desktop access Ubuntu, Windows 11 and Windows Server 2022 VMs both run in Proxmox:</p><p><img src="/blog/img/Proxmox%20-%20Ubuntu%20and%20Windows.jpg" alt="Proxmox - Ubuntu and Windows" title="Proxmox - Ubuntu and Windows"></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li>最新保姆级 PVE 8 安装教程！虚拟机 PCIE 设备及 SR-IOV 核显直通，最多分配7个虚拟化单独核显！最强虚拟机！<em><a href="https://v2rayssr.com/pve.html">https://v2rayssr.com/pve.html</a></em></li><li>PVE 8.1 下部署 Intel 集显虚拟化驱动 <em><a href="https://zoe.red/2023/38.html">https://zoe.red/2023/38.html</a></em></li><li>定制 OVMF 固件实现 PVE 8 环境 UEFI 模式直通 Intel 核显并显示 BIOS 适用于 intel 6-13 代处理器 PVE 8 核显直通画面 Windows 10 and MacOS 系统画面显示教程，可以外接显示器 <em><a href="https://imacos.top/2023/10/09/152/">https://imacos.top/2023/10/09/152/</a></em></li><li>PVE 下如何启用 PCI 直通显卡 GPU&#x2F;iGPU&#x2F;USB&#x2F;声卡 AUDIO 等硬件直通教程 <em><a href="https://imacos.top/2023/07/31/pci/">https://imacos.top/2023/07/31/pci/</a></em></li><li>Enable &amp; Using vGPU Passthrough <em><a href="https://gist.github.com/scyto/e4e3de35ee23fdb4ae5d5a3b85c16ed3">https://gist.github.com/scyto/e4e3de35ee23fdb4ae5d5a3b85c16ed3</a></em></li><li>Proxmox VE: Passthrough with Intel Integrated Graphics Card Alder Lake Architecture | vGPU, VT-d, SR-IOV <em><a href="https://github.com/kamilllooo/Proxmox">https://github.com/kamilllooo/Proxmox</a></em></li><li>Remote Desktop connection from Mac to Ubuntu <em><a href="https://askubuntu.com/questions/893831/remote-desktop-connection-from-mac-to-ubuntu">https://askubuntu.com/questions/893831/remote-desktop-connection-from-mac-to-ubuntu</a></em></li><li>xRDP – Easy install xRDP on Ubuntu 20.04,22.04,23.XX,24.04 (Script Version 1.5.1) <em><a href="https://c-nergy.be/blog/?p=19814">https://c-nergy.be/blog/?p=19814</a></em></li><li>Autologon User at Startup in Windows Server <em><a href="https://jc-lan.org/2022/06/02/autologon-user-at-startup-in-windows-server/">https://jc-lan.org/2022/06/02/autologon-user-at-startup-in-windows-server/</a></em></li><li>Windows Server 2022 audio available but not playing <em><a href="https://answers.microsoft.com/en-us/windowserver/forum/all/windows-server-2022-audio-available-but-not/eca821f1-7b4a-4293-8273-fda49dd0e9d4">https://answers.microsoft.com/en-us/windowserver/forum/all/windows-server-2022-audio-available-but-not/eca821f1-7b4a-4293-8273-fda49dd0e9d4</a></em></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Enable &lt;code&gt;VT-d&lt;/code&gt;(Intel Virtualization Technology for Directed I&amp;#x2F;O), for &lt;code&gt;IOMMU&lt;/code&gt;(Input Output Memory Mana</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>The solution making old Intel 10Gbps network adapter work in Windows 11</title>
    <link href="https://terrencemiao.github.io/blog/2024/05/20/The-solution-making-old-Intel-10Gbps-network-adapter-work-in-Windows-11/"/>
    <id>https://terrencemiao.github.io/blog/2024/05/20/The-solution-making-old-Intel-10Gbps-network-adapter-work-in-Windows-11/</id>
    <published>2024-05-20T12:27:09.000Z</published>
    <updated>2024-05-20T12:52:52.040Z</updated>
    
    <content type="html"><![CDATA[<p>Buy some old Intel 10Gbps network adapter, <code>X520</code>, <code>X540</code> … from AliExpress <em><a href="https://aliexpress.com/">https://aliexpress.com/</a></em>, and install old Intel network adapter driver for Windows 10 and make it working in Windows 11. The example is install version 25.0 Intel network adapter driver, <em><a href="https://www.intel.com/content/www/us/en/download/18293/29648/intel-network-adapter-driver-for-windows-10.html">https://www.intel.com/content/www/us/en/download/18293/29648/intel-network-adapter-driver-for-windows-10.html</a></em>, to get it to work in Windows 11:</p><ul><li><p>Intel network adapters supported Operating Systems, <em><a href="https://www.intel.com/content/www/us/en/support/articles/000025890/ethernet-products.html">https://www.intel.com/content/www/us/en/support/articles/000025890/ethernet-products.html</a></em></p></li><li><p>Buy dual ports 10Gbps network adapter</p></li><li><p>Install the network adapter in PCIE slot directly to the CPU</p></li><li><p>Enable SMB Multichannel</p></li><li><p>Enable Jumbo Frames</p></li></ul><iframe width="560" height="315" src="https://www.youtube.com/embed/WDPblqez00s?si=fs4-wswGT5AzDWMK&amp;start=222" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Buy some old Intel 10Gbps network adapter, &lt;code&gt;X520&lt;/code&gt;, &lt;code&gt;X540&lt;/code&gt; … from AliExpress &lt;em&gt;&lt;a href=&quot;https://aliexpress.com/&quot;&gt;h</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>How to enable SMB Multichannel in Windows 11</title>
    <link href="https://terrencemiao.github.io/blog/2024/05/17/How-to-enable-SMB-Multichannel-in-Windows-11/"/>
    <id>https://terrencemiao.github.io/blog/2024/05/17/How-to-enable-SMB-Multichannel-in-Windows-11/</id>
    <published>2024-05-17T12:38:27.000Z</published>
    <updated>2024-05-17T13:12:21.219Z</updated>
    
    <content type="html"><![CDATA[<p>Network adapter requires to support <strong>RSS (Receive Side Scaling)</strong>.</p><p><img src="/blog/img/RSS%20-%20Receive%20Side%20Scaling.png" alt="RSS (Receive Side Scaling)" title="RSS (Receive Side Scaling)"></p><ul><li>Open PowerShell as administrator in Windows 11, run and enable SMB Multichannel (should be enabled by default):</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">Set-SmbClientConfiguration</span> <span class="literal">-EnableMultiChannel</span> <span class="variable">$true</span></span><br><span class="line"></span><br><span class="line">Confirm</span><br><span class="line">Are you sure you want to perform this action?</span><br><span class="line">Performing operation <span class="string">&#x27;Modify&#x27;</span> on Target <span class="string">&#x27;SMB Client Configuration&#x27;</span>.</span><br><span class="line"><span class="function">[<span class="type">Y</span>] <span class="title">Yes</span></span>  <span class="function">[<span class="type">A</span>] <span class="title">Yes</span></span> to All  <span class="function">[<span class="type">N</span>] <span class="title">No</span></span>  <span class="function">[<span class="type">L</span>] <span class="title">No</span></span> to All  <span class="function">[<span class="type">S</span>] <span class="title">Suspend</span></span>  <span class="function">[?] <span class="title">Help</span></span> (default is <span class="string">&quot;Y&quot;</span>):</span><br></pre></td></tr></table></figure><p>Check network interfaces which show “<strong>RSS capable &#x3D; True</strong>“:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">Get-SmbClientNetworkInterface</span></span><br><span class="line"></span><br><span class="line">Interface Index RSS Capable RDMA Capable Speed   IpAddresses                               Friendly Name</span><br><span class="line"><span class="literal">---------------</span> <span class="literal">-----------</span> <span class="literal">------------</span> <span class="literal">-----</span>   <span class="literal">-----------</span>                               <span class="literal">-------------</span></span><br><span class="line"><span class="number">17</span>              True        False        <span class="number">20</span> Gbps &#123;&#125;                                        X710<span class="literal">-1-WFP</span> Native MAC Layer LightWeight <span class="keyword">Filter</span><span class="literal">-0000</span></span><br><span class="line"><span class="number">8</span>               False       False        <span class="number">10</span> Gbps &#123;&#125;                                        X710<span class="literal">-1</span></span><br><span class="line"><span class="number">13</span>              False       False        <span class="number">10</span> Gbps &#123;&#125;                                        X710<span class="literal">-2</span></span><br><span class="line"><span class="number">26</span>              True        False        <span class="number">20</span> Gbps &#123;fe80::<span class="number">923</span>a:<span class="number">90</span>de:dedd:ef44, <span class="number">192.168</span>.<span class="number">0.98</span>&#125; NIC<span class="literal">-Team</span></span><br></pre></td></tr></table></figure><ul><li>Verify there are any active SMB connections:</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">Get-SmbConnection</span></span><br><span class="line"></span><br><span class="line">ServerName ShareName UserName         Credential                               Dialect NumOpens</span><br><span class="line"><span class="literal">----------</span> <span class="literal">---------</span> <span class="literal">--------</span>         <span class="literal">----------</span>                               <span class="literal">-------</span> <span class="literal">--------</span></span><br><span class="line">Synology   NAS Drive RIPTIDE\terrence MicrosoftAccount\terrence.miao@mail.net  <span class="number">3.1</span>.<span class="number">1</span>   <span class="number">2</span></span><br></pre></td></tr></table></figure><ul><li>Copy a large file to a SMB device, e.g., Synology NAS which also has SMB Multichannel enabled, then verify the SMB Multichannel is working:</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">Get-SmbMultichannelConnection</span> <span class="literal">-IncludeNotSelected</span></span><br><span class="line"></span><br><span class="line">Server Name Selected Client IP    Server IP       Client Interface Index Server Interface Index Client RSS Capable Client RDMA Capable</span><br><span class="line"><span class="literal">-----------</span> <span class="literal">--------</span> <span class="literal">---------</span>    <span class="literal">---------</span>       <span class="literal">----------------------</span> <span class="literal">----------------------</span> <span class="literal">------------------</span> <span class="literal">-------------------</span></span><br><span class="line">Synology    True     <span class="number">192.168</span>.<span class="number">0.98</span> <span class="number">192.168</span>.<span class="number">0.112</span>   <span class="number">26</span>                     <span class="number">5</span>                      False              False</span><br><span class="line">Synology    False    <span class="number">192.168</span>.<span class="number">0.98</span> <span class="number">192.168</span>.<span class="number">0.34</span>    <span class="number">26</span>                     <span class="number">4</span>                      False              False</span><br><span class="line">Synology    False    <span class="number">192.168</span>.<span class="number">0.98</span> <span class="number">192.168</span>.<span class="number">196.140</span> <span class="number">26</span>                     <span class="number">7</span>                      False              False</span><br></pre></td></tr></table></figure><p><code>192.168.0.98</code> is Windows 11 network address, after Network Teaming; <code>192.168.0.112</code> and <code>192.168.0.34</code> are Synology NAS network addresses.</p><p><img src="/blog/img/With%20and%20without%20multichannel.png" alt="With and without multichannel" title="With and without multichannel"></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li>HOW TO: Enable SMB Multichannel for &gt; 125 MB between Synology and Win 10, <em><a href="https://www.reddit.com/r/synology/comments/rrb4r1/how_to_enable_smb_multichannel_for_125_mb_between/">https://www.reddit.com/r/synology/comments/rrb4r1/how_to_enable_smb_multichannel_for_125_mb_between/</a></em></li><li>What is SMB3 Multichannel and how is it different from Link Aggregation?, <em><a href="https://kb.synology.com/en-global/DSM/tutorial/smb3_multichannel_link_aggregation">https://kb.synology.com/en-global/DSM/tutorial/smb3_multichannel_link_aggregation</a></em></li><li>SMB Multichannel available for testing!, <em><a href="https://community.synology.com/enu/forum/1/post/157265">https://community.synology.com/enu/forum/1/post/157265</a></em></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Network adapter requires to support &lt;strong&gt;RSS (Receive Side Scaling)&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/img/RSS%20-%20Receive%20Side%20Sc</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>How to upgrade Synology NAS network from 1Gbps to 2.5Gbps</title>
    <link href="https://terrencemiao.github.io/blog/2024/05/17/How-to-upgrade-Synology-NAS-network-from-1Gbps-to-2-5Gbps/"/>
    <id>https://terrencemiao.github.io/blog/2024/05/17/How-to-upgrade-Synology-NAS-network-from-1Gbps-to-2-5Gbps/</id>
    <published>2024-05-17T10:25:45.000Z</published>
    <updated>2024-08-04T01:52:29.905Z</updated>
    
    <content type="html"><![CDATA[<p>Synology NAS DS920+ with two 1Gbps ethernet adapters. There is an affordable and easy upgrading its gigabytes network path to 2.5Gbps.</p><p>Login Synology NAS Admin UI and run <strong>Control Panel</strong> -&gt; <strong>Network</strong> -&gt; <strong>Network Interface</strong></p><p><img src="/blog/img/Synology%20NAS%20network%20upgrade%20-%20installation%20before.png" alt="Installation before" title="Installation before"></p><ul><li>Get a USB 3.0 Ethernet Adapter 2.5Gbps with <strong>Realtek RTL8156 &#x2F; RTL8156B &#x2F; RTL8156BG</strong>  chipset, e.g., UGREEN 2.5Gbps USB-C Ethernet Adapter:</li></ul><p><img src="/blog/img/UGREEN%202.5Gbps%20USB-C%20Ethernet%20Adapter.jpg" alt="UGREEN 2.5Gbps USB-C Ethernet Adapter" title="UGREEN 2.5Gbps USB-C Ethernet Adapter"></p><ul><li><p>Find out the architecture name of CPU in NAS. For example, Synology DS920+ is equipped with Intel Celeron J4125 CPU. The architecture name of this processor is <code>Geminilake</code>.</p></li><li><p>Go to driver releases site <em><a href="https://github.com/bb-qq/r8152/releases">https://github.com/bb-qq/r8152/releases</a></em> and download the latest version e.g. <code>r8152-geminilake-2.17.1-1_7.2.spk</code>, Synology DSM 7.2 and above, use packages with the suffix <strong>_7.2</strong>.</p></li><li><p>Login Synology Admin UI, then go to <strong>Package Center</strong> -&gt; <strong>Manual Install</strong> and choose a driver package downloaded from above step.</p></li></ul><p><img src="/blog/img/Synology%20NAS%20network%20upgrade%20-%20package%20installation.png" alt="Package installation" title="Package installation"></p><p><img src="/blog/img/Synology%20NAS%20network%20upgrade%20-%20installation%20warning.png" alt="Installation warning" title="Installation warning"></p><p><img src="/blog/img/Synology%20NAS%20network%20upgrade%20-%20installation%20confirmation.png" alt="Installation confirmation" title="Installation confirmation"></p><ul><li>The installation will fail at the very first time.</li></ul><p><img src="/blog/img/Synology%20NAS%20network%20upgrade%20-%20installation%20failed.png" alt="Installation failed" title="Installation failed"></p><ul><li>Then <code>ssh</code> into the NAS, and run the following command:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo install -m 4755 -o root -D /var/packages/r8152/target/r8152/spk_su /opt/sbin/spk_su</span><br></pre></td></tr></table></figure><p>and also enable multiple identical USB devices, which SAME products have the SAME serial number:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo bash /var/packages/r8152/scripts/install-udev-rules</span><br></pre></td></tr></table></figure><p><img src="/blog/img/Synology%20NAS%20network%20upgrade%20-%20installation%20fix.png" alt="Installation fix" title="Installation fix"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo bash /var/packages/r8152/scripts/install-udev-rules</span><br><span class="line">Updating Hardware Database Index...</span><br><span class="line">UDEV rules have been installed to /usr/lib/udev/rules.d</span><br><span class="line">lrwxrwxrwx 1 root root 50 May 24 17:13 /usr/lib/udev/rules.d/51-usb-r8152-net.rules -&gt; /var/packages/r8152/scripts/51-usb-r8152-net.rules</span><br></pre></td></tr></table></figure><p>and continue &#x2F; retry the installation .</p><ul><li><p>Reboot NAS.</p></li><li><p>Login Synology Admin UI, <strong>Package Center</strong> -&gt; <strong>Installed</strong> -&gt; <strong>RTL8152&#x2F;RTL8153 driver</strong> and check new installed Realtek network adapter driver is running:</p></li></ul><p><img src="/blog/img/Synology%20NAS%20network%20upgrade%20-%20running.png" alt="Running" title="Running"></p><ul><li><strong>Control Panel</strong> -&gt; <strong>Network</strong> -&gt; <strong>Network Interface</strong> and check the new network interface <code>LAN 3</code> and <code>Lan 4</code> have been turned on, with MTU &#x2F; jumbo frame enabled <strong>9000</strong>:</li></ul><p><img src="/blog/img/Synology%20NAS%20network%20upgrade%20-%20new%20network%20interface.png" alt="New network interface" title="New network interface"></p><p>Bind the USB network adapter and run <code>iperf3</code> network performance test:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ iperf3 -c 192.168.0.244 -B 192.168.0.229</span><br><span class="line">Connecting to host 192.168.0.244, port 5201</span><br><span class="line">[  5] local 192.168.0.229 port 46171 connected to 192.168.0.244 port 5201</span><br><span class="line">[ ID] Interval           Transfer     Bitrate         Retr  Cwnd</span><br><span class="line">[  5]   0.00-1.00   sec   281 MBytes  2.36 Gbits/sec    0    450 KBytes</span><br><span class="line">[  5]   1.00-2.00   sec   281 MBytes  2.35 Gbits/sec    0    450 KBytes</span><br><span class="line">[  5]   2.00-3.00   sec   280 MBytes  2.35 Gbits/sec    0    450 KBytes</span><br><span class="line">[  5]   3.00-4.00   sec   281 MBytes  2.35 Gbits/sec    0    450 KBytes</span><br><span class="line">[  5]   4.00-5.00   sec   281 MBytes  2.35 Gbits/sec    0    450 KBytes</span><br><span class="line">[  5]   5.00-6.00   sec   281 MBytes  2.35 Gbits/sec    0    450 KBytes</span><br><span class="line">[  5]   6.00-7.00   sec   281 MBytes  2.35 Gbits/sec    0    450 KBytes</span><br><span class="line">[  5]   7.00-8.00   sec   280 MBytes  2.35 Gbits/sec    0    450 KBytes</span><br><span class="line">[  5]   8.00-9.00   sec   281 MBytes  2.36 Gbits/sec    0    450 KBytes</span><br><span class="line">[  5]   9.00-10.00  sec   281 MBytes  2.36 Gbits/sec    0    670 KBytes</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[ ID] Interval           Transfer     Bitrate         Retr</span><br><span class="line">[  5]   0.00-10.00  sec  2.74 GBytes  2.35 Gbits/sec    0             sender</span><br><span class="line">[  5]   0.00-10.05  sec  2.74 GBytes  2.34 Gbits/sec                  receiver</span><br><span class="line"></span><br><span class="line">iperf Done.</span><br></pre></td></tr></table></figure><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li>DSM driver for realtek RTL8152&#x2F;RTL8153&#x2F;RTL8156 based USB Ethernet adapters, <em><a href="https://github.com/bb-qq/r8152">https://github.com/bb-qq/r8152</a></em></li><li>Hot plugging does not work, <em><a href="https://github.com/bb-qq/r8152/wiki/Troubleshooting#hot-plugging-does-not-work">https://github.com/bb-qq/r8152/wiki/Troubleshooting#hot-plugging-does-not-work</a></em></li><li>Multiple identical devices do not work, <em><a href="https://github.com/bb-qq/r8152/wiki/Troubleshooting#multiple-identical-devices-do-not-work">https://github.com/bb-qq/r8152/wiki/Troubleshooting#multiple-identical-devices-do-not-work</a></em></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Synology NAS DS920+ with two 1Gbps ethernet adapters. There is an affordable and easy upgrading its gigabytes network path to 2.5Gbps.&lt;/p</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>How to team network (link aggregation) in Windows 11</title>
    <link href="https://terrencemiao.github.io/blog/2024/05/03/How-to-team-network-link-aggregation-in-Windows-11/"/>
    <id>https://terrencemiao.github.io/blog/2024/05/03/How-to-team-network-link-aggregation-in-Windows-11/</id>
    <published>2024-05-03T11:40:36.000Z</published>
    <updated>2024-05-15T11:56:00.374Z</updated>
    
    <content type="html"><![CDATA[<p>Intel Ethernet Converged Network Adapter X710, with two 10Gbps ports. This allows to team the two ports together for link aggregation.</p><ul><li>Install Optional Features <code>Server Manager</code> in Windows 11</li></ul><p><img src="/blog/img/Network%20Team%20-%20Server%20Manager.png" alt="Server Manager" title="Server Manager"></p><ul><li>Open and run Windows Powershell as administrator, then run:</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">New-NetSwitchTeam</span> <span class="literal">-Name</span> <span class="string">&quot;NIC-Team&quot;</span> <span class="literal">-TeamMembers</span> <span class="string">&quot;X710-1&quot;</span>,<span class="string">&quot;X710-2&quot;</span></span><br></pre></td></tr></table></figure><p><img src="/blog/img/Network%20Team%20-%20Connections.png" alt="Network Connections" title="Network Connections"></p><p>A new network interface created, with combined speed <em><strong>20Gbps</strong></em>.</p><p><img src="/blog/img/Network%20Team%20-%20Status.png" alt="Network Status" title="Network Status"></p><p><img src="/blog/img/Network%20Team%20-%20Details.png" alt="Network Details" title="Network Details"></p><p>To remove network team, run:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">Remove-NetSwitchTeam</span> <span class="literal">-Name</span> <span class="string">&quot;NIC-Team&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Intel Ethernet Converged Network Adapter X710, with two 10Gbps ports. This allows to team the two ports together for link aggregation.&lt;/p</summary>
      
    
    
    
    
  </entry>
  
</feed>
