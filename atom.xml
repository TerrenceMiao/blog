<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Terrence Miao&#39;s Adventures</title>
  
  <subtitle>A journey of a thousand miles begins with a single step</subtitle>
  <link href="https://terrencemiao.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://terrencemiao.github.io/blog/"/>
  <updated>2024-08-08T15:12:52.764Z</updated>
  <id>https://terrencemiao.github.io/blog/</id>
  
  <author>
    <name>Terrence Miao</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Setup TrueNAS Network and Link Aggregation</title>
    <link href="https://terrencemiao.github.io/blog/2024/08/09/Setup-TrueNAS-Network-and-Link-Aggregation/"/>
    <id>https://terrencemiao.github.io/blog/2024/08/09/Setup-TrueNAS-Network-and-Link-Aggregation/</id>
    <published>2024-08-08T15:03:40.000Z</published>
    <updated>2024-08-08T15:12:52.764Z</updated>
    
    <content type="html"><![CDATA[<p>Two network adapters have been setup with DHCP allocated addresses:</p><ol><li><code>ens18</code> 192.168.0.246</li><li><code>ens19</code> 192.168.0.105</li></ol><ul><li>Create a Network Link Aggregation Interface</li></ul><p><img src="/blog/img/TrueNAS%20-%20Link%20Aggregation.png" alt="TrueNAS - Link Aggregation" title="TrueNAS - Link Aggregation"></p><p>After Link Aggregation Interface <code>bond1</code> created, original two network adapters <code>ens18</code> and <code>ens19</code> IP addresses are gone. <code>bond1</code> with the ONLY ONE network interface address for <code>TrueNAS</code>.</p><p><img src="/blog/img/TrueNAS%20-%20Network.png" alt="TrueNAS - Network" title="TrueNAS - Network"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Two network adapters have been setup with DHCP allocated addresses:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;ens18&lt;/code&gt; 192.168.0.246&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ens19&lt;/c</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Samba setup and share in TrueNAS</title>
    <link href="https://terrencemiao.github.io/blog/2024/08/07/Samba-setup-and-share-in-TrueNAS/"/>
    <id>https://terrencemiao.github.io/blog/2024/08/07/Samba-setup-and-share-in-TrueNAS/</id>
    <published>2024-08-07T12:19:00.000Z</published>
    <updated>2024-08-07T12:31:35.902Z</updated>
    
    <content type="html"><![CDATA[<p><code>TrueNAS</code> installed and a few steps to setup to let users access shared <code>Samba</code> directories.</p><ul><li>Enable <code>SMB</code> Samba service in <code>TrueNAS</code></li></ul><p><img src="/blog/img/TrueNAS%20-%20Enable%20SMB%20service.png" alt="TrueNAS - Enable SMB service" title="TrueNAS - Enable SMB service"></p><ul><li>Create an user account with home directory and all access permisssions</li></ul><p><img src="/blog/img/TrueNAS%20-%20Create%20user.png" alt="TrueNAS - Create user" title="TrueNAS - Create user"></p><ul><li>Share <code>TrueNAS</code> pool created</li></ul><p><img src="/blog/img/TrueNAS%20-%20Sharing.png" alt="TrueNAS - Sharing" title="TrueNAS - Sharing"></p><p>Then can access shared directory from <code>TrunNAS</code> in both Windows and Mac:</p><p><img src="/blog/img/TrueNAS%20-%20Access.png" alt="TrueNAS - Access" title="TrueNAS - Access"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;code&gt;TrueNAS&lt;/code&gt; installed and a few steps to setup to let users access shared &lt;code&gt;Samba&lt;/code&gt; directories.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Enable &lt;c</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Increase, decrease and resize Proxmox disk volume</title>
    <link href="https://terrencemiao.github.io/blog/2024/08/07/Increase-decrease-and-resize-Proxmox-disk-volume/"/>
    <id>https://terrencemiao.github.io/blog/2024/08/07/Increase-decrease-and-resize-Proxmox-disk-volume/</id>
    <published>2024-08-07T03:29:22.000Z</published>
    <updated>2024-08-07T04:17:50.445Z</updated>
    
    <content type="html"><![CDATA[<p>After a default installation, a tiny disk space given to <code>Proxmox</code> root volume. Insufficient disk space issue raised up after several VMs installed and backup made, as iinstallation image files <code>*.ISO</code> and backup all put into root volume.</p><p>In <code>storage.cfg</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# cat /etc/pve/storage.cfg</span><br><span class="line">dir: local</span><br><span class="line">        path /var/lib/vz</span><br><span class="line">        content iso,vztmpl,backup</span><br><span class="line"></span><br><span class="line">lvmthin: local-lvm</span><br><span class="line">        thinpool data</span><br><span class="line">        vgname pve</span><br><span class="line">        content rootdir,images</span><br></pre></td></tr></table></figure><p>Run <code>lvdisplay</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lvdisplay</span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Name                data</span><br><span class="line">  VG Name                pve</span><br><span class="line">  # open                 0</span><br><span class="line">  LV Size                &lt;3.58 TiB</span><br><span class="line"></span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/pve/swap</span><br><span class="line">  LV Name                swap</span><br><span class="line">  VG Name                pve</span><br><span class="line">  LV Status              available</span><br><span class="line">  # open                 2</span><br><span class="line">  LV Size                8.00 GiB</span><br><span class="line"></span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/pve/root</span><br><span class="line">  LV Name                root</span><br><span class="line">  VG Name                pve</span><br><span class="line">  LV Status              available</span><br><span class="line">  # open                 1</span><br><span class="line">  LV Size                &lt;112.25 GiB</span><br></pre></td></tr></table></figure><p>Solution is to decrease the size of <code>pve/data</code> volume, as this volume doesn’t support reducing thin pools in size yet, and then to increase the size of <code>pdev/root</code> volume.</p><p>Backup all VMs, then remove <code>pve/data</code> volume:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lvremove pve/data</span><br><span class="line">Removing pool pve/data will remove 7 dependent volume(s). Proceed? [y/n]: y</span><br></pre></td></tr></table></figure><p>Based on the disk space has just released, increase the size of <code>pdev/root</code> volume, <strong>20%</strong> for current FREE space in this case:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lvextend -l +20%FREE /dev/pve/root</span><br><span class="line">  Size of logical volume pve/root changed from &lt;112.25 GiB (28735 extents) to &lt;851.09 GiB (217878 extents).</span><br><span class="line">  Logical volume pve/root successfully resized.</span><br><span class="line"></span><br><span class="line">root@pve:~# resize2fs /dev/pve/root</span><br><span class="line">resize2fs 1.47.0 (5-Feb-2023)</span><br><span class="line">Filesystem at /dev/pve/root is mounted on /; on-line resizing required</span><br><span class="line">old_desc_blocks = 15, new_desc_blocks = 107</span><br><span class="line">The filesystem on /dev/pve/root is now 223107072 (4k) blocks long.</span><br></pre></td></tr></table></figure><p>Create a new <code>pve/data</code> volume:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lvcreate -L2920G -ndata pve</span><br><span class="line">  Logical volume &quot;data&quot; created.</span><br></pre></td></tr></table></figure><p>Check free disk space:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# vgdisplay</span><br><span class="line">  --- Volume group ---</span><br><span class="line">  VG Name               pve</span><br><span class="line">  System ID</span><br><span class="line">  Format                lvm2</span><br><span class="line">  Metadata Areas        1</span><br><span class="line">  Metadata Sequence No  126</span><br><span class="line">  VG Access             read/write</span><br><span class="line">  VG Status             resizable</span><br><span class="line">  MAX LV                0</span><br><span class="line">  Cur LV                3</span><br><span class="line">  Open LV               2</span><br><span class="line">  Max PV                0</span><br><span class="line">  Cur PV                1</span><br><span class="line">  Act PV                1</span><br><span class="line">  VG Size               &lt;3.73 TiB</span><br><span class="line">  PE Size               4.00 MiB</span><br><span class="line">  Total PE              976498</span><br><span class="line">  Alloc PE / Size       967446 / 3.69 TiB</span><br><span class="line">  Free  PE / Size       9052 / &lt;35.36 GiB</span><br><span class="line">  VG UUID               UEsIZR-TBsz-UYlP-u2FO-2AbC-uq4d-vcb35f</span><br></pre></td></tr></table></figure><p>Create thin pool volume of the metadata, usually size of 1% of <code>pve/data</code> volume:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lvconvert --type thin-pool --poolmetadatasize 36G pve/data</span><br><span class="line">  Reducing pool metadata size 36.00 GiB to maximum usable size &lt;15.88 GiB.</span><br><span class="line">  Thin pool volume with chunk size 64.00 KiB can address at most &lt;15.88 TiB of data.</span><br><span class="line">  WARNING: Converting pve/data to thin pool&#x27;s data volume with metadata wiping.</span><br><span class="line">  THIS WILL DESTROY CONTENT OF LOGICAL VOLUME (filesystem etc.)</span><br><span class="line">Do you really want to convert pve/data? [y/n]: y</span><br><span class="line">  Converted pve/data to thin pool.</span><br></pre></td></tr></table></figure><p>Verify current disk volumes, <code>pve/root</code> disk volume has more space now:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# df -h</span><br><span class="line">Filesystem            Size  Used Avail Use% Mounted on</span><br><span class="line">udev                   16G     0   16G   0% /dev</span><br><span class="line">tmpfs                 3.2G  1.8M  3.2G   1% /run</span><br><span class="line">/dev/mapper/pve-root  841G   71G  736G   9% /</span><br><span class="line">tmpfs                  16G   46M   16G   1% /dev/shm</span><br><span class="line">tmpfs                 5.0M     0  5.0M   0% /run/lock</span><br><span class="line">efivarfs               192K  114K   74K  61% /sys/firmware/efi/efivars</span><br><span class="line">/dev/nvme3n1p2       1022M   12M 1011M   2% /boot/efi</span><br><span class="line">/dev/fuse             128M   20K  128M   1% /etc/pve</span><br><span class="line">tmpfs                 3.2G     0  3.2G   0% /run/user/0</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lsblk</span><br><span class="line">NAME                         MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">sda                            8:0    0 223.6G  0 disk</span><br><span class="line">├─sda1                         8:1    0   100M  0 part</span><br><span class="line">├─sda2                         8:2    0    16M  0 part</span><br><span class="line">├─sda3                         8:3    0 120.3G  0 part</span><br><span class="line">├─sda4                         8:4    0   625M  0 part</span><br><span class="line">└─sda5                         8:5    0 102.5G  0 part</span><br><span class="line">nvme2n1                      259:0    0   3.6T  0 disk</span><br><span class="line">nvme4n1                      259:1    0   3.6T  0 disk</span><br><span class="line">nvme0n1                      259:2    0   3.6T  0 disk</span><br><span class="line">nvme1n1                      259:3    0   3.6T  0 disk</span><br><span class="line">nvme5n1                      259:4    0   3.6T  0 disk</span><br><span class="line">nvme3n1                      259:5    0   3.7T  0 disk</span><br><span class="line">├─nvme3n1p1                  259:6    0  1007K  0 part</span><br><span class="line">├─nvme3n1p2                  259:7    0     1G  0 part /boot/efi</span><br><span class="line">└─nvme3n1p3                  259:8    0   3.7T  0 part</span><br><span class="line">  ├─pve-swap                 252:0    0     8G  0 lvm  [SWAP]</span><br><span class="line">  ├─pve-root                 252:1    0 854.7G  0 lvm  /</span><br><span class="line">  ├─pve-data_tmeta           252:2    0  15.9G  0 lvm</span><br><span class="line">  │ └─pve-data-tpool         252:4    0   2.9T  0 lvm</span><br><span class="line">  │   ├─pve-data             252:5    0   2.9T  1 lvm</span><br><span class="line">  │   ├─pve-vm--100--disk--0 252:6    0   240G  0 lvm</span><br><span class="line">  │   ├─pve-vm--101--disk--0 252:7    0     4M  0 lvm</span><br><span class="line">  │   ├─pve-vm--101--disk--1 252:8    0   240G  0 lvm</span><br><span class="line">  │   ├─pve-vm--101--disk--2 252:9    0     4M  0 lvm</span><br><span class="line">  │   ├─pve-vm--102--disk--0 252:10   0     4M  0 lvm</span><br><span class="line">  │   ├─pve-vm--102--disk--1 252:11   0   240G  0 lvm</span><br><span class="line">  │   └─pve-vm--102--disk--2 252:12   0     4M  0 lvm</span><br><span class="line">  └─pve-data_tdata           252:3    0   2.9T  0 lvm</span><br><span class="line">    └─pve-data-tpool         252:4    0   2.9T  0 lvm</span><br><span class="line">      ├─pve-data             252:5    0   2.9T  1 lvm</span><br><span class="line">      ├─pve-vm--100--disk--0 252:6    0   240G  0 lvm</span><br><span class="line">      ├─pve-vm--101--disk--0 252:7    0     4M  0 lvm</span><br><span class="line">      ├─pve-vm--101--disk--1 252:8    0   240G  0 lvm</span><br><span class="line">      ├─pve-vm--101--disk--2 252:9    0     4M  0 lvm</span><br><span class="line">      ├─pve-vm--102--disk--0 252:10   0     4M  0 lvm</span><br><span class="line">      ├─pve-vm--102--disk--1 252:11   0   240G  0 lvm</span><br><span class="line">      └─pve-vm--102--disk--2 252:12   0     4M  0 lvm</span><br><span class="line"></span><br><span class="line">root@pve:~# lvs</span><br><span class="line">  LV            VG  Attr       LSize    Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  data          pve twi-aotz--    2.85t             3.19   0.32</span><br><span class="line">  root          pve -wi-ao---- &lt;854.69g</span><br><span class="line">  swap          pve -wi-ao----    8.00g</span><br><span class="line">  vm-100-disk-0 pve Vwi-a-tz--  240.00g data        10.38</span><br><span class="line">  vm-101-disk-0 pve Vwi-a-tz--    4.00m data        14.06</span><br><span class="line">  vm-101-disk-1 pve Vwi-a-tz--  240.00g data        19.50</span><br><span class="line">  vm-101-disk-2 pve Vwi-a-tz--    4.00m data        1.56</span><br><span class="line">  vm-102-disk-0 pve Vwi-a-tz--    4.00m data        14.06</span><br><span class="line">  vm-102-disk-1 pve Vwi-a-tz--  240.00g data        8.98</span><br><span class="line">  vm-102-disk-2 pve Vwi-a-tz--    4.00m data        1.56</span><br></pre></td></tr></table></figure><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li>Reduce size of local-lvm <em><a href="https://forum.proxmox.com/threads/reduce-size-of-local-lvm.78676/">https://forum.proxmox.com/threads/reduce-size-of-local-lvm.78676/</a></em></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;After a default installation, a tiny disk space given to &lt;code&gt;Proxmox&lt;/code&gt; root volume. Insufficient disk space issue raised up after </summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Proxmox and SR-IOV support for Intel GPU and Mellonax network adapter</title>
    <link href="https://terrencemiao.github.io/blog/2024/08/04/Proxmox-and-SR-IOV-support-for-Intel-GPU-and-Mellonax-network-adapter/"/>
    <id>https://terrencemiao.github.io/blog/2024/08/04/Proxmox-and-SR-IOV-support-for-Intel-GPU-and-Mellonax-network-adapter/</id>
    <published>2024-08-04T01:56:12.000Z</published>
    <updated>2024-08-06T15:16:13.408Z</updated>
    
    <content type="html"><![CDATA[<ul><li><p>Enable <code>VT-d</code> for IOMMU (（Input Output Memory Management Unit) services, and <code>SR-IOV</code> in motherboard BIOS in Chipset, e.g. <em>ASRock Z790 Riptide WiFi</em>.</p></li><li><p>Enable <code>SR-IOV</code> for Mellonax network adapter e.g. <em>Mellanox ConnectX-4 MCX455A-ECAT PCIe x16 3.0 100GBe VPI EDR IB</em> in the same motherboard BIOS.</p></li><li><p>Add Proxmox No Subscription URL:</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# cat /etc/apt/sources.list</span><br><span class="line">deb http://ftp.au.debian.org/debian bookworm main contrib</span><br><span class="line"></span><br><span class="line">deb http://ftp.au.debian.org/debian bookworm-updates main contrib</span><br><span class="line"></span><br><span class="line"># security updates</span><br><span class="line">deb http://security.debian.org bookworm-security main contrib</span><br><span class="line"></span><br><span class="line"># Proxmox VE pve-no-subscription repository provided by proxmox.com,</span><br><span class="line"># NOT recommended for production use</span><br><span class="line">deb http://download.proxmox.com/debian/pve bookworm pve-no-subscription</span><br></pre></td></tr></table></figure><p>and run packages update:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# apt update</span><br></pre></td></tr></table></figure><p>and install all build tools:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# apt install build-* dkms</span><br></pre></td></tr></table></figure><ul><li>Set&#x2F;Pin Proxmox kernel version:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# proxmox-boot-tool kernel pin 6.8.4-2-pve</span><br><span class="line">Setting &#x27;6.8.4-2-pve&#x27; as grub default entry and running update-grub.</span><br><span class="line">Generating grub configuration file ...</span><br><span class="line">Found linux image: /boot/vmlinuz-6.8.4-2-pve</span><br><span class="line">Found initrd image: /boot/initrd.img-6.8.4-2-pve</span><br><span class="line">Found memtest86+ 64bit EFI image: /boot/memtest86+x64.efi</span><br><span class="line">Adding boot menu entry for UEFI Firmware Settings ...</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>and verify Proxmox kernal version:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# proxmox-boot-tool kernel list</span><br><span class="line">Manually selected kernels:</span><br><span class="line">None.</span><br><span class="line"></span><br><span class="line">Automatically selected kernels:</span><br><span class="line">6.8.4-2-pve</span><br><span class="line"></span><br><span class="line">Pinned kernel:</span><br><span class="line">6.8.4-2-pve</span><br></pre></td></tr></table></figure><ul><li>Install Proxmox kernel headers source code package:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# apt install proxmox-headers-6.8.4-2-pve</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree... Done</span><br><span class="line">Reading state information... Done</span><br><span class="line">The following NEW packages will be installed:</span><br><span class="line">  proxmox-headers-6.8.4-2-pve</span><br><span class="line">0 upgraded, 1 newly installed, 0 to remove and 39 not upgraded.</span><br><span class="line">Need to get 13.7 MB of archives.</span><br><span class="line">After this operation, 97.0 MB of additional disk space will be used.</span><br><span class="line">Get:1 http://download.proxmox.com/debian/pve bookworm/pve-no-subscription amd64 proxmox-headers-6.8.4-2-pve amd64 6.8.4-2 [13.7 MB]</span><br><span class="line">Fetched 13.7 MB in 1s (23.8 MB/s)</span><br><span class="line">Selecting previously unselected package proxmox-headers-6.8.4-2-pve.</span><br><span class="line">(Reading database ... 70448 files and directories currently installed.)</span><br><span class="line">Preparing to unpack .../proxmox-headers-6.8.4-2-pve_6.8.4-2_amd64.deb ...</span><br><span class="line">Unpacking proxmox-headers-6.8.4-2-pve (6.8.4-2) ...</span><br><span class="line">Setting up proxmox-headers-6.8.4-2-pve (6.8.4-2) ...</span><br></pre></td></tr></table></figure><ul><li>Download <code>Linux i915 driver with SR-IOV</code> support for Linux kernel:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# git clone https://github.com/strongtz/i915-sriov-dkms</span><br></pre></td></tr></table></figure><p>and change into the cloned repository and run:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~/i915-sriov-dkms# cat VERSION</span><br><span class="line">2024.07.24</span><br><span class="line"></span><br><span class="line">root@pve:~/i915-sriov-dkms# dkms add .</span><br><span class="line">Creating symlink /var/lib/dkms/i915-sriov-dkms/2024.07.24/source -&gt; /usr/src/i915-sriov-dkms-2024.07.24</span><br></pre></td></tr></table></figure><p>and build, install <code>i915-sriov-dkms</code> Linux kernel module:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~/i915-sriov-dkms# dkms install -m i915-sriov-dkms -v $(cat VERSION) --force</span><br><span class="line">Sign command: /lib/modules/6.8.4-2-pve/build/scripts/sign-file</span><br><span class="line">Signing key: /var/lib/dkms/mok.key</span><br><span class="line">Public certificate (MOK): /var/lib/dkms/mok.pub</span><br><span class="line">Certificate or key are missing, generating self signed certificate for MOK...</span><br><span class="line"></span><br><span class="line">Building module:</span><br><span class="line">Cleaning build area...</span><br><span class="line">make -j20 KERNELRELEASE=6.8.4-2-pve -C /lib/modules/6.8.4-2-pve/build M=/var/lib/dkms/i915-sriov-dkms/2024.07.24/build.......</span><br><span class="line">Signing module /var/lib/dkms/i915-sriov-dkms/2024.07.24/build/i915.ko</span><br><span class="line">Cleaning build area...</span><br><span class="line"></span><br><span class="line">i915.ko:</span><br><span class="line">Running module version sanity check.</span><br><span class="line"> - Original module</span><br><span class="line"> - Installation</span><br><span class="line">   - Installing to /lib/modules/6.8.4-2-pve/updates/dkms/</span><br><span class="line">depmod...</span><br></pre></td></tr></table></figure><p>and enable <code>i915-sriov-dkms</code> module with upto maximum <strong>7</strong> VFS (Virtual File System) in Linux kernel:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# cat /etc/default/grub | grep GRUB_CMDLINE_LINUX_DEFAULT</span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on i915.enable_guc=3 i915.max_vfs=7&quot;</span><br></pre></td></tr></table></figure><ul><li>Reboot Proxmox:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lspci | grep VGA</span><br><span class="line">00:02.0 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br><span class="line">00:02.1 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br><span class="line">00:02.2 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br><span class="line">00:02.3 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br><span class="line">00:02.4 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br><span class="line">00:02.5 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br><span class="line">00:02.6 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br><span class="line">00:02.7 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br></pre></td></tr></table></figure><p>First VGA <code>00:02.0</code> is the <strong>REAL</strong> GPU. Other <strong>7</strong> are <strong>Virtual</strong> ones.</p><p>Verify IOMMU has been enabled:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# dmesg | grep -i iommu</span><br><span class="line">[    0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-6.8.4-2-pve root=/dev/mapper/pve-root ro quiet intel_iommu=on i915.enable_guc=3 i915.max_vfs=7</span><br><span class="line">[    0.036486] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-6.8.4-2-pve root=/dev/mapper/pve-root ro quiet intel_iommu=on i915.enable_guc=3 i915.max_vfs=7</span><br><span class="line">[    0.036515] DMAR: IOMMU enabled</span><br><span class="line">[    0.090320] DMAR-IR: IOAPIC id 2 under DRHD base  0xfed91000 IOMMU 1</span><br><span class="line">[    0.244292] pci 0000:00:02.0: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    0.270125] iommu: Default domain type: Translated</span><br><span class="line">[    0.270125] iommu: DMA domain TLB invalidation policy: lazy mode</span><br><span class="line">[    0.303735] DMAR: IOMMU feature fl1gp_support inconsistent</span><br><span class="line">[    0.303735] DMAR: IOMMU feature pgsel_inv inconsistent</span><br><span class="line">[    0.303736] DMAR: IOMMU feature nwfs inconsistent</span><br><span class="line">[    0.303736] DMAR: IOMMU feature dit inconsistent</span><br><span class="line">[    0.303737] DMAR: IOMMU feature sc_support inconsistent</span><br><span class="line">[    0.303737] DMAR: IOMMU feature dev_iotlb_support inconsistent</span><br><span class="line">[    0.304175] pci 0000:00:02.0: Adding to iommu group 0</span><br><span class="line">[    0.304544] pci 0000:00:00.0: Adding to iommu group 1</span><br><span class="line">[    0.304554] pci 0000:00:01.0: Adding to iommu group 2</span><br><span class="line">[    0.304562] pci 0000:00:01.1: Adding to iommu group 3</span><br><span class="line">[    0.304570] pci 0000:00:06.0: Adding to iommu group 4</span><br><span class="line">[    0.304582] pci 0000:00:14.0: Adding to iommu group 5</span><br><span class="line">[    0.304589] pci 0000:00:14.2: Adding to iommu group 5</span><br><span class="line">[    0.304598] pci 0000:00:15.0: Adding to iommu group 6</span><br><span class="line">[    0.304607] pci 0000:00:16.0: Adding to iommu group 7</span><br><span class="line">[    0.304614] pci 0000:00:17.0: Adding to iommu group 8</span><br><span class="line">[    0.304630] pci 0000:00:1a.0: Adding to iommu group 9</span><br><span class="line">[    0.304641] pci 0000:00:1b.0: Adding to iommu group 10</span><br><span class="line">[    0.304651] pci 0000:00:1c.0: Adding to iommu group 11</span><br><span class="line">[    0.304662] pci 0000:00:1c.1: Adding to iommu group 12</span><br><span class="line">[    0.304671] pci 0000:00:1c.2: Adding to iommu group 13</span><br><span class="line">[    0.304681] pci 0000:00:1c.3: Adding to iommu group 14</span><br><span class="line">[    0.304692] pci 0000:00:1c.4: Adding to iommu group 15</span><br><span class="line">[    0.304703] pci 0000:00:1d.0: Adding to iommu group 16</span><br><span class="line">[    0.304721] pci 0000:00:1f.0: Adding to iommu group 17</span><br><span class="line">[    0.304728] pci 0000:00:1f.3: Adding to iommu group 17</span><br><span class="line">[    0.304735] pci 0000:00:1f.4: Adding to iommu group 17</span><br><span class="line">[    0.304742] pci 0000:00:1f.5: Adding to iommu group 17</span><br><span class="line">[    0.304750] pci 0000:01:00.0: Adding to iommu group 18</span><br><span class="line">[    0.304758] pci 0000:02:00.0: Adding to iommu group 19</span><br><span class="line">[    0.304765] pci 0000:03:00.0: Adding to iommu group 20</span><br><span class="line">[    0.304781] pci 0000:04:00.0: Adding to iommu group 21</span><br><span class="line">[    0.304791] pci 0000:05:00.0: Adding to iommu group 22</span><br><span class="line">[    0.304801] pci 0000:06:00.0: Adding to iommu group 23</span><br><span class="line">[    0.304810] pci 0000:07:00.0: Adding to iommu group 24</span><br><span class="line">[    0.304834] pci 0000:08:00.0: Adding to iommu group 25</span><br><span class="line">[    0.304845] pci 0000:09:00.0: Adding to iommu group 26</span><br><span class="line">[    0.304857] pci 0000:0a:00.0: Adding to iommu group 27</span><br><span class="line">[    0.304866] pci 0000:0b:00.0: Adding to iommu group 28</span><br><span class="line">[    4.659395] pci 0000:00:02.1: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    4.659438] pci 0000:00:02.1: Adding to iommu group 29</span><br><span class="line">[    4.664441] pci 0000:00:02.2: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    4.664479] pci 0000:00:02.2: Adding to iommu group 30</span><br><span class="line">[    4.667692] pci 0000:00:02.3: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    4.667727] pci 0000:00:02.3: Adding to iommu group 31</span><br><span class="line">[    4.671096] pci 0000:00:02.4: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    4.671129] pci 0000:00:02.4: Adding to iommu group 32</span><br><span class="line">[    4.673545] pci 0000:00:02.5: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    4.673572] pci 0000:00:02.5: Adding to iommu group 33</span><br><span class="line">[    4.676357] pci 0000:00:02.6: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    4.676402] pci 0000:00:02.6: Adding to iommu group 34</span><br><span class="line">[    4.679192] pci 0000:00:02.7: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    4.679221] pci 0000:00:02.7: Adding to iommu group 35</span><br></pre></td></tr></table></figure><ul><li>Enable Virtual GPU for <code>Windows 11</code> VM in Proxmox</li></ul><p>Add a PCI device for <code>Windows 11</code> VM, and choose one Virtual GPU:</p><p><img src="/blog/img/Proxmox%20-%20Windows%2011,%20PCI%20device.png" alt="Proxmox - Windows 11, PCI device" title="Proxmox - Windows 11, PCI device"></p><p>Enable <code>Primary GPU</code> and <code>PCI Express</code> in options:</p><p><img src="/blog/img/Proxmox%20-%20Windows%2011,%20Primary%20GPU%20and%20PCI%20Express.png" alt="Proxmox - Windows 11, Primary GPU and PCI Express" title="Proxmox - Windows 11, Primary GPU and PCI Express"></p><p>Choose <code>none</code> in Display and <code>host</code> in Processors options for <code>Windows 11</code> VM:</p><p><img src="/blog/img/Proxmox%20-%20Windows%2011,%20Display.png" alt="Proxmox - Windows 11, Display" title="Proxmox - Windows 11, Display"></p><p><img src="/blog/img/Proxmox%20-%20Windows%2011,%20Display%20none.png" alt="Proxmox - Windows 11, Display none" title="Proxmox - Windows 11, Display none"></p><p>Start <code>Windows 11</code> VM, login with <code>Microsoft Remote Desktop</code> <em><a href="https://apps.microsoft.com/detail/9wzdncrfj3ps">https://apps.microsoft.com/detail/9wzdncrfj3ps</a></em> and a Virtual GPU is available now. Run <code>Task Manager</code> and check CPU and GPU load:</p><p><img src="/blog/img/Proxmox%20-%20Windows%2011,%20Performance.png" alt="Proxmox - Windows 11, Performance" title="Proxmox - Windows 11, Performance"></p><ul><li>Enable Virtual GPU for <code>Ubuntu</code> VM in Proxmox</li></ul><p>Ubuntu version 22.04.4 for desktop.</p><p>Add a PCI device for <code>Ubuntu</code> VM, and choose one Virtual GPU; Enable <code>Primary GPU</code> and <code>PCI Express</code> in options; Choose <code>none</code> in Display and <code>host</code> in Processors options:</p><p><img src="/blog/img/Proxmox%20-%20Ubuntu.png" alt="Proxmox - Ubuntu" title="Proxmox - Ubuntu"></p><p>Setup remote desktop connection to Ubuntu:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@nucleus:~# apt install ubuntu-desktop</span><br><span class="line"></span><br><span class="line">root@nucleus:~# apt install xrdp</span><br><span class="line"></span><br><span class="line">root@nucleus:~# systemctl enable xrdp</span><br></pre></td></tr></table></figure><p><img src="/blog/img/Proxmox%20-%20Remote%20Desktop.png" alt="Proxmox - Remote Desktop" title="Proxmox - Remote Desktop"></p><ul><li>Fix Remote Desktop audio over HDMI issue with the script, enable the sound redirection:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terrence@nucleus:~$ ./xrdp-installer-1.5.1.sh -s</span><br></pre></td></tr></table></figure><p>then reboot VM.</p><p><img src="/blog/img/Proxmox%20-%20Ubuntu%20Remote%20Desktop.png" alt="Proxmox - Ubuntu Remote Desktop" title="Proxmox - Ubuntu Remote Desktop"></p><p>Now Audio device becomes xrdp input &#x2F; output.</p><ul><li>Windows Server 2022</li></ul><p>Windows Server 2022 is similar to Windows 11 setup in Proxmox. A few issues like <strong>GPU</strong>:</p><p><img src="/blog/img/Proxmox%20-%20Windows%20Server%202022,%20GPU.png" alt="Proxmox - Windows Server 2022, GPU" title="Proxmox - Windows Server 2022, GPU"></p><p>just disable GPU then enable it, it will work correctly.</p><p>And no sound after installation, but can enable <strong>Windows Audio Service</strong> and choose <strong>Remote Audio</strong>:</p><p><img src="/blog/img/Proxmox%20-%20Windows%20Server%202022,%20Sound.png" alt="Proxmox - Windows Server 2022, Sound" title="Proxmox - Windows Server 2022, Sound"></p><p>then audio over HDMI to remote desktop can work.</p><p>In addition, can setup User Auto Logon after Windows Server 2022 startup. And check Windows license by running:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\Administrator&gt; slmgr -dlv</span><br></pre></td></tr></table></figure><p>Now can remote desktop access Ubuntu, Windows 11 and Windows Server 2022 VMs both run in Proxmox:</p><p><img src="/blog/img/Proxmox%20-%20Ubuntu%20and%20Windows.jpg" alt="Proxmox - Ubuntu and Windows" title="Proxmox - Ubuntu and Windows"></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li>最新保姆级 PVE 8 安装教程！虚拟机 PCIE 设备及 SR-IOV 核显直通，最多分配7个虚拟化单独核显！最强虚拟机！<em><a href="https://v2rayssr.com/pve.html">https://v2rayssr.com/pve.html</a></em></li><li>PVE 8.1 下部署 Intel 集显虚拟化驱动 <em><a href="https://zoe.red/2023/38.html">https://zoe.red/2023/38.html</a></em></li><li>定制 OVMF 固件实现 PVE 8 环境 UEFI 模式直通 Intel 核显并显示 BIOS 适用于 intel 6-13 代处理器 PVE 8 核显直通画面 Windows 10 and MacOS 系统画面显示教程，可以外接显示器 <em><a href="https://imacos.top/2023/10/09/152/">https://imacos.top/2023/10/09/152/</a></em></li><li>PVE 下如何启用 PCI 直通显卡 GPU&#x2F;iGPU&#x2F;USB&#x2F;声卡 AUDIO 等硬件直通教程 <em><a href="https://imacos.top/2023/07/31/pci/">https://imacos.top/2023/07/31/pci/</a></em></li><li>Enable &amp; Using vGPU Passthrough <em><a href="https://gist.github.com/scyto/e4e3de35ee23fdb4ae5d5a3b85c16ed3">https://gist.github.com/scyto/e4e3de35ee23fdb4ae5d5a3b85c16ed3</a></em></li><li>Proxmox VE: Passthrough with Intel Integrated Graphics Card Alder Lake Architecture | vGPU, VT-d, SR-IOV <em><a href="https://github.com/kamilllooo/Proxmox">https://github.com/kamilllooo/Proxmox</a></em></li><li>Remote Desktop connection from Mac to Ubuntu <em><a href="https://askubuntu.com/questions/893831/remote-desktop-connection-from-mac-to-ubuntu">https://askubuntu.com/questions/893831/remote-desktop-connection-from-mac-to-ubuntu</a></em></li><li>xRDP – Easy install xRDP on Ubuntu 20.04,22.04,23.XX,24.04 (Script Version 1.5.1) <em><a href="https://c-nergy.be/blog/?p=19814">https://c-nergy.be/blog/?p=19814</a></em></li><li>Autologon User at Startup in Windows Server <em><a href="https://jc-lan.org/2022/06/02/autologon-user-at-startup-in-windows-server/">https://jc-lan.org/2022/06/02/autologon-user-at-startup-in-windows-server/</a></em></li><li>Windows Server 2022 audio available but not playing <em><a href="https://answers.microsoft.com/en-us/windowserver/forum/all/windows-server-2022-audio-available-but-not/eca821f1-7b4a-4293-8273-fda49dd0e9d4">https://answers.microsoft.com/en-us/windowserver/forum/all/windows-server-2022-audio-available-but-not/eca821f1-7b4a-4293-8273-fda49dd0e9d4</a></em></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Enable &lt;code&gt;VT-d&lt;/code&gt; for IOMMU (（Input Output Memory Management Unit) services, and &lt;code&gt;SR-IOV&lt;/code&gt; in motherboard BIOS </summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>The solution making old Intel 10Gbps network adapter work in Windows 11</title>
    <link href="https://terrencemiao.github.io/blog/2024/05/20/The-solution-making-old-Intel-10Gbps-network-adapter-work-in-Windows-11/"/>
    <id>https://terrencemiao.github.io/blog/2024/05/20/The-solution-making-old-Intel-10Gbps-network-adapter-work-in-Windows-11/</id>
    <published>2024-05-20T12:27:09.000Z</published>
    <updated>2024-05-20T12:52:52.040Z</updated>
    
    <content type="html"><![CDATA[<p>Buy some old Intel 10Gbps network adapter, <code>X520</code>, <code>X540</code> … from AliExpress <em><a href="https://aliexpress.com/">https://aliexpress.com/</a></em>, and install old Intel network adapter driver for Windows 10 and make it working in Windows 11. The example is install version 25.0 Intel network adapter driver, <em><a href="https://www.intel.com/content/www/us/en/download/18293/29648/intel-network-adapter-driver-for-windows-10.html">https://www.intel.com/content/www/us/en/download/18293/29648/intel-network-adapter-driver-for-windows-10.html</a></em>, to get it to work in Windows 11:</p><ul><li><p>Intel network adapters supported Operating Systems, <em><a href="https://www.intel.com/content/www/us/en/support/articles/000025890/ethernet-products.html">https://www.intel.com/content/www/us/en/support/articles/000025890/ethernet-products.html</a></em></p></li><li><p>Buy dual ports 10Gbps network adapter</p></li><li><p>Install the network adapter in PCIE slot directly to the CPU</p></li><li><p>Enable SMB Multichannel</p></li><li><p>Enable Jumbo Frames</p></li></ul><iframe width="560" height="315" src="https://www.youtube.com/embed/WDPblqez00s?si=fs4-wswGT5AzDWMK&amp;start=222" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Buy some old Intel 10Gbps network adapter, &lt;code&gt;X520&lt;/code&gt;, &lt;code&gt;X540&lt;/code&gt; … from AliExpress &lt;em&gt;&lt;a href=&quot;https://aliexpress.com/&quot;&gt;h</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>How to enable SMB Multichannel in Windows 11</title>
    <link href="https://terrencemiao.github.io/blog/2024/05/17/How-to-enable-SMB-Multichannel-in-Windows-11/"/>
    <id>https://terrencemiao.github.io/blog/2024/05/17/How-to-enable-SMB-Multichannel-in-Windows-11/</id>
    <published>2024-05-17T12:38:27.000Z</published>
    <updated>2024-05-17T13:12:21.219Z</updated>
    
    <content type="html"><![CDATA[<p>Network adapter requires to support <strong>RSS (Receive Side Scaling)</strong>.</p><p><img src="/blog/img/RSS%20-%20Receive%20Side%20Scaling.png" alt="RSS (Receive Side Scaling)" title="RSS (Receive Side Scaling)"></p><ul><li>Open PowerShell as administrator in Windows 11, run and enable SMB Multichannel (should be enabled by default):</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">Set-SmbClientConfiguration</span> <span class="literal">-EnableMultiChannel</span> <span class="variable">$true</span></span><br><span class="line"></span><br><span class="line">Confirm</span><br><span class="line">Are you sure you want to perform this action?</span><br><span class="line">Performing operation <span class="string">&#x27;Modify&#x27;</span> on Target <span class="string">&#x27;SMB Client Configuration&#x27;</span>.</span><br><span class="line"><span class="function">[<span class="type">Y</span>] <span class="title">Yes</span></span>  <span class="function">[<span class="type">A</span>] <span class="title">Yes</span></span> to All  <span class="function">[<span class="type">N</span>] <span class="title">No</span></span>  <span class="function">[<span class="type">L</span>] <span class="title">No</span></span> to All  <span class="function">[<span class="type">S</span>] <span class="title">Suspend</span></span>  <span class="function">[?] <span class="title">Help</span></span> (default is <span class="string">&quot;Y&quot;</span>):</span><br></pre></td></tr></table></figure><p>Check network interfaces which show “<strong>RSS capable &#x3D; True</strong>“:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">Get-SmbClientNetworkInterface</span></span><br><span class="line"></span><br><span class="line">Interface Index RSS Capable RDMA Capable Speed   IpAddresses                               Friendly Name</span><br><span class="line"><span class="literal">---------------</span> <span class="literal">-----------</span> <span class="literal">------------</span> <span class="literal">-----</span>   <span class="literal">-----------</span>                               <span class="literal">-------------</span></span><br><span class="line"><span class="number">17</span>              True        False        <span class="number">20</span> Gbps &#123;&#125;                                        X710<span class="literal">-1-WFP</span> Native MAC Layer LightWeight <span class="keyword">Filter</span><span class="literal">-0000</span></span><br><span class="line"><span class="number">8</span>               False       False        <span class="number">10</span> Gbps &#123;&#125;                                        X710<span class="literal">-1</span></span><br><span class="line"><span class="number">13</span>              False       False        <span class="number">10</span> Gbps &#123;&#125;                                        X710<span class="literal">-2</span></span><br><span class="line"><span class="number">26</span>              True        False        <span class="number">20</span> Gbps &#123;fe80::<span class="number">923</span>a:<span class="number">90</span>de:dedd:ef44, <span class="number">192.168</span>.<span class="number">0.98</span>&#125; NIC<span class="literal">-Team</span></span><br></pre></td></tr></table></figure><ul><li>Verify there are any active SMB connections:</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">Get-SmbConnection</span></span><br><span class="line"></span><br><span class="line">ServerName ShareName UserName         Credential                               Dialect NumOpens</span><br><span class="line"><span class="literal">----------</span> <span class="literal">---------</span> <span class="literal">--------</span>         <span class="literal">----------</span>                               <span class="literal">-------</span> <span class="literal">--------</span></span><br><span class="line">Synology   NAS Drive RIPTIDE\terrence MicrosoftAccount\terrence.miao@mail.net  <span class="number">3.1</span>.<span class="number">1</span>   <span class="number">2</span></span><br></pre></td></tr></table></figure><ul><li>Copy a large file to a SMB device, e.g., Synology NAS which also has SMB Multichannel enabled, then verify the SMB Multichannel is working:</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">Get-SmbMultichannelConnection</span> <span class="literal">-IncludeNotSelected</span></span><br><span class="line"></span><br><span class="line">Server Name Selected Client IP    Server IP       Client Interface Index Server Interface Index Client RSS Capable Client RDMA Capable</span><br><span class="line"><span class="literal">-----------</span> <span class="literal">--------</span> <span class="literal">---------</span>    <span class="literal">---------</span>       <span class="literal">----------------------</span> <span class="literal">----------------------</span> <span class="literal">------------------</span> <span class="literal">-------------------</span></span><br><span class="line">Synology    True     <span class="number">192.168</span>.<span class="number">0.98</span> <span class="number">192.168</span>.<span class="number">0.112</span>   <span class="number">26</span>                     <span class="number">5</span>                      False              False</span><br><span class="line">Synology    False    <span class="number">192.168</span>.<span class="number">0.98</span> <span class="number">192.168</span>.<span class="number">0.34</span>    <span class="number">26</span>                     <span class="number">4</span>                      False              False</span><br><span class="line">Synology    False    <span class="number">192.168</span>.<span class="number">0.98</span> <span class="number">192.168</span>.<span class="number">196.140</span> <span class="number">26</span>                     <span class="number">7</span>                      False              False</span><br></pre></td></tr></table></figure><p><code>192.168.0.98</code> is Windows 11 network address, after Network Teaming; <code>192.168.0.112</code> and <code>192.168.0.34</code> are Synology NAS network addresses.</p><p><img src="/blog/img/With%20and%20without%20multichannel.png" alt="With and without multichannel" title="With and without multichannel"></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li>HOW TO: Enable SMB Multichannel for &gt; 125 MB between Synology and Win 10, <em><a href="https://www.reddit.com/r/synology/comments/rrb4r1/how_to_enable_smb_multichannel_for_125_mb_between/">https://www.reddit.com/r/synology/comments/rrb4r1/how_to_enable_smb_multichannel_for_125_mb_between/</a></em></li><li>What is SMB3 Multichannel and how is it different from Link Aggregation?, <em><a href="https://kb.synology.com/en-global/DSM/tutorial/smb3_multichannel_link_aggregation">https://kb.synology.com/en-global/DSM/tutorial/smb3_multichannel_link_aggregation</a></em></li><li>SMB Multichannel available for testing!, <em><a href="https://community.synology.com/enu/forum/1/post/157265">https://community.synology.com/enu/forum/1/post/157265</a></em></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Network adapter requires to support &lt;strong&gt;RSS (Receive Side Scaling)&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/img/RSS%20-%20Receive%20Side%20Sc</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>How to upgrade Synology NAS network from 1Gbps to 2.5Gbps</title>
    <link href="https://terrencemiao.github.io/blog/2024/05/17/How-to-upgrade-Synology-NAS-network-from-1Gbps-to-2-5Gbps/"/>
    <id>https://terrencemiao.github.io/blog/2024/05/17/How-to-upgrade-Synology-NAS-network-from-1Gbps-to-2-5Gbps/</id>
    <published>2024-05-17T10:25:45.000Z</published>
    <updated>2024-08-04T01:52:29.905Z</updated>
    
    <content type="html"><![CDATA[<p>Synology NAS DS920+ with two 1Gbps ethernet adapters. There is an affordable and easy upgrading its gigabytes network path to 2.5Gbps.</p><p>Login Synology NAS Admin UI and run <strong>Control Panel</strong> -&gt; <strong>Network</strong> -&gt; <strong>Network Interface</strong></p><p><img src="/blog/img/Synology%20NAS%20network%20upgrade%20-%20installation%20before.png" alt="Installation before" title="Installation before"></p><ul><li>Get a USB 3.0 Ethernet Adapter 2.5Gbps with <strong>Realtek RTL8156 &#x2F; RTL8156B &#x2F; RTL8156BG</strong>  chipset, e.g., UGREEN 2.5Gbps USB-C Ethernet Adapter:</li></ul><p><img src="/blog/img/UGREEN%202.5Gbps%20USB-C%20Ethernet%20Adapter.jpg" alt="UGREEN 2.5Gbps USB-C Ethernet Adapter" title="UGREEN 2.5Gbps USB-C Ethernet Adapter"></p><ul><li><p>Find out the architecture name of CPU in NAS. For example, Synology DS920+ is equipped with Intel Celeron J4125 CPU. The architecture name of this processor is <code>Geminilake</code>.</p></li><li><p>Go to driver releases site <em><a href="https://github.com/bb-qq/r8152/releases">https://github.com/bb-qq/r8152/releases</a></em> and download the latest version e.g. <code>r8152-geminilake-2.17.1-1_7.2.spk</code>, Synology DSM 7.2 and above, use packages with the suffix <strong>_7.2</strong>.</p></li><li><p>Login Synology Admin UI, then go to <strong>Package Center</strong> -&gt; <strong>Manual Install</strong> and choose a driver package downloaded from above step.</p></li></ul><p><img src="/blog/img/Synology%20NAS%20network%20upgrade%20-%20package%20installation.png" alt="Package installation" title="Package installation"></p><p><img src="/blog/img/Synology%20NAS%20network%20upgrade%20-%20installation%20warning.png" alt="Installation warning" title="Installation warning"></p><p><img src="/blog/img/Synology%20NAS%20network%20upgrade%20-%20installation%20confirmation.png" alt="Installation confirmation" title="Installation confirmation"></p><ul><li>The installation will fail at the very first time.</li></ul><p><img src="/blog/img/Synology%20NAS%20network%20upgrade%20-%20installation%20failed.png" alt="Installation failed" title="Installation failed"></p><ul><li>Then <code>ssh</code> into the NAS, and run the following command:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo install -m 4755 -o root -D /var/packages/r8152/target/r8152/spk_su /opt/sbin/spk_su</span><br></pre></td></tr></table></figure><p>and also enable multiple identical USB devices, which SAME products have the SAME serial number:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo bash /var/packages/r8152/scripts/install-udev-rules</span><br></pre></td></tr></table></figure><p><img src="/blog/img/Synology%20NAS%20network%20upgrade%20-%20installation%20fix.png" alt="Installation fix" title="Installation fix"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo bash /var/packages/r8152/scripts/install-udev-rules</span><br><span class="line">Updating Hardware Database Index...</span><br><span class="line">UDEV rules have been installed to /usr/lib/udev/rules.d</span><br><span class="line">lrwxrwxrwx 1 root root 50 May 24 17:13 /usr/lib/udev/rules.d/51-usb-r8152-net.rules -&gt; /var/packages/r8152/scripts/51-usb-r8152-net.rules</span><br></pre></td></tr></table></figure><p>and continue &#x2F; retry the installation .</p><ul><li><p>Reboot NAS.</p></li><li><p>Login Synology Admin UI, <strong>Package Center</strong> -&gt; <strong>Installed</strong> -&gt; <strong>RTL8152&#x2F;RTL8153 driver</strong> and check new installed Realtek network adapter driver is running:</p></li></ul><p><img src="/blog/img/Synology%20NAS%20network%20upgrade%20-%20running.png" alt="Running" title="Running"></p><ul><li><strong>Control Panel</strong> -&gt; <strong>Network</strong> -&gt; <strong>Network Interface</strong> and check the new network interface <code>LAN 3</code> and <code>Lan 4</code> have been turned on, with MTU &#x2F; jumbo frame enabled <strong>9000</strong>:</li></ul><p><img src="/blog/img/Synology%20NAS%20network%20upgrade%20-%20new%20network%20interface.png" alt="New network interface" title="New network interface"></p><p>Bind the USB network adapter and run <code>iperf3</code> network performance test:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ iperf3 -c 192.168.0.244 -B 192.168.0.229</span><br><span class="line">Connecting to host 192.168.0.244, port 5201</span><br><span class="line">[  5] local 192.168.0.229 port 46171 connected to 192.168.0.244 port 5201</span><br><span class="line">[ ID] Interval           Transfer     Bitrate         Retr  Cwnd</span><br><span class="line">[  5]   0.00-1.00   sec   281 MBytes  2.36 Gbits/sec    0    450 KBytes</span><br><span class="line">[  5]   1.00-2.00   sec   281 MBytes  2.35 Gbits/sec    0    450 KBytes</span><br><span class="line">[  5]   2.00-3.00   sec   280 MBytes  2.35 Gbits/sec    0    450 KBytes</span><br><span class="line">[  5]   3.00-4.00   sec   281 MBytes  2.35 Gbits/sec    0    450 KBytes</span><br><span class="line">[  5]   4.00-5.00   sec   281 MBytes  2.35 Gbits/sec    0    450 KBytes</span><br><span class="line">[  5]   5.00-6.00   sec   281 MBytes  2.35 Gbits/sec    0    450 KBytes</span><br><span class="line">[  5]   6.00-7.00   sec   281 MBytes  2.35 Gbits/sec    0    450 KBytes</span><br><span class="line">[  5]   7.00-8.00   sec   280 MBytes  2.35 Gbits/sec    0    450 KBytes</span><br><span class="line">[  5]   8.00-9.00   sec   281 MBytes  2.36 Gbits/sec    0    450 KBytes</span><br><span class="line">[  5]   9.00-10.00  sec   281 MBytes  2.36 Gbits/sec    0    670 KBytes</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">[ ID] Interval           Transfer     Bitrate         Retr</span><br><span class="line">[  5]   0.00-10.00  sec  2.74 GBytes  2.35 Gbits/sec    0             sender</span><br><span class="line">[  5]   0.00-10.05  sec  2.74 GBytes  2.34 Gbits/sec                  receiver</span><br><span class="line"></span><br><span class="line">iperf Done.</span><br></pre></td></tr></table></figure><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li>DSM driver for realtek RTL8152&#x2F;RTL8153&#x2F;RTL8156 based USB Ethernet adapters, <em><a href="https://github.com/bb-qq/r8152">https://github.com/bb-qq/r8152</a></em></li><li>Hot plugging does not work, <em><a href="https://github.com/bb-qq/r8152/wiki/Troubleshooting#hot-plugging-does-not-work">https://github.com/bb-qq/r8152/wiki/Troubleshooting#hot-plugging-does-not-work</a></em></li><li>Multiple identical devices do not work, <em><a href="https://github.com/bb-qq/r8152/wiki/Troubleshooting#multiple-identical-devices-do-not-work">https://github.com/bb-qq/r8152/wiki/Troubleshooting#multiple-identical-devices-do-not-work</a></em></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Synology NAS DS920+ with two 1Gbps ethernet adapters. There is an affordable and easy upgrading its gigabytes network path to 2.5Gbps.&lt;/p</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>How to team network (link aggregation) in Windows 11</title>
    <link href="https://terrencemiao.github.io/blog/2024/05/03/How-to-team-network-link-aggregation-in-Windows-11/"/>
    <id>https://terrencemiao.github.io/blog/2024/05/03/How-to-team-network-link-aggregation-in-Windows-11/</id>
    <published>2024-05-03T11:40:36.000Z</published>
    <updated>2024-05-15T11:56:00.374Z</updated>
    
    <content type="html"><![CDATA[<p>Intel Ethernet Converged Network Adapter X710, with two 10Gbps ports. This allows to team the two ports together for link aggregation.</p><ul><li>Install Optional Features <code>Server Manager</code> in Windows 11</li></ul><p><img src="/blog/img/Network%20Team%20-%20Server%20Manager.png" alt="Server Manager" title="Server Manager"></p><ul><li>Open and run Windows Powershell as administrator, then run:</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">New-NetSwitchTeam</span> <span class="literal">-Name</span> <span class="string">&quot;NIC-Team&quot;</span> <span class="literal">-TeamMembers</span> <span class="string">&quot;X710-1&quot;</span>,<span class="string">&quot;X710-2&quot;</span></span><br></pre></td></tr></table></figure><p><img src="/blog/img/Network%20Team%20-%20Connections.png" alt="Network Connections" title="Network Connections"></p><p>A new network interface created, with combined speed <em><strong>20Gbps</strong></em>.</p><p><img src="/blog/img/Network%20Team%20-%20Status.png" alt="Network Status" title="Network Status"></p><p><img src="/blog/img/Network%20Team%20-%20Details.png" alt="Network Details" title="Network Details"></p><p>To remove network team, run:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">Remove-NetSwitchTeam</span> <span class="literal">-Name</span> <span class="string">&quot;NIC-Team&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Intel Ethernet Converged Network Adapter X710, with two 10Gbps ports. This allows to team the two ports together for link aggregation.&lt;/p</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Step by step root OnePlus 5T</title>
    <link href="https://terrencemiao.github.io/blog/2024/04/26/Step-by-step-root-OnePlus-5T/"/>
    <id>https://terrencemiao.github.io/blog/2024/04/26/Step-by-step-root-OnePlus-5T/</id>
    <published>2024-04-26T11:29:42.000Z</published>
    <updated>2024-05-05T04:25:55.185Z</updated>
    
    <content type="html"><![CDATA[<p><strong>OnePlus 5T</strong>, first announced in Nov 2017. 7 years later, has been upgraded to Android 10.0.1, still robust and fast.</p><p><strong>NOTE</strong>: Before you take on this brave journey, make sure <strong>backup</strong> all important files on the phone at first!</p><ul><li><p>First, unlock the bootloader, <em><a href="https://www.lifewire.com/how-to-unlock-bootloader-android-phone-4689186">https://www.lifewire.com/how-to-unlock-bootloader-android-phone-4689186</a></em></p></li><li><p>Enable <strong>Developer Options</strong> in <strong>Settings</strong> -&gt; <strong>About phone</strong> -&gt; <strong>Build number</strong></p></li></ul><p><img src="/blog/img/OnePlus%205T%20-%20About%20phone.jpg" alt="About phone" title="About phone"></p><ul><li>In <strong>Settings</strong> -&gt; <strong>System</strong> -&gt; <strong>Developer options</strong>, enable <strong>Advanced reboot</strong>, <strong>OEM unlocking</strong>, <strong>USB Debugging</strong></li></ul><p><img src="/blog/img/OnePlus%205T%20-%20Developer%20options.jpg" alt="Developer options" title="Developer options"></p><ul><li><p>Download and install Android SDK Platform Tools on Windows <em><a href="https://developer.android.com/tools/releases/platform-tools">https://developer.android.com/tools/releases/platform-tools</a></em></p></li><li><p>Run commands:</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ adb devices</span><br><span class="line">List of devices attached</span><br><span class="line">9b26c76 device</span><br><span class="line"></span><br><span class="line">$ adb reboot bootloader</span><br></pre></td></tr></table></figure><ul><li>Wait for phone to reboot till phone in the <strong>Bootloader</strong> mode, then run:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ fastboot flashing unlock</span><br></pre></td></tr></table></figure><ul><li><p>ON the phone will ask to confirm “UNLOCK THE BOOTLOADER”. After UNLOCK, your phone <strong>WILL BE RESET</strong>, like a factory hard reset. <strong>ALL APPS AND DATA ARE GONE</strong>. Android system will be reinstalled.</p></li><li><p>Go to OnePlus Smartphone Software Update site and download the latest version of OnePlus 5T update on Windows, <em><a href="https://oneplus.net/in/support/softwareupdate">https://oneplus.net/in/support/softwareupdate</a></em></p></li><li><p>Unzip OnePlus 5T update on Widnows</p></li><li><p>On the phone <strong>Settings</strong>, search for <strong>USB Preferences</strong>, select USE USB FOR <strong>File transfer</strong></p></li></ul><p><img src="/blog/img/OnePlus%205T%20-%20USB%20Preferences.jpg" alt="USB Preferences" title="USB Preferences"></p><ul><li><p>On Windows, in File Explorer, copy <strong>OnePlus5TOxygen_43_OTA_069_all_2010292144_76910d123e3940e5&#x2F;boot.img</strong> file to <em><strong>ONEPLUS A5010 -&gt; Internal shared storage -&gt; Download</strong></em> directory on the phone</p></li><li><p>On the phone, download and install latest version Magisk, <em><a href="https://github.com/topjohnwu/Magisk">https://github.com/topjohnwu/Magisk</a></em></p></li><li><p>Run Magisk, select Magisk Install, <em><a href="https://topjohnwu.github.io/Magisk/install.html">https://topjohnwu.github.io/Magisk/install.html</a></em></p></li><li><p>Select and patch <strong>boot.img</strong> file under <em><strong>&#x2F;Download</strong></em> directory</p></li></ul><p><img src="/blog/img/OnePlus%205T%20-%20Magisk.jpg" alt="Magisk" title="Magisk"></p><p><img src="/blog/img/OnePlus%205T%20-%20Magisk%20select%20and%20patch.jpg" alt="Magisk select and patch" title="Magisk select and patch"></p><p><img src="/blog/img/OnePlus%205T%20-%20Magisk%20patch%20boot.jpg" alt="Magisk patch boot.img" title="Magisk patch boot.img"></p><ul><li><p>A patched file <strong>magisk_patched-27000_nplRf</strong> successfully generated. On Windows, in File Explorer, copy it to local directory</p></li><li><p>On Windows, run:</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ fastboot flash boot magisk_patched-27000_nplRf.img</span><br></pre></td></tr></table></figure><p><strong>NOTE</strong>: Always patch boot image on the <strong>SAME</strong> device where you run Magisk.</p><ul><li>Reboot the phone, and install <code>Root Checker</code> to verify Root access, <em><a href="https://play.google.com/store/search?q=root%20checker&c=apps&hl=en&gl=US">https://play.google.com/store/search?q=root%20checker&amp;c=apps&amp;hl=en&amp;gl=US</a></em></li></ul><p>Now OnePlus 5T has been officially <strong>ROOTED</strong>!</p><p><strong>NOTE</strong>: NO need to install <strong>TWRP</strong> (Team Win Recovery Project), <em><a href="https://twrp.me/">https://twrp.me</a></em>, a customised recovery application for Android devices on OnePlus 5T.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;OnePlus 5T&lt;/strong&gt;, first announced in Nov 2017. 7 years later, has been upgraded to Android 10.0.1, still robust and fast.&lt;/p&gt;
</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Upscayl - AI Image Upscaler</title>
    <link href="https://terrencemiao.github.io/blog/2023/12/17/Upscayl-AI-Image-Upscaler/"/>
    <id>https://terrencemiao.github.io/blog/2023/12/17/Upscayl-AI-Image-Upscaler/</id>
    <published>2023-12-17T08:13:45.000Z</published>
    <updated>2023-12-17T08:25:29.957Z</updated>
    
    <content type="html"><![CDATA[<p>Bondi Beach in Upscayl</p><p><img src="/blog/img/Bondi%20Beach%20in%20Upscayl.png" alt="Bondi Beach in Upscayl" title="Bondi Beach in Upscayl"></p><p>Bondi Beach original</p><p><img src="/blog/img/Bondi%20Beach%20original.png" alt="Bondi Beach original" title="Bondi Beach original"></p><p>Bondi Beach upscayled</p><p><img src="/blog/img/Bondi%20Beach%20upscayled.png" alt="Bondi Beach upscayled" title="Bondi Beach upscayled"></p><p>Young Girl in Upscayl</p><p><img src="/blog/img/Young%20Girl%20in%20Upscayl.png" alt="Young Girl in Upscayl" title="Young Girl in Upscayl"></p><p>Young Girl original</p><p><img src="/blog/img/Young%20Girl%20original.jpeg" alt="Young Girl original" title="Young Girl original"></p><p>Young Girl upscayled</p><p><img src="/blog/img/Young%20Girl%20upscayled.png" alt="Young Girl upscayled" title="Young Girl upscayled"></p><h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul><li>Upscayl - AI Image Upscaler, <em><a href="https://www.upscayl.org/">https://www.upscayl.org/</a></em></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Bondi Beach in Upscayl&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/img/Bondi%20Beach%20in%20Upscayl.png&quot; alt=&quot;Bondi Beach in Upscayl&quot; title=&quot;Bondi Beach in Up</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>OpenSSH Server for Windows</title>
    <link href="https://terrencemiao.github.io/blog/2023/11/24/OpenSSH-Server-for-Windows/"/>
    <id>https://terrencemiao.github.io/blog/2023/11/24/OpenSSH-Server-for-Windows/</id>
    <published>2023-11-24T04:59:14.000Z</published>
    <updated>2023-11-24T07:13:01.316Z</updated>
    
    <content type="html"><![CDATA[<p>Want to run <code>OpenSSH</code> Server on Windows e.g. Windows 10. From Windows 10, it natively supports <code>OpenSSH</code>.</p><p><strong>NOTE:</strong> The <em>beta</em> and <em>nightly build</em> of <code>OpenSSH</code> Server for Windows have a lot of runtime issues.</p><p>Check <code>OpenSSH</code> installation:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PS C:\ProgramData\ssh&gt; Get-WindowsCapability -Online | Where-Object Name -like &#x27;OpenSSH*&#x27;</span><br><span class="line"></span><br><span class="line">Name  : OpenSSH.Client~~~~0.0.1.0</span><br><span class="line">State : Installed</span><br><span class="line"></span><br><span class="line">Name  : OpenSSH.Server~~~~0.0.1.0</span><br><span class="line">State : NotPresent</span><br></pre></td></tr></table></figure><p>Install the missing <code>OpenSSH</code> Server:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PS C:\ProgramData\ssh&gt; Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;</span></span><br><span class="line"></span><br><span class="line">Path          :</span><br><span class="line">Online        : True</span><br><span class="line">RestartNeeded : False</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PS C:\ProgramData\ssh&gt; Get-WindowsCapability -Online | Where-Object Name -like &#x27;OpenSSH*&#x27;</span><br><span class="line"></span><br><span class="line">Name  : OpenSSH.Client~~~~0.0.1.0</span><br><span class="line">State : Installed</span><br><span class="line"></span><br><span class="line">Name  : OpenSSH.Server~~~~0.0.1.0</span><br><span class="line">State : Installed</span><br></pre></td></tr></table></figure><p>Check <code>OpenSSH</code> for Windows version, check Windows Operating System version:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PS C:\ProgramData\ssh&gt; ((Get-Item (Get-Command sshd).Source).VersionInfo.FileVersion)</span><br><span class="line">8.1.0.1</span><br><span class="line"></span><br><span class="line">PS C:\ProgramData\ssh&gt; ((Get-ItemProperty &quot;HKLM:\SOFTWARE\Microsoft\Windows nt\CurrentVersion\&quot; -Name ProductName).ProductName)</span><br><span class="line">Windows 10 Enterprise</span><br></pre></td></tr></table></figure><p>Check Windows Domain information:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PS C:\ProgramData\ssh&gt; dsregcmd /status</span><br><span class="line"></span><br><span class="line">+----------------------------------------------------------------------+</span><br><span class="line">| Device State                                                         |</span><br><span class="line">+----------------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">             AzureAdJoined : YES</span><br><span class="line">          EnterpriseJoined : NO</span><br><span class="line">              DomainJoined : YES</span><br><span class="line">                DomainName : CORP</span><br><span class="line">               Device Name : WINDOWS.corp.paradise.local</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>Check <code>OpenSSH</code> Server for Windows run as a service:</p><p><img src="/blog/img/OpenSSH%20SSH%20Server%20service.png" alt="OpenSSH SSH Server service" title="OpenSSH SSH Server service"></p><p>Make sure OpenSSH SSH Server firewall inbound rule allows <strong>ALL</strong> profiles:</p><p><img src="/blog/img/OpenSSH%20SSH%20Server%20firewall%20inbound%20rule.png" alt="OpenSSH SSH Server firewall inbound rule" title="OpenSSH SSH Server firewall inbound rule"></p><p>The default <code>C:\ProgramData\ssh\sshd_config</code> file doesn’t work for Windows Domain users authentication, and does’t support <code>.ssh\authorized_keys</code> public key authentication. Error <strong>lookup_principal_name: User principal name lokup failed for user ‘corp\darling’</strong> in <code>OpenSSH</code> Server <code>C:\ProgramData\ssh\logs\ssd</code> log file. A work around solution is to comment out lines:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#Match Group administrators</span><br><span class="line">#       AuthorizedKeysFile __PROGRAMDATA__/ssh/administrators_authorized_keys</span><br></pre></td></tr></table></figure><p>A complete <code>sshd_config</code> example file:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"># This is the sshd server system-wide configuration file.  See</span><br><span class="line"># sshd_config(5) for more information.</span><br><span class="line"></span><br><span class="line"># The strategy used for options in the default sshd_config shipped with</span><br><span class="line"># OpenSSH is to specify options with their default value where</span><br><span class="line"># possible, but leave them commented.  Uncommented options override the</span><br><span class="line"># default value.</span><br><span class="line"></span><br><span class="line">#Port 22</span><br><span class="line">#AddressFamily any</span><br><span class="line">#ListenAddress 0.0.0.0</span><br><span class="line">#ListenAddress ::</span><br><span class="line"></span><br><span class="line">#HostKey __PROGRAMDATA__/ssh/ssh_host_rsa_key</span><br><span class="line">#HostKey __PROGRAMDATA__/ssh/ssh_host_dsa_key</span><br><span class="line">#HostKey __PROGRAMDATA__/ssh/ssh_host_ecdsa_key</span><br><span class="line">#HostKey __PROGRAMDATA__/ssh/ssh_host_ed25519_key</span><br><span class="line"></span><br><span class="line"># Ciphers and keying</span><br><span class="line">#RekeyLimit default none</span><br><span class="line"></span><br><span class="line"># Logging</span><br><span class="line">SyslogFacility LOCAL0</span><br><span class="line">LogLevel DEBUG3</span><br><span class="line"></span><br><span class="line"># Authentication:</span><br><span class="line"></span><br><span class="line">#LoginGraceTime 2m</span><br><span class="line">#PermitRootLogin prohibit-password</span><br><span class="line">#StrictModes yes</span><br><span class="line">#MaxAuthTries 6</span><br><span class="line">#MaxSessions 10</span><br><span class="line"></span><br><span class="line">#PubkeyAuthentication yes</span><br><span class="line"></span><br><span class="line"># The default is to check both .ssh/authorized_keys and .ssh/authorized_keys2</span><br><span class="line"># but this is overridden so installations will only check .ssh/authorized_keys</span><br><span class="line">AuthorizedKeysFile.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line">#AuthorizedPrincipalsFile none</span><br><span class="line"></span><br><span class="line"># For this to work you will also need host keys in %programData%/ssh/ssh_known_hosts</span><br><span class="line">#HostbasedAuthentication no</span><br><span class="line"># Change to yes if you don&#x27;t trust ~/.ssh/known_hosts for</span><br><span class="line"># HostbasedAuthentication</span><br><span class="line">#IgnoreUserKnownHosts no</span><br><span class="line"># Don&#x27;t read the user&#x27;s ~/.rhosts and ~/.shosts files</span><br><span class="line">#IgnoreRhosts yes</span><br><span class="line"></span><br><span class="line"># To disable tunneled clear text passwords, change to no here!</span><br><span class="line">#PasswordAuthentication yes</span><br><span class="line">#PermitEmptyPasswords no</span><br><span class="line"></span><br><span class="line"># GSSAPI options</span><br><span class="line">#GSSAPIAuthentication no</span><br><span class="line"></span><br><span class="line">#AllowAgentForwarding yes</span><br><span class="line">#AllowTcpForwarding yes</span><br><span class="line">#GatewayPorts no</span><br><span class="line">#PermitTTY yes</span><br><span class="line">#PrintMotd yes</span><br><span class="line">#PrintLastLog yes</span><br><span class="line">#TCPKeepAlive yes</span><br><span class="line">#UseLogin no</span><br><span class="line">#PermitUserEnvironment no</span><br><span class="line">#ClientAliveInterval 0</span><br><span class="line">#ClientAliveCountMax 3</span><br><span class="line">#UseDNS no</span><br><span class="line">#PidFile /var/run/sshd.pid</span><br><span class="line">#MaxStartups 10:30:100</span><br><span class="line">#PermitTunnel no</span><br><span class="line">#ChrootDirectory none</span><br><span class="line">#VersionAddendum none</span><br><span class="line"></span><br><span class="line"># no default banner path</span><br><span class="line">#Banner none</span><br><span class="line"></span><br><span class="line"># override default of no subsystems</span><br><span class="line">Subsystemsftpsftp-server.exe</span><br><span class="line"></span><br><span class="line"># Example of overriding settings on a per-user basis</span><br><span class="line">#Match User anoncvs</span><br><span class="line">#AllowTcpForwarding no</span><br><span class="line">#PermitTTY no</span><br><span class="line">#ForceCommand cvs server</span><br><span class="line"></span><br><span class="line">#Match Group administrators</span><br><span class="line">#       AuthorizedKeysFile __PROGRAMDATA__/ssh/administrators_authorized_keys</span><br></pre></td></tr></table></figure><p>Now run ssh client and log on SSH Server:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sshpass -f ~/.ssh/windows.passwd ssh -l darling windows.local</span></span><br><span class="line">Microsoft Windows [Version 10.0.19044.2965]</span><br><span class="line">(c) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">corp\darling@WINDOWS C:\Users\darling&gt;</span><br></pre></td></tr></table></figure><h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul><li>The Ultimate Guide to Installing OpenSSH on Windows, <em><a href="https://petri.com/the-ultimate-guide-to-installing-openssh-on-windows">https://petri.com/the-ultimate-guide-to-installing-openssh-on-windows</a></em></li><li>Installing SFTP&#x2F;SSH Server on Windows using OpenSSH, <em><a href="https://winscp.net/eng/docs/guide_windows_openssh_server">https://winscp.net/eng/docs/guide_windows_openssh_server</a></em></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Want to run &lt;code&gt;OpenSSH&lt;/code&gt; Server on Windows e.g. Windows 10. From Windows 10, it natively supports &lt;code&gt;OpenSSH&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;s</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Setup Socks/Socks5 proxy and git repo via proxy</title>
    <link href="https://terrencemiao.github.io/blog/2023/10/25/Setup-Socks-Socks5-proxy-and-git-repo-via-proxy/"/>
    <id>https://terrencemiao.github.io/blog/2023/10/25/Setup-Socks-Socks5-proxy-and-git-repo-via-proxy/</id>
    <published>2023-10-25T11:23:53.000Z</published>
    <updated>2023-11-26T00:37:20.283Z</updated>
    
    <content type="html"><![CDATA[<p>Host <code>windows.local</code> has VPN connection which is granted with git repository.</p><ul><li>Setup Socks&#x2F;Socks5 proxy</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ssh-copy-id -i id_rsa.pub darling@windows.local</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ssh -D 3128 -q -C -N -f darling@windows.local</span></span><br></pre></td></tr></table></figure><ul><li>-q: quiet mode, don’t output anything locally</li><li>-C: compress data in the tunnel, save bandwidth</li><li>-N: do not execute remote commands, useful for just forwarding ports</li><li>-f: keep it running in the background</li></ul><p>If <code>PasswordAuthentication</code> is enforced, and <code>pubilc key authentication</code> in SSH Server is not supported, try:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sshpass -f ~/.ssh/windows.passwd ssh -D 3128 -q -C -N -f darling@windows.local</span></span><br></pre></td></tr></table></figure><ul><li>Configure <code>git</code> with Sock&#x2F;Socks5 proxy</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git config http.proxy <span class="string">&#x27;socks5://localhost:3128&#x27;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cat</span> .git/config</span></span><br><span class="line">[user]</span><br><span class="line">name = Terrence Miao</span><br><span class="line">email = terrence.miao@paradise.net</span><br><span class="line">signingkey = EBCEB936</span><br><span class="line">[http]</span><br><span class="line">proxy = socks5://localhost:3128</span><br></pre></td></tr></table></figure><p>Then can access git repository via proxy both on command line and in UI client.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Host &lt;code&gt;windows.local&lt;/code&gt; has VPN connection which is granted with git repository.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Setup Socks&amp;#x2F;Socks5 proxy&lt;/li&gt;
</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Setup ssh ProxyCommand/proxyJump on multiple jump hosts</title>
    <link href="https://terrencemiao.github.io/blog/2023/10/25/Setup-ssh-ProxyCommand-proxyJump-on-multiple-jump-hosts/"/>
    <id>https://terrencemiao.github.io/blog/2023/10/25/Setup-ssh-ProxyCommand-proxyJump-on-multiple-jump-hosts/</id>
    <published>2023-10-25T11:04:00.000Z</published>
    <updated>2023-11-24T05:52:01.837Z</updated>
    
    <content type="html"><![CDATA[<p><strong>NOTE:</strong> Some SSH Server doesn’t allow <strong>public key authentication</strong>. Then <code>sshpass</code> is a friend here for you.</p><p>Install <code>sshpass</code> in MacOS:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">brew install esolitos/ipa/sshpass</span></span><br></pre></td></tr></table></figure><p>Test <code>sshpass</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -oProxyCommand=&quot;sshpass -f ~/.ssh/windows.passwd ssh -W %h:%p jumphost&quot; -l darling jumphost-npe.paradise.net</span><br></pre></td></tr></table></figure><p>Setup <code>.ssh/config</code> file:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">## Keeping SSH Sessions Alive</span><br><span class="line">Host *</span><br><span class="line"> ServerAliveInterval 15</span><br><span class="line"></span><br><span class="line">Host jumphost.mac</span><br><span class="line">    Hostname mac.local</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa</span><br><span class="line">    User darling</span><br><span class="line"></span><br><span class="line">Host jumphost.windows</span><br><span class="line">    Hostname windows.local</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa</span><br><span class="line">    User darling</span><br><span class="line"></span><br><span class="line">Host jumphost-npe</span><br><span class="line">    Hostname jumphost-npe.paradise.net</span><br><span class="line">    User darling</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa</span><br><span class="line">    ProxyCommand sshpass -f ~/.ssh/windows.passwd ssh -W %h:%p jumphost.windows</span><br><span class="line">    IdentitiesOnly yes</span><br><span class="line">    StrictHostKeyChecking no</span><br><span class="line">    UserKnownHostsFile=/dev/null</span><br><span class="line">    ServerAliveInterval 60</span><br><span class="line">    ServerAliveCountMax 5</span><br><span class="line"></span><br><span class="line">## DEVELOPMENT hosts in AWS</span><br><span class="line">Host ip-10-212-*.ap-southeast-2.compute.internal</span><br><span class="line">    ProxyCommand ssh -W %h:%p jumphost-npe</span><br><span class="line">    IdentityFile ~/.ssh/dev-stack.pem</span><br><span class="line"></span><br><span class="line">## PTEST hosts in AWS</span><br><span class="line">Host ip-10-213-*.ap-southeast-2.compute.internal</span><br><span class="line">    ProxyCommand ssh -W %h:%p jumphost-npe</span><br><span class="line">    IdentityFile ~/.ssh/test-stack.pem</span><br><span class="line"></span><br><span class="line">## STEST hosts in AWS</span><br><span class="line">Host ip-10-214-*.ap-southeast-2.compute.internal</span><br><span class="line">    ProxyCommand ssh -W %h:%p jumphost-npe</span><br><span class="line">    IdentityFile ~/.ssh/test-stack.pem</span><br><span class="line"></span><br><span class="line">Host jumphost-prod</span><br><span class="line">    HostName jumphost-prod.paradise.net</span><br><span class="line">    User darling</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa.prod</span><br><span class="line">    ProxyCommand sshpass -f ~/.ssh/windows.passwd ssh -W %h:%p jumphost.windows</span><br><span class="line">    IdentitiesOnly yes</span><br><span class="line">    StrictHostKeyChecking no</span><br><span class="line">    UserKnownHostsFile=/dev/null</span><br><span class="line">    ServerAliveInterval 60</span><br><span class="line">    ServerAliveCountMax 5</span><br><span class="line"></span><br><span class="line">## PROD hosts in AWS</span><br><span class="line">Host ip-10-208-*.ap-southeast-2.compute.internal</span><br><span class="line">    ProxyCommand ssh -W %h:%p jumphost-prod</span><br><span class="line">    IdentityFile ~/.ssh/prod-ddc-stack.pem</span><br><span class="line"></span><br><span class="line">## SSH over Session Manager</span><br><span class="line">host i-* mi-*</span><br><span class="line">    ProxyCommand sh -c &quot;aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters &#x27;portNumber=%p&#x27;&quot;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; Some SSH Server doesn’t allow &lt;strong&gt;public key authentication&lt;/strong&gt;. Then &lt;code&gt;sshpass&lt;/code&gt; is a friend he</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Mac and iPad and Android Benchmark Ceiling</title>
    <link href="https://terrencemiao.github.io/blog/2023/07/29/Mac-and-iPad-and-Android-Benchmark-Ceiling/"/>
    <id>https://terrencemiao.github.io/blog/2023/07/29/Mac-and-iPad-and-Android-Benchmark-Ceiling/</id>
    <published>2023-07-29T13:20:30.000Z</published>
    <updated>2023-10-25T10:54:29.326Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Benchmark-head-to-head-Mac-vs-iPad-vs-Android"><a href="#Benchmark-head-to-head-Mac-vs-iPad-vs-Android" class="headerlink" title="Benchmark head to head - Mac vs. iPad. vs. Android"></a>Benchmark head to head - Mac vs. iPad. vs. Android</h1><p><img src="/blog/img/Geekbench%20head%20to%20head%20-%20Mac%20vs%20iPad%20vs%20Android%202023.png" alt="Benchmark head to head" title="Benchmark head to head"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Benchmark-head-to-head-Mac-vs-iPad-vs-Android&quot;&gt;&lt;a href=&quot;#Benchmark-head-to-head-Mac-vs-iPad-vs-Android&quot; class=&quot;headerlink&quot; title=&quot;Be</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Micro Frontends</title>
    <link href="https://terrencemiao.github.io/blog/2023/07/29/Micro-Frontends/"/>
    <id>https://terrencemiao.github.io/blog/2023/07/29/Micro-Frontends/</id>
    <published>2023-07-29T05:16:56.000Z</published>
    <updated>2023-10-25T10:54:29.326Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/img/Micro%20Frontends.png" alt="Micro Frontends" title="Micro Frontends"></p><p><strong>Righ model, right tools - the new way of building and collaborating on frontend apps is the core element of Micro Frontends.</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;/blog/img/Micro%20Frontends.png&quot; alt=&quot;Micro Frontends&quot; title=&quot;Micro Frontends&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Righ model, right tools - the ne</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Remove Image Background</title>
    <link href="https://terrencemiao.github.io/blog/2022/10/12/Remove-Image-Background/"/>
    <id>https://terrencemiao.github.io/blog/2022/10/12/Remove-Image-Background/</id>
    <published>2022-10-12T11:59:54.000Z</published>
    <updated>2023-10-25T10:54:29.327Z</updated>
    
    <content type="html"><![CDATA[<p>Remove backgrounds 100% automatically in 5 seconds with one click. Thanks to remove.bg <em><a href="https://www.remove.bg/">https://www.remove.bg/</a></em> clever AI.</p><p><img src="/blog/img/Messi%2030.png" alt="Messi" title="Messi"></p><p><img src="/blog/img/%E5%B0%8F%E6%B3%89%E4%BB%8A%E6%97%A5%E5%AD%90.png" alt="小泉今日子" title="小泉今日子"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Remove backgrounds 100% automatically in 5 seconds with one click. Thanks to remove.bg &lt;em&gt;&lt;a href=&quot;https://www.remove.bg/&quot;&gt;https://www.r</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Geekbench head to head - Mac vs iPad vs Android</title>
    <link href="https://terrencemiao.github.io/blog/2022/10/10/Geekbench-head-to-head-Mac-vs-iPad-vs-Android/"/>
    <id>https://terrencemiao.github.io/blog/2022/10/10/Geekbench-head-to-head-Mac-vs-iPad-vs-Android/</id>
    <published>2022-10-10T01:48:30.000Z</published>
    <updated>2023-10-25T10:54:29.325Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Geekbench head to head - Mac vs iPad vs Android:</strong></p><ul><li>10 years old Mac mini Late 2012 (2.6GHz quad-core Intel Core i7 Turbo Boost up to 3.6GHz)</li><li>4 years old MacBook Pro 15-inch Mid 2018 (2.6GHz 6-core Intel Core i7, Turbo Boost up to 4.3GHz)</li><li>4 years old iPad Pro 11” 2018 3rd gen (A12X Bionic 7 nm, 4-core Vortex at 2.5GHz , 4-core Tempest at 1.6GHz)</li><li>1 year old MacBook Pro 16-inch 2021 (Apple Silicon M1 Pro, 10-core CPU at 3.2GHz)</li><li>没满岁的 Android (Snapdragon 8 Gen1, 1 core Cortex-X2 at 3GHz, 3-core Cortex-A710 at 2.5GHz, and 4-core Cortex-A510 at 1.8GHz)</li></ul><p><img src="/blog/img/Geekbench%20head%20to%20head%20-%20Mac%20vs%20iPad%20vs%20Android.png" alt="Geekbench head to head - Mac vs iPad vs Android" title="Geekbench head to head - Mac vs iPad vs Android"></p><p><strong>Conclusion:</strong></p><ol><li>Intel 已经是江河日下，被时代淘汰</li><li>Apple Processors 实在太强。 四年前的处理器还可吊打当前最新的 Snapdragon Processors</li><li>同是 2018 年产品，iPad Pro 把 Intel CPU based 的 MacBook Pro 按在地上碾压</li></ol><p>ARM vs x86 谁是未来，一目了然。</p><p><strong>NOTE</strong></p><p>The Apple M1 chip is built for Macs, and the A15 for phones. They use completely different architectures. The A15 prioritizes battery over performance. The M1 has more firepower for graphics.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;Geekbench head to head - Mac vs iPad vs Android:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;10 years old Mac mini Late 2012 (2.6GHz quad-core Intel Co</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>How to use Web Inspector and debug Safari on iPhone/iPad</title>
    <link href="https://terrencemiao.github.io/blog/2022/09/07/How-to-use-Web-Inspector-and-debug-Safari-on-iPhone-iPad/"/>
    <id>https://terrencemiao.github.io/blog/2022/09/07/How-to-use-Web-Inspector-and-debug-Safari-on-iPhone-iPad/</id>
    <published>2022-09-07T03:32:33.000Z</published>
    <updated>2023-10-25T10:54:29.326Z</updated>
    
    <content type="html"><![CDATA[<p>Prerequisites:</p><ul><li>iPhone &#x2F; iPad &#x2F; iPod and the Macbook on the same version of Safari</li><li>a genuine Apple lightning or USB cable</li></ul><p>Step by step:</p><ul><li>On iPad, iPhone or iPod touch, go to menu Settings &gt; Safari &gt; Advanced and toggle on Web Inspector. Enable JavaScript if it isn’t already on</li><li>On Macbook, launch Safari and go to menu Preferences &gt; Advanced then toggle on “Show Develop menu in menu bar”</li><li>Connect iOS device to Macbook with the lightning or USB cable</li><li>Now on iOS device, open Safari and go to the website you want to debug</li><li>On Macbook, open Safari and go to “Develop” menu. You now see your iOS device that has connected with Macbook (if no page opened on iOS device, you see a message saying “No Inspectable Applications”)</li></ul><p>![Safari Develop menu](&#x2F;img&#x2F;Safari Develop.png “Safari Develop menu”)</p><ul><li>Click on the website in Safari Develop &gt; iOS device menu, Web Inspector window opened, then you can debug as you used to debug in Safari</li></ul><p>![Web Inspector](&#x2F;img&#x2F;Web Inspector.png “Web Inspector”)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Prerequisites:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;iPhone &amp;#x2F; iPad &amp;#x2F; iPod and the Macbook on the same version of Safari&lt;/li&gt;
&lt;li&gt;a genuine Apple lightni</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>GitHub Actions</title>
    <link href="https://terrencemiao.github.io/blog/2022/09/02/GitHub-Actions/"/>
    <id>https://terrencemiao.github.io/blog/2022/09/02/GitHub-Actions/</id>
    <published>2022-09-02T05:33:47.000Z</published>
    <updated>2023-10-25T10:54:29.326Z</updated>
    
    <content type="html"><![CDATA[<p>Have you tried GitHub Actions?</p><ul><li>GitHub Actions</li></ul><p><img src="/blog/img/GitHub%20Actions.png" alt="GitHub Actions" title="GitHub Actions"></p><ul><li>GitHub Actions Workflow</li></ul><p><img src="/blog/img/GitHub%20Actions%20Workflow.png" alt="GitHub Actions Workflow" title="GitHub Actions Workflow"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Have you tried GitHub Actions?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GitHub Actions&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;/blog/img/GitHub%20Actions.png&quot; alt=&quot;GitHub Actions&quot; t</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Powerful Zsh</title>
    <link href="https://terrencemiao.github.io/blog/2022/08/02/Powerful-Zsh/"/>
    <id>https://terrencemiao.github.io/blog/2022/08/02/Powerful-Zsh/</id>
    <published>2022-08-02T09:42:06.000Z</published>
    <updated>2024-05-24T02:53:59.932Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/img/Powerful%20Zsh.png" alt="Powerful Zsh" title="Powerful Zsh"></p><p>First you have <code>Zsh</code>, next install <code>Oh My Zsh</code> <a href="https://ohmyz.sh/">https://ohmyz.sh/</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c &quot;$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)&quot;</span><br></pre></td></tr></table></figure><p>Add <code>Powerlevel10k</code> <em><a href="https://github.com/romkatv/powerlevel10k">https://github.com/romkatv/powerlevel10k</a></em> and configure it</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone --depth=1 https://github.com/romkatv/powerlevel10k.git $&#123;ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom&#125;/themes/powerlevel10k</span><br></pre></td></tr></table></figure><p>Set <code>ZSH_THEME</code> to <strong>powerlevel10k</strong> in <code>.zshrc</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZSH_THEME=&quot;powerlevel10k/powerlevel10k&quot;</span><br></pre></td></tr></table></figure><p>Then run <code>Powerlevel10k</code> configure:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p10k configure</span><br></pre></td></tr></table></figure><p>Add <code>zsh-autosuggestions</code> <em><a href="https://github.com/zsh-users/zsh-autosuggestions">https://github.com/zsh-users/zsh-autosuggestions</a></em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/zsh-users/zsh-autosuggestions $&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;/plugins/zsh-autosuggestions</span><br></pre></td></tr></table></figure><p>Add <code>zsh-syntax-highlighting</code> <em><a href="https://github.com/zsh-users/zsh-syntax-highlighting">https://github.com/zsh-users/zsh-syntax-highlighting</a></em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/zsh-users/zsh-syntax-highlighting.git $&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;/plugins/zsh-syntax-highlighting</span><br></pre></td></tr></table></figure><p>and enable them in <code>.zshrc</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">plugins=(</span><br><span class="line">  zsh-autosuggestions</span><br><span class="line">  zsh-syntax-highlighting</span><br><span class="line">)</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>Install <code>Fig</code> (<strong>deprecated</strong>) <em><del><a href="https://fig.io/">https://fig.io/</a></del></em>, an IDE-style autocomplete but for terminal, and configure in <code>.zshrc</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"># Fig pre block. Keep at the top of this file.</span><br><span class="line">[[ -f &quot;$HOME/.fig/shell/zshrc.pre.zsh&quot; ]] &amp;&amp; . &quot;$HOME/.fig/shell/zshrc.pre.zsh&quot;</span><br><span class="line">...</span><br><span class="line"># Fig post block. Keep at the bottom of this file.</span><br><span class="line">[[ -f &quot;$HOME/.fig/shell/zshrc.post.zsh&quot; ]] &amp;&amp; . &quot;$HOME/.fig/shell/zshrc.post.zsh&quot;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li>How To Make Your Boring Mac Terminal So Much Better, <em><a href="https://www.youtube.com/watch?v=CF1tMjvHDRA">https://www.youtube.com/watch?v=CF1tMjvHDRA</a></em></li><li>How To Setup Your Mac Terminal, <em><a href="https://www.josean.com/posts/terminal-setup">https://www.josean.com/posts/terminal-setup</a></em></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;/blog/img/Powerful%20Zsh.png&quot; alt=&quot;Powerful Zsh&quot; title=&quot;Powerful Zsh&quot;&gt;&lt;/p&gt;
&lt;p&gt;First you have &lt;code&gt;Zsh&lt;/code&gt;, next install &lt;co</summary>
      
    
    
    
    
  </entry>
  
</feed>
