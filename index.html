<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=330279473"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '330279473');
</script>
<!-- End Google Analytics -->

  
  <title>Terrence Miao&#39;s Adventures</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
    <meta name="description" content="Veni, vidi, vici">
  
  
  
    <link rel="alternate" href="/blog/atom.xml" title="Terrence Miao's Adventures" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/blog/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/blog/css/style.css">

  
    
<link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.min.css">

  
  
  
  
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7274218747178099" crossorigin="anonymous"></script>
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">Terrence Miao&#39;s Adventures</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/blog/" id="subtitle">A journey of a thousand miles begins with a single step</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/blog/."><i class="fa fa-home"></i> Home</a>
        
          <a class="main-nav-link" href="/blog/archives/"><i class="fa fa-archive"></i> Archive</a>
        
          <a class="main-nav-link" href="/blog/about/"><i class="fa fa-user"></i> About</a>
        
          <a class="main-nav-link" href="/blog/atom.xml"><i class="fa fa-rss"></i> RSS</a>
        
      </nav>
    </div>
    <div id="search-form">
      <div id="result-mask" class="hide"></div>
      <label><input id="search-key" type="text" autocomplete="off" placeholder="search"></label>
      <div id="result-wrap" class="hide">
        <div id="search-result"></div>
      </div>
      <div class="hide">
        <template id="search-tpl">
          <div class="item">
            <a href="/{path}" title="{title}">
              <div class="title">{title}</div>
              <div class="time">{date}</div>
              <div class="tags">{tags}</div>
            </a>
          </div>
        </template>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  <article id="post-ZeroTier-on-TrueNAS-Scale" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2025/01/25/ZeroTier-on-TrueNAS-Scale/">ZeroTier on TrueNAS Scale</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2025-01-25T02:01:25.000Z" itemprop="datePublished">2025-01-25</time>
</span>
      
      
      
<a href="/blog/2025/01/25/ZeroTier-on-TrueNAS-Scale/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Step by steyp to install <code>ZeroTier</code> on <code>TrueNAS Scale</code>.</p>
<p>Latest version <code>TrueNAS Scale</code> <strong>ElectricEel 24.10</strong>:</p>
<p><img src="/blog/img/ZeroTier%20-%20TrueNAS.png" alt="ZeroTier - TrueNAS" title="ZeroTier - TrueNAS"></p>
<p>Add <code>ZeroTier</code> <strong>Network ID</strong>; enable <strong>Host Network</strong>; leave <strong>Auth Token</strong>, <strong>Identity Public</strong> and <strong>Identity Secret</strong> empty:</p>
<p><img src="/blog/img/ZeroTier%20-%20Configuration.png" alt="ZeroTier - Configuration" title="ZeroTier - Configuration"></p>
<p>On <code>ZeroTier</code> console, authorise <code>TrueNAS</code> access the network:</p>
<p><img src="/blog/img/ZeroTier%20-%20Network.png" alt="ZeroTier - Network" title="ZeroTier - Network"></p>
<p><code>ZeroTier</code> is happily running in <code>TrueNAS</code>:</p>
<p><img src="/blog/img/ZeroTier%20-%20Running.png" alt="ZeroTier - Running" title="ZeroTier - Running"></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>How to install zerotier on TrueNas Scale? <em><a target="_blank" rel="noopener" href="https://www.reddit.com/r/truenas/comments/1dvdp36/how_to_install_zerotier_on_truenas_scale/">https://www.reddit.com/r/truenas/comments/1dvdp36/how_to_install_zerotier_on_truenas_scale/</a></em></li>
</ul>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Xray-X-UI-Reality-protocol-Vision-flow-on-Oracle-Cloud" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2025/01/22/Xray-X-UI-Reality-protocol-Vision-flow-on-Oracle-Cloud/">Xray, X-UI, Reality protocol, Vision flow on Oracle Cloud</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2025-01-22T02:34:40.000Z" itemprop="datePublished">2025-01-22</time>
</span>
      
      
      
<a href="/blog/2025/01/22/Xray-X-UI-Reality-protocol-Vision-flow-on-Oracle-Cloud/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><code>Oracle Cloud</code> instance, which runs <code>Oracle Linux</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -i .ssh/id_rsa_ -l opc 19.214.86.113</span><br><span class="line"></span><br><span class="line">$ sudo -i</span><br><span class="line">[root@apocalypse ~]#</span><br></pre></td></tr></table></figure>

<p>Install <code>X-UI</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@apocalypse ~]# bash &lt;(curl -Ls https://raw.githubusercontent.com/FranzKafkaYu/x-ui/master/install_en.sh)</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">2025-01-21 23:05:50 (100 MB/s) - ‘/usr/bin/x-ui’ saved [25637/25637]</span><br><span class="line"></span><br><span class="line">Install/update finished need to modify panel settings out of security</span><br><span class="line">are you continue,if you type n will skip this at this time[y/n]: y</span><br><span class="line">please set up your username: admin</span><br><span class="line">your username will be: admin</span><br><span class="line">please set up your password: password</span><br><span class="line">your password will be: password</span><br><span class="line">please set up the panel port: 10080</span><br><span class="line">your panel port is: 10080</span><br><span class="line">initializing,wait some time here...</span><br><span class="line">set username and password success</span><br><span class="line">account name and password set down!</span><br><span class="line">set port 10080 successpanel port set down!</span><br><span class="line">x-ui v0.3.4.4 install finished,it is working now...</span><br><span class="line"></span><br><span class="line">x-ui control menu usages: </span><br><span class="line">----------------------------------------------</span><br><span class="line">x-ui              - Enter     control menu</span><br><span class="line">x-ui start        - Start     x-ui </span><br><span class="line">x-ui stop         - Stop      x-ui </span><br><span class="line">x-ui restart      - Restart   x-ui </span><br><span class="line">x-ui status       - Show      x-ui status</span><br><span class="line">x-ui enable       - Enable    x-ui on system startup</span><br><span class="line">x-ui disable      - Disable   x-ui on system startup</span><br><span class="line">x-ui log          - Check     x-ui logs</span><br><span class="line">x-ui update       - Update    x-ui </span><br><span class="line">x-ui install      - Install   x-ui </span><br><span class="line">x-ui uninstall    - Uninstall x-ui </span><br><span class="line">x-ui geo          - Update    geo  data</span><br><span class="line">----------------------------------------------</span><br></pre></td></tr></table></figure>

<p>Find the root path of <code>X-UI</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-237-45-6-183 ~]# x-ui</span><br><span class="line"></span><br><span class="line">  x-ui control menu</span><br><span class="line">  0. exit</span><br><span class="line">————————————————</span><br><span class="line">  1. install   x-ui</span><br><span class="line">  2. update    x-ui</span><br><span class="line">  3. uninstall x-ui</span><br><span class="line">————————————————</span><br><span class="line">  4. reset username</span><br><span class="line">  5. reset panel</span><br><span class="line">  6. reset panel port</span><br><span class="line">  7. check panel info</span><br><span class="line">————————————————</span><br><span class="line">  8. start x-ui</span><br><span class="line">  9. stop  x-ui</span><br><span class="line">  10. restart x-ui</span><br><span class="line">  11. check x-ui status</span><br><span class="line">  12. check x-ui logs</span><br><span class="line">————————————————</span><br><span class="line">  13. enable  x-ui on system startup</span><br><span class="line">  14. disable x-ui on system startup</span><br><span class="line">————————————————</span><br><span class="line">  15. enable bbr </span><br><span class="line">  16. issuse certs</span><br><span class="line">  17. x-ui cron jobs</span><br><span class="line"> </span><br><span class="line">x-ui status: running</span><br><span class="line">enable on system startup: yes</span><br><span class="line">xray status: running</span><br><span class="line"></span><br><span class="line">please input a legal number[0-16],input 7 for checking login info:7</span><br><span class="line">[INF] 当前面板信息[current panel info]:</span><br><span class="line">面板版本[version]: 0.3.4.4:20230717</span><br><span class="line">用户名[username]: admin</span><br><span class="line">密码[userpasswd]: password</span><br><span class="line">监听端口[port]: 10080</span><br><span class="line">根路径[rootPath]: /xui/ </span><br></pre></td></tr></table></figure>

<p>Add new Inbound:</p>
<p><img src="/blog/img/X-UI%20-%20Oracle%20Cloud%20Inbound.png" alt="X-UI - Oracle Cloud Inbound" title="X-UI - Oracle Cloud Inbound"></p>
<p>Open <code>X-UI</code> panel port and <code>VLESS</code> port in <code>Oracle Cloud</code> firewall:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@apocalypse ~]# firewall-cmd --zone=public --permanent --add-port=10080/tcp</span><br><span class="line">success</span><br><span class="line"></span><br><span class="line">[root@apocalypse ~]# firewall-cmd --zone=public --permanent --add-port=32854/tcp</span><br><span class="line">success</span><br><span class="line"></span><br><span class="line">[root@apocalypse ~]# firewall-cmd --reload</span><br><span class="line">success</span><br></pre></td></tr></table></figure>

<p>Open <code>X-UI</code> panel port and <code>VLESS</code> port in <code>Oracle Cloud</code> <strong>Security List Ingress Rules</strong>:</p>
<p><img src="/blog/img/X-UI%20-%20Oracle%20Cloud.png" alt="X-UI - Oracle Cloud" title="X-UI - Oracle Cloud"></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>Host an XTLS Vless+Vision+REALITY server on Oracle Always Free <em><a target="_blank" rel="noopener" href="https://iopq.wordpress.com/2024/02/27/host-an-xtls-vlessvisionreality-server-on-oracle/">https://iopq.wordpress.com/2024/02/27/host-an-xtls-vlessvisionreality-server-on-oracle/</a></em></li>
<li>Oracle Database Cloud — Open Ports on OCI <em><a target="_blank" rel="noopener" href="https://medium.com/@fathi.ria/oracle-database-cloud-open-ports-on-oci-1af24f4eb9f2">https://medium.com/@fathi.ria/oracle-database-cloud-open-ports-on-oci-1af24f4eb9f2</a></em></li>
</ul>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Xray-X-UI-Reality-protocol-Vision-flow-on-Amazon-Linux" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2025/01/22/Xray-X-UI-Reality-protocol-Vision-flow-on-Amazon-Linux/">Xray, X-UI, Reality protocol, Vision flow on Amazon Linux</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2025-01-21T22:48:08.000Z" itemprop="datePublished">2025-01-22</time>
</span>
      
      
      
<a href="/blog/2025/01/22/Xray-X-UI-Reality-protocol-Vision-flow-on-Amazon-Linux/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>AWS EC2 instance, which runs <code>Amazon Linux</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -i .ssh/aws-free-tier.pem -l ec2-user ec2-203-129-56-97.ap-southeast-2.compute.amazonaws.com</span><br><span class="line">   ,     #_</span><br><span class="line">   ~\_  ####_        Amazon Linux 2023</span><br><span class="line">  ~~  \_#####\</span><br><span class="line">  ~~     \###|</span><br><span class="line">  ~~       \#/ ___   https://aws.amazon.com/linux/amazon-linux-2023</span><br><span class="line">   ~~       V~&#x27; &#x27;-&gt;</span><br><span class="line">    ~~~         /</span><br><span class="line">      ~~._.   _/</span><br><span class="line">         _/ _/</span><br><span class="line">       _/m/&#x27;</span><br><span class="line"></span><br><span class="line">$ sudo -i</span><br><span class="line">[root@ip-237-45-6-183 ~]#</span><br></pre></td></tr></table></figure>

<p>Install <code>X-UI</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-237-45-6-183 ~]# bash &lt;(curl -Ls https://raw.githubusercontent.com/FranzKafkaYu/x-ui/master/install_en.sh)</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">2025-01-21 23:05:50 (100 MB/s) - ‘/usr/bin/x-ui’ saved [25637/25637]</span><br><span class="line"></span><br><span class="line">Install/update finished need to modify panel settings out of security</span><br><span class="line">are you continue,if you type n will skip this at this time[y/n]: y</span><br><span class="line">please set up your username: admin</span><br><span class="line">your username will be: admin</span><br><span class="line">please set up your password: password</span><br><span class="line">your password will be: password</span><br><span class="line">please set up the panel port: 10080</span><br><span class="line">your panel port is: 10080</span><br><span class="line">initializing,wait some time here...</span><br><span class="line">set username and password success</span><br><span class="line">account name and password set down!</span><br><span class="line">set port 10080 successpanel port set down!</span><br><span class="line">x-ui v0.3.4.4 install finished,it is working now...</span><br><span class="line"></span><br><span class="line">x-ui control menu usages: </span><br><span class="line">----------------------------------------------</span><br><span class="line">x-ui              - Enter     control menu</span><br><span class="line">x-ui start        - Start     x-ui </span><br><span class="line">x-ui stop         - Stop      x-ui </span><br><span class="line">x-ui restart      - Restart   x-ui </span><br><span class="line">x-ui status       - Show      x-ui status</span><br><span class="line">x-ui enable       - Enable    x-ui on system startup</span><br><span class="line">x-ui disable      - Disable   x-ui on system startup</span><br><span class="line">x-ui log          - Check     x-ui logs</span><br><span class="line">x-ui update       - Update    x-ui </span><br><span class="line">x-ui install      - Install   x-ui </span><br><span class="line">x-ui uninstall    - Uninstall x-ui </span><br><span class="line">x-ui geo          - Update    geo  data</span><br><span class="line">----------------------------------------------</span><br></pre></td></tr></table></figure>

<p>Change AWS security group, and open EC2 instance port <code>10080</code> to admin user’s IP address only.</p>
<p>Find the root path of <code>X-UI</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-237-45-6-183 ~]# x-ui</span><br><span class="line"></span><br><span class="line">  x-ui control menu</span><br><span class="line">  0. exit</span><br><span class="line">————————————————</span><br><span class="line">  1. install   x-ui</span><br><span class="line">  2. update    x-ui</span><br><span class="line">  3. uninstall x-ui</span><br><span class="line">————————————————</span><br><span class="line">  4. reset username</span><br><span class="line">  5. reset panel</span><br><span class="line">  6. reset panel port</span><br><span class="line">  7. check panel info</span><br><span class="line">————————————————</span><br><span class="line">  8. start x-ui</span><br><span class="line">  9. stop  x-ui</span><br><span class="line">  10. restart x-ui</span><br><span class="line">  11. check x-ui status</span><br><span class="line">  12. check x-ui logs</span><br><span class="line">————————————————</span><br><span class="line">  13. enable  x-ui on system startup</span><br><span class="line">  14. disable x-ui on system startup</span><br><span class="line">————————————————</span><br><span class="line">  15. enable bbr </span><br><span class="line">  16. issuse certs</span><br><span class="line">  17. x-ui cron jobs</span><br><span class="line"> </span><br><span class="line">x-ui status: running</span><br><span class="line">enable on system startup: yes</span><br><span class="line">xray status: running</span><br><span class="line"></span><br><span class="line">please input a legal number[0-16],input 7 for checking login info:7</span><br><span class="line">[INF] 当前面板信息[current panel info]:</span><br><span class="line">面板版本[version]: 0.3.4.4:20230717</span><br><span class="line">用户名[username]: admin</span><br><span class="line">密码[userpasswd]: password</span><br><span class="line">监听端口[port]: 10080</span><br><span class="line">根路径[rootPath]: /WMa7/ </span><br></pre></td></tr></table></figure>

<p>In <code>Firefox</code>, go to <em><a target="_blank" rel="noopener" href="http://203.129.56.97:10080/WMa7/">http://203.129.56.97:10080/WMa7/</a></em> and login as <strong>admin</strong> user:</p>
<p><img src="/blog/img/X-UI%20-%20Login.png" alt="X-UI - Login" title="X-UI - Login"></p>
<p><img src="/blog/img/X-UI%20-%20Panel.png" alt="X-UI - Panel" title="X-UI - Panel"></p>
<p>Switch to the latest version <code>Xray</code> e.g. <code>v24.12.31</code>:</p>
<p><img src="/blog/img/X-UI%20-%20Xray.png" alt="X-UI - Xray" title="X-UI - Xray"></p>
<p>Add new Inbound:</p>
<p><img src="/blog/img/X-UI%20-%20Inbound.png" alt="X-UI - Inbound" title="X-UI - Inbound"></p>
<p>Open up port <strong>32609</strong> to the world <strong>0.0.0.0&#x2F;0</strong> in AWS security group.</p>
<p>Copy inbound QR link:</p>
<p><img src="/blog/img/X-UI%20-%20QR.png" alt="X-UI - QR" title="X-UI - QR"></p>
<p><img src="/blog/img/X-UI%20-%20QR%20Link.png" alt="X-UI - QR Link" title="X-UI - QR Link"></p>
<p>and paste to <code>Xray</code> Windows client e.g. <code>v2rayN</code>:</p>
<p><img src="/blog/img/X-UI%20-%20v2rayN.png" alt="X-UI - v2rayN" title="X-UI - v2rayN"></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>无敌的 Xray – Reality 协议！Vless + Reality协议 + Vision流控，是否能够摆平一切顾虑！ <em><a target="_blank" rel="noopener" href="https://v2rayssr.com/reality.html">https://v2rayssr.com/reality.html</a></em></li>
<li>波仔分享 - 无敌的 Xray - Reality 协议！无须域名和证书的 Reality 协议 + Vision 流控，是否能够摆平一切顾虑！Reality 指向网站寻找，Reality 客户端推荐（关联节点搭建&#x2F;科学上网）<em><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=DO1_C9YWOYY">https://www.youtube.com/watch?v=DO1_C9YWOYY</a></em></li>
<li>x-ui <em><a target="_blank" rel="noopener" href="https://github.com/FranzKafkaYu/x-ui/">https://github.com/FranzKafkaYu/x-ui/</a></em></li>
<li>Qualys. SSL Labs <em><a target="_blank" rel="noopener" href="https://www.ssllabs.com/ssltest/index.html">https://www.ssllabs.com/ssltest/index.html</a></em></li>
</ul>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-How-to-install-and-run-Tailscale-client-on-OpenWrt" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/12/21/How-to-install-and-run-Tailscale-client-on-OpenWrt/">How to install and run Tailscale client on OpenWrt</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-12-21T03:44:32.000Z" itemprop="datePublished">2024-12-21</time>
</span>
      
      
      
<a href="/blog/2024/12/21/How-to-install-and-run-Tailscale-client-on-OpenWrt/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Install <code>Tailscale</code> package <strong>iptables-nft</strong> and <strong>tailscale</strong> from <code>OpenWrt</code> console:</p>
<p><img src="/blog/img/OpenWrt%20-%20Tailscale%20iptables-nft.png" alt="OpenWrt - Tailscale iptables-nft" title="OpenWrt - Tailscale iptables-nft"></p>
<p><img src="/blog/img/OpenWrt%20-%20Tailscale.png" alt="OpenWrt - Tailscale" title="OpenWrt - Tailscale"></p>
<p>Enable and connect <code>Tailscale</code> service in <code>OpenWrt</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -l root SenseWrt</span><br><span class="line">root@SenseWrt&#x27;s password: </span><br><span class="line"></span><br><span class="line">BusyBox v1.36.1 (2024-12-03 11:41:08 UTC) built-in shell (ash)</span><br><span class="line"></span><br><span class="line">  _______                     ________        __</span><br><span class="line"> |       |.-----.-----.-----.|  |  |  |.----.|  |_</span><br><span class="line"> |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|</span><br><span class="line"> |_______||   __|_____|__|__||________||__|  |____|</span><br><span class="line">          |__| W I R E L E S S   F R E E D O M</span><br><span class="line"> -----------------------------------------------------</span><br><span class="line"> OpenWrt 24.10.0-rc2, r28161-ea17e958b9</span><br><span class="line"> -----------------------------------------------------</span><br><span class="line"> </span><br><span class="line">root@SenseWrt:~# tailscale up --netfilter-mode=off --advertise-routes=192.168.88.0/24 --accept-routes</span><br><span class="line">Warning: netfilter=off; configure iptables yourself.</span><br><span class="line">Warning: UDP GRO forwarding is suboptimally configured on eth1, UDP forwarding throughput capability will increase with a configuration change.</span><br><span class="line">See https://tailscale.com/s/ethtool-config-udp-gro</span><br><span class="line"></span><br><span class="line">To authenticate, visit:</span><br><span class="line"></span><br><span class="line">	https://login.tailscale.com/a/98c452901c4ba</span><br><span class="line"></span><br><span class="line">Success.</span><br></pre></td></tr></table></figure>

<p><strong>NOTE:</strong> <strong>192.168.88.0&#x2F;24</strong> is the ip range of local network setup in <code>OpenWrt</code>.</p>
<p>Disable key expiry for <code>OpenWrt</code> machine in <code>Tailscale</code> console, then enable all <code>OpenWrt</code> clients access <code>Tailscale</code> network:</p>
<p><img src="/blog/img/OpenWrt%20-%20Tailscale%20Machines.png" alt="OpenWrt - Tailscale Machines" title="OpenWrt - Tailscale Machines"></p>
<p>Now add <code>Tailscale</code> virtual network as a new interface in <code>OpenWrt</code>:</p>
<p><img src="/blog/img/OpenWrt%20-%20Tailscale%20Network%20Interface.png" alt="OpenWrt - Tailscale Network Interface" title="OpenWrt - Tailscale Network Interface"></p>
<p>Create firewall for <code>Tailscale</code> virtual network interface in <code>OpenWrt</code>:</p>
<p><img src="/blog/img/OpenWrt%20-%20Tailscale%20Firewall.png" alt="OpenWrt - Tailscale Firewall" title="OpenWrt - Tailscale Firewall"></p>
<p>Configure firewall for <code>Tailscale</code> virtual network interface in <code>OpenWrt</code>:</p>
<p><img src="/blog/img/OpenWrt%20-%20Tailscale%20Firewall%20General%20Settings.png" alt="OpenWrt - Tailscale Firewall General Settings" title="OpenWrt - Tailscale Firewall General Settings"></p>
<p><strong>NOTE:</strong> <strong>opt</strong> network is for the downstream DHCP clients.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>韩风 Talk - Tailscale 玩法之内网穿透、异地组网、全隧道模式、纯 IP 的双栈 DERP 搭建、Headscale 协调服务器搭建，用一期搞定，看一看不亏吧？<em><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=mgDpJX3oNvI">https://www.youtube.com/watch?v=mgDpJX3oNvI</a></em></li>
</ul>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-How-to-install-and-run-ZeroTier-client-on-OpenWrt" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/12/21/How-to-install-and-run-ZeroTier-client-on-OpenWrt/">How to install and run ZeroTier client on OpenWrt</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-12-21T00:08:18.000Z" itemprop="datePublished">2024-12-21</time>
</span>
      
      
      
<a href="/blog/2024/12/21/How-to-install-and-run-ZeroTier-client-on-OpenWrt/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Install <code>ZeroTier</code> package <strong>zerotier</strong> from <code>OpenWrt</code> console:</p>
<p><img src="/blog/img/OpenWrt%20-%20ZeroTier.png" alt="OpenWrt - ZeroTier" title="OpenWrt - ZeroTier"></p>
<p>Enable <code>ZeroTier</code> service in <code>OpenWrt</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -l root SenseWrt</span><br><span class="line">root@SenseWrt&#x27;s password: </span><br><span class="line"></span><br><span class="line">BusyBox v1.36.1 (2024-12-03 11:41:08 UTC) built-in shell (ash)</span><br><span class="line"></span><br><span class="line">  _______                     ________        __</span><br><span class="line"> |       |.-----.-----.-----.|  |  |  |.----.|  |_</span><br><span class="line"> |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|</span><br><span class="line"> |_______||   __|_____|__|__||________||__|  |____|</span><br><span class="line">          |__| W I R E L E S S   F R E E D O M</span><br><span class="line"> -----------------------------------------------------</span><br><span class="line"> OpenWrt 24.10.0-rc2, r28161-ea17e958b9</span><br><span class="line"> -----------------------------------------------------</span><br><span class="line"></span><br><span class="line">root@SenseWrt:~# cat /etc/config/zerotier </span><br><span class="line"></span><br><span class="line">config zerotier &#x27;global&#x27;</span><br><span class="line">	# Sets whether ZeroTier is enabled or not</span><br><span class="line">	option enabled 1</span><br><span class="line">	# Sets the ZeroTier listening port (default 9993; set to 0 for random)</span><br><span class="line">	#option port &#x27;9993&#x27;</span><br><span class="line">	# Client secret (leave blank to generate a secret on first run)</span><br><span class="line">	option secret &#x27;&#x27;</span><br><span class="line">	# Path of the optional file local.conf (see documentation at</span><br><span class="line">	# https://docs.zerotier.com/config#local-configuration-options)</span><br><span class="line">	#option local_conf_path &#x27;/etc/zerotier.conf&#x27;</span><br><span class="line">	# Persistent configuration directory (to perform other configurations such</span><br><span class="line">	# as controller mode or moons, etc.)</span><br><span class="line">	#option config_path &#x27;/etc/zerotier&#x27;</span><br><span class="line">	# Copy the contents of the persistent configuration directory to memory</span><br><span class="line">	# instead of linking it, this avoids writing to flash</span><br><span class="line">	#option copy_config_path &#x27;1&#x27;</span><br><span class="line"></span><br><span class="line"># Network configuration, you can have as many configurations as networks you</span><br><span class="line"># want to join (the network name is optional)</span><br><span class="line">config network &#x27;earth&#x27;</span><br><span class="line">	# Identifier of the network you wish to join</span><br><span class="line">	option id &#x27;8ca917257083e297&#x27;</span><br><span class="line">	# Network configuration parameters (all are optional, if not indicated the</span><br><span class="line">	# default values are set, see documentation at</span><br><span class="line">	# https://docs.zerotier.com/config/#network-specific-configuration)</span><br><span class="line">	option allow_managed &#x27;1&#x27;</span><br><span class="line">	option allow_global &#x27;0&#x27;</span><br><span class="line">	option allow_default &#x27;0&#x27;</span><br><span class="line">	option allow_dns &#x27;0&#x27;</span><br><span class="line"></span><br><span class="line"># Example of a second network (unnamed as it is optional)</span><br><span class="line">#config network</span><br><span class="line">#	option id &#x27;1234567890123456&#x27;</span><br><span class="line">#	option allow_managed &#x27;1&#x27;</span><br><span class="line">#	option allow_global &#x27;0&#x27;</span><br><span class="line">#	option allow_default &#x27;0&#x27;</span><br><span class="line">#	option allow_dns &#x27;0&#x27;</span><br></pre></td></tr></table></figure>

<p>Restart <code>ZeroTier</code> service:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ root@SenseWrt:~# /etc/init.d/zerotier restart</span><br><span class="line">Generating secret - please wait... done.</span><br></pre></td></tr></table></figure>

<p>Verify <code>ZeroTier</code> client status, which <strong>ztks555nye</strong> is the virtual network interface created on <code>OpenWrt</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@SenseWrt:~# zerotier-cli listnetworks</span><br><span class="line">200 listnetworks &lt;nwid&gt; &lt;name&gt; &lt;mac&gt; &lt;status&gt; &lt;type&gt; &lt;dev&gt; &lt;ZT assigned ips&gt;</span><br><span class="line">200 listnetworks 8ca917257083e297 igloo.studio 9a:09:7b:41:3d:26 OK PRIVATE ztks555nye 192.168.196.176/24</span><br></pre></td></tr></table></figure>

<p>Enable and authorise the new <code>ZeroTier</code> client <code>OpenWrt</code> in <em><a target="_blank" rel="noopener" href="https://my.zerotier.com/">https://my.zerotier.com/</a></em>.</p>
<p>Now add <code>ZeroTier</code> virtual network as a new interface in <code>OpenWrt</code>:</p>
<p><img src="/blog/img/OpenWrt%20-%20ZeroTier%20Network%20Interface.png" alt="OpenWrt - ZeroTier Network Interface" title="OpenWrt - ZeroTier Network Interface"></p>
<p>Create firewall for <code>ZeroTier</code> virtual network interface in <code>OpenWrt</code>:</p>
<p><img src="/blog/img/OpenWrt%20-%20ZeroTier%20Firewall.png" alt="OpenWrt - ZeroTier Firewall" title="OpenWrt - ZeroTier Firewall"></p>
<p>Configure firewall for <code>ZeroTier</code> virtual network interface in <code>OpenWrt</code>:</p>
<p><img src="/blog/img/OpenWrt%20-%20ZeroTier%20Firewall%20General%20Settings.png" alt="OpenWrt - ZeroTier Firewall General Settings" title="OpenWrt - ZeroTier Firewall General Settings"></p>
<p><strong>NOTE:</strong> <strong>opt</strong> network is for the downstream DHCP clients.</p>
<p>Add <strong>Allow-ZeroTier</strong> firewall rule:</p>
<p><img src="/blog/img/OpenWrt%20-%20ZeroTier%20Firewall%20Rule.png" alt="OpenWrt - ZeroTier Firewall Rule" title="OpenWrt - ZeroTier Firewall Rule"></p>
<p>Restart <code>ZeroTier</code> service again:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ root@SenseWrt:~# /etc/init.d/zerotier restart</span><br><span class="line">Generating secret - please wait... done.</span><br></pre></td></tr></table></figure>

<p>Then all <code>OpenWrt</code> clients can access <code>ZeroTier</code> network now.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>韩风 Talk - 内网穿透工具 ZeroTier，从简单到复杂的玩法，无保留，一期全放送 <em><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=pa0tkch3lss">https://www.youtube.com/watch?v=pa0tkch3lss</a></em></li>
<li>ZeroTier Terminology - Planet server, Moon server and client node (LEAF) <em><a target="_blank" rel="noopener" href="https://www.wlink-tech.com/art/about-zerotier">https://www.wlink-tech.com/art/about-zerotier</a></em></li>
</ul>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Connecting-OpenWRT-to-internet" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/12/05/Connecting-OpenWRT-to-internet/">Connecting OpenWRT to internet</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-12-05T03:19:34.000Z" itemprop="datePublished">2024-12-05</time>
</span>
      
      
      
<a href="/blog/2024/12/05/Connecting-OpenWRT-to-internet/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><code>OpenWRT</code> is running on <code>Proxmox</code>. Now setting up it to connect internet.</p>
<p>Add new network interface <strong>OPT</strong> on <strong>eth2</strong> adapter:</p>
<p><img src="/blog/img/OpenWRT%20-%20OPT%20Interface.png" alt="OpenWRT - OPT Interface" title="OpenWRT - OPT Interface"></p>
<p><img src="/blog/img/OpenWRT%20-%20OPT%20Advanced%20Settings.png" alt="OpenWRT - OPT Advanced Settings" title="OpenWRT - OPT Advanced Settings"></p>
<p><img src="/blog/img/OpenWRT%20-%20OPT%20Firewall%20Settings.png" alt="OpenWRT - OPT Firewall Settings" title="OpenWRT - OPT Firewall Settings"></p>
<p><img src="/blog/img/OpenWRT%20-%20OPT%20DHCP%20Server%20General%20Setup.png" alt="OpenWRT - OPT DHCP Server General Setup" title="OpenWRT - OPT DHCP Server General Setup"></p>
<p><img src="/blog/img/OpenWRT%20-%20OPT%20DHCP%20Server%20Advanced%20Settings.png" alt="OpenWRT - OPT DHCP Server Advanced Settings" title="OpenWRT - OPT DHCP Server Advanced Settings"></p>
<p><img src="/blog/img/OpenWRT%20-%20OPT%20DHCP%20Server%20IPv6%20Settings.png" alt="OpenWRT - OPT DHCP Server IPv6 Settings" title="OpenWRT - OPT DHCP Server IPv6 Settings"></p>
<p><img src="/blog/img/OpenWRT%20-%20OPT%20DHCP%20Server%20IPv6%20RA%20Settings.png" alt="OpenWRT - OPT DHCP Server IPv6 RA Settings" title="OpenWRT - OPT DHCP Server IPv6 RA Settings"></p>
<p><img src="/blog/img/OpenWRT%20-%20OPT.png" alt="OpenWRT - OPT" title="OpenWRT - OPT"></p>
<p>Add a new Firewall Zone, from network <strong>opt</strong> to <strong>wan</strong>:</p>
<p><img src="/blog/img/OpenWRT%20-%20Firewall%20Zone%20General%20Settings.png" alt="OpenWRT - Firewall Zone General Settings" title="OpenWRT - Firewall Zone General Settings"></p>
<p><img src="/blog/img/OpenWRT%20-%20Firewall%20Zone%20Advanced%20Settings.png" alt="OpenWRT - Firewall Zone Advanced Settings" title="OpenWRT - Firewall Zone Advanced Settings"></p>
<p><img src="/blog/img/OpenWRT%20-%20Firewall%20Zone%20Conntrack%20Settings.png" alt="OpenWRT - Firewall Zone Conntrack Settings" title="OpenWRT - Firewall Zone Conntrack Settings"></p>
<p><img src="/blog/img/OpenWRT%20-%20Firewall%20Zone.png" alt="OpenWRT - Firewall Zone" title="OpenWRT - Firewall Zone"></p>
<p>Add a new Firewall Traffic Rule for network <strong>opt</strong>:</p>
<p><img src="/blog/img/OpenWRT%20-%20Firewall%20Traffic%20Rule%20General%20Settings.png" alt="OpenWRT - Firewall Traffic Rule General Settings" title="OpenWRT - Firewall Traffic Rule General Settings"></p>
<p><img src="/blog/img/OpenWRT%20-%20Firewall%20Traffic%20Rule%20Advanced%20Settings.png" alt="OpenWRT - Firewall Traffic Rule Advanced Settings" title="OpenWRT - Firewall Traffic Rule Advanced Settings"></p>
<p><img src="/blog/img/OpenWRT%20-%20Firewall%20Traffic%20Rule%20Time%20Restrictions.png" alt="OpenWRT - Firewall Traffic Rule Time Restrictions" title="OpenWRT - Firewall Traffic Rule Time Restrictions"></p>
<p><img src="/blog/img/OpenWRT%20-%20Firewall%20Traffic%20Rule.png" alt="OpenWRT - Firewall Traffic Rule" title="OpenWRT - Firewall Traffic Rule"></p>
<p>Setup DHCP clients’ static IP addresses:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -l root 192.168.2.1</span><br><span class="line">root@192.168.2.1&#x27;s password:</span><br><span class="line"></span><br><span class="line">BusyBox v1.36.1 (2024-09-23 12:34:46 UTC) built-in shell (ash)</span><br><span class="line"></span><br><span class="line">  _______                     ________        __</span><br><span class="line"> |       |.-----.-----.-----.|  |  |  |.----.|  |_</span><br><span class="line"> |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|</span><br><span class="line"> |_______||   __|_____|__|__||________||__|  |____|</span><br><span class="line">          |__| W I R E L E S S   F R E E D O M</span><br><span class="line"> -----------------------------------------------------</span><br><span class="line"> OpenWrt 23.05.5, r24106-10cc5fcd00</span><br><span class="line"> -----------------------------------------------------</span><br><span class="line"></span><br><span class="line">root@OpenWRT:~# cat /etc/config/dhcp</span><br><span class="line">config dnsmasq</span><br><span class="line">	option domainneeded &#x27;1&#x27;</span><br><span class="line">	option localise_queries &#x27;1&#x27;</span><br><span class="line">	option rebind_protection &#x27;1&#x27;</span><br><span class="line">	option rebind_localhost &#x27;1&#x27;</span><br><span class="line">	option local &#x27;/local/&#x27;</span><br><span class="line">	option domain &#x27;local&#x27;</span><br><span class="line">	option expandhosts &#x27;1&#x27;</span><br><span class="line">	option cachesize &#x27;1000&#x27;</span><br><span class="line">	option authoritative &#x27;1&#x27;</span><br><span class="line">	option readethers &#x27;1&#x27;</span><br><span class="line">	option leasefile &#x27;/tmp/dhcp.leases&#x27;</span><br><span class="line">	option resolvfile &#x27;/tmp/resolv.conf.d/resolv.conf.auto&#x27;</span><br><span class="line">	option localservice &#x27;1&#x27;</span><br><span class="line">	option ednspacket_max &#x27;1232&#x27;</span><br><span class="line">...</span><br><span class="line">config host</span><br><span class="line">	option name &#x27;TL-SX3016F&#x27;</span><br><span class="line">	option ip &#x27;192.168.2.100&#x27;</span><br><span class="line">	option mac &#x27;3C:52:A1:47:23:5D&#x27;</span><br><span class="line"></span><br><span class="line">config host</span><br><span class="line">	option name &#x27;MikroTik&#x27;</span><br><span class="line">	option ip &#x27;192.168.2.110&#x27;</span><br><span class="line">	option mac &#x27;78:9A:18:D0:20:ED&#x27;</span><br><span class="line"></span><br><span class="line">config domain</span><br><span class="line">	option name &#x27;TL-SX3016F&#x27;</span><br><span class="line">	option ip &#x27;192.168.2.100&#x27;</span><br><span class="line"></span><br><span class="line">config domain</span><br><span class="line">	option name &#x27;MikroTik&#x27;</span><br><span class="line">	option ip &#x27;192.168.2.110&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/blog/img/OpenWRT%20-%20DHCP%20and%20DNS.png" alt="OpenWRT - DHCP and DNS" title="OpenWRT - DHCP and DNS"></p>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Running-OpenWRT-on-Proxmox" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/12/03/Running-OpenWRT-on-Proxmox/">Running OpenWRT on Proxmox</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-12-03T01:46:37.000Z" itemprop="datePublished">2024-12-03</time>
</span>
      
      
      
<a href="/blog/2024/12/03/Running-OpenWRT-on-Proxmox/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li>Create <code>OpenWRT</code> VM in <code>Proxmox</code></li>
</ul>
<p><img src="/blog/img/OpenWRT%20-%20VM%20General.png" alt="OpenWRT - VM General" title="OpenWRT - VM General"></p>
<p><img src="/blog/img/OpenWRT%20-%20VM%20OS.png" alt="OpenWRT - VM OS" title="OpenWRT - VM OS"></p>
<p><img src="/blog/img/OpenWRT%20-%20VM%20System.png" alt="OpenWRT - VM System" title="OpenWRT - VM System"></p>
<p><img src="/blog/img/OpenWRT%20-%20VM%20Disks.png" alt="OpenWRT - VM Disks" title="OpenWRT - VM Disks"></p>
<p><img src="/blog/img/OpenWRT%20-%20VM%20CPU.png" alt="OpenWRT - VM CPU" title="OpenWRT - VM CPU"></p>
<p><img src="/blog/img/OpenWRT%20-%20VM%20Memory.png" alt="OpenWRT - VM Memory" title="OpenWRT - VM Memory"></p>
<p><img src="/blog/img/OpenWRT%20-%20VM%20Network.png" alt="OpenWRT - VM Network" title="OpenWRT - VM Network"></p>
<p>This is the <strong>LAN</strong>, and Firewall is <strong>DISABLED</strong>.</p>
<p><img src="/blog/img/OpenWRT%20-%20VM%20Confirm.png" alt="OpenWRT - VM Confirm" title="OpenWRT - VM Confirm"></p>
<p>Add <strong>WAN</strong> into VM, and Firewall is <strong>DISABLED</strong>.</p>
<p>Detach and delete current <strong>Hard Disk</strong>.</p>
<p>From <code>Proxmox</code> Console, download the latest OpenWRT image:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@sense:~# wget https://downloads.openwrt.org/releases/23.05.5/targets/x86/64/openwrt-23.05.5-x86-64-generic-ext4-combined.img.gz</span><br><span class="line">--2024-12-03 12:20:33--  https://downloads.openwrt.org/releases/23.05.5/targets/x86/64/openwrt-23.05.5-x86-64-generic-ext4-combined.img.gz</span><br><span class="line">Resolving downloads.openwrt.org (downloads.openwrt.org)... 2a04:4e42:13::644, 151.101.82.132</span><br><span class="line">Connecting to downloads.openwrt.org (downloads.openwrt.org)|2a04:4e42:13::644|:443... failed: No route to host.</span><br><span class="line">Connecting to downloads.openwrt.org (downloads.openwrt.org)|151.101.82.132|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 11352149 (11M) [application/octet-stream]</span><br><span class="line">Saving to: ‘openwrt-23.05.5-x86-64-generic-ext4-combined.img.gz’</span><br><span class="line"></span><br><span class="line">openwrt-23.05.5-x86-64-generic-ext4-combined.img.gz  100%[===================================================&gt;]  10.83M  --.-KB/s  in 0.1s    </span><br></pre></td></tr></table></figure>

<p>Create disk image for VM:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@sense:~# gunzip openwrt-23.05.5-x86-64-generic-ext4-combined.img.gz</span><br><span class="line"></span><br><span class="line">root@sense:~# mv openwrt-23.05.5-x86-64-generic-ext4-combined.img openwrt.raw</span><br><span class="line"></span><br><span class="line"># increase the raw disk</span><br><span class="line">root@sense:~# qemu-img resize -f raw ./openwrt.raw 1024M</span><br><span class="line">Image resized.</span><br></pre></td></tr></table></figure>

<p>Convert <code>OpenWRT</code> image to VM disk:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># import the raw disk to OpenWRT VM</span><br><span class="line">root@sense:~# qm importdisk 104 openwrt.raw local-lvm</span><br><span class="line">Use of uninitialized value $dev in hash element at /usr/share/perl5/PVE/QemuServer/Drive.pm line 555.</span><br><span class="line">importing disk &#x27;openwrt.raw&#x27; to VM 104 ...</span><br><span class="line">  Logical volume &quot;vm-104-disk-0&quot; created.</span><br><span class="line">transferred 0.0 B of 1.0 GiB (0.00%)</span><br><span class="line">...</span><br><span class="line">transferred 1.0 GiB of 1.0 GiB (100.00%)</span><br><span class="line">unused0: successfully imported disk &#x27;local-lvm:vm-104-disk-0&#x27;</span><br></pre></td></tr></table></figure>

<p>Double click the <strong>Unused Disk</strong>, then click the Add button:</p>
<p><img src="/blog/img/OpenWRT%20-%20VM%20Unused%20Disk.png" alt="OpenWRT - VM Unused Disk" title="OpenWRT - VM Unused Disk"></p>
<p><img src="/blog/img/OpenWRT%20-%20VM%20Hardware.png" alt="OpenWRT - VM Hardware" title="OpenWRT - VM Hardware"></p>
<p><img src="/blog/img/OpenWRT%20-%20VM%20Boot%20Order.png" alt="OpenWRT - VM Boot Order" title="OpenWRT - VM Boot Order"></p>
<ul>
<li>Configure <code>OpenWRT</code></li>
</ul>
<p>Start up VM; change the user <strong>root</strong> password; set LAN ip address temporarily to <strong>192.168.2.3</strong> (Default: <strong>192.168.1.1</strong>):</p>
<p><img src="/blog/img/OpenWRT%20-%20Console.png" alt="OpenWRT - Console" title="OpenWRT - Console"></p>
<p>Login <code>OpenWRT</code> at <em><a target="_blank" rel="noopener" href="http://192.168.2.3/">http://192.168.2.3/</a></em>, via LAN port, and land on dashboard:</p>
<p><img src="/blog/img/OpenWRT%20-%20Login.png" alt="OpenWRT - Login" title="OpenWRT - Login"></p>
<p><img src="/blog/img/OpenWRT%20-%20Dashboard.png" alt="OpenWRT - Dashboard" title="OpenWRT - Dashboard"></p>
<ul>
<li>Themes</li>
</ul>
<p><strong>SSH</strong> login:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -l root 192.168.2.3</span><br><span class="line">The authenticity of host &#x27;192.168.2.3 (192.168.2.3)&#x27; can&#x27;t be established.</span><br><span class="line">ED25519 key fingerprint is SHA256:AggWAL1oU8+r1f84KoqpvcsYUylZOTfN0sXwHSby3b0.</span><br><span class="line">This key is not known by any other names.</span><br><span class="line">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="line">Warning: Permanently added &#x27;192.168.2.3&#x27; (ED25519) to the list of known hosts.</span><br><span class="line">root@192.168.2.3&#x27;s password: </span><br><span class="line">  _______                     ________        __</span><br><span class="line"> |       |.-----.-----.-----.|  |  |  |.----.|  |_</span><br><span class="line"> |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|</span><br><span class="line"> |_______||   __|_____|__|__||________||__|  |____|</span><br><span class="line">          |__| W I R E L E S S   F R E E D O M</span><br><span class="line"> -----------------------------------------------------</span><br><span class="line"> OpenWrt 23.05.5, r24106-10cc5fcd00</span><br><span class="line"> -----------------------------------------------------</span><br><span class="line"></span><br><span class="line">BusyBox v1.36.1 (2024-09-23 12:34:46 UTC) built-in shell (ash)</span><br></pre></td></tr></table></figure>

<p><code>OpenWRT</code> packages configuration:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">root@OpenWrt:~# ls -al /etc/opkg</span><br><span class="line">drwxr-xr-x    3 root     root          4096 Dec  6 02:46 .</span><br><span class="line">drwxr-xr-x   23 root     root          4096 Dec  6 02:41 ..</span><br><span class="line">-rw-r--r--    1 root     root           103 Sep 23 12:34 customfeeds.conf</span><br><span class="line">-rw-r--r--    1 root     root           555 Dec  6 02:46 distfeeds.conf</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Sep 23 12:34 keys</span><br><span class="line"></span><br><span class="line">root@OpenWrt:~# ls -al /var/opkg-lists/</span><br><span class="line">drwxr-xr-x    2 root     root           320 Dec  6 03:15 .</span><br><span class="line">drwxrwxrwt   17 root     root           440 Dec  6 03:15 ..</span><br><span class="line">-rw-r--r--    1 root     root         72705 Dec  6 03:15 openwrt_base</span><br><span class="line">-rw-r--r--    1 root     root           142 Dec  6 03:15 openwrt_base.sig</span><br><span class="line">-rw-r--r--    1 root     root         10039 Dec  6 03:15 openwrt_core</span><br><span class="line">-rw-r--r--    1 root     root           142 Dec  6 03:15 openwrt_core.sig</span><br><span class="line">-rw-r--r--    1 root     root        100416 Dec  6 03:15 openwrt_kmods</span><br><span class="line">-rw-r--r--    1 root     root           142 Dec  6 03:15 openwrt_kmods.sig</span><br><span class="line">-rw-r--r--    1 root     root        197242 Dec  6 03:15 openwrt_luci</span><br><span class="line">-rw-r--r--    1 root     root           142 Dec  6 03:15 openwrt_luci.sig</span><br><span class="line">-rw-r--r--    1 root     root        516243 Dec  6 03:15 openwrt_packages</span><br><span class="line">-rw-r--r--    1 root     root           142 Dec  6 03:15 openwrt_packages.sig</span><br><span class="line">-rw-r--r--    1 root     root          9918 Dec  6 03:15 openwrt_routing</span><br><span class="line">-rw-r--r--    1 root     root           142 Dec  6 03:15 openwrt_routing.sig</span><br><span class="line">-rw-r--r--    1 root     root         58240 Dec  6 03:15 openwrt_telephony</span><br><span class="line">-rw-r--r--    1 root     root           142 Dec  6 03:15 openwrt_telephony.sig</span><br></pre></td></tr></table></figure>

<p>There is some issue with <strong>IPv6</strong> support in <code>OpenWRT</code> when download update. Errors thrown when <strong>wan</strong> connected to a <strong>IPv6</strong> router: </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@OpenWrt:~# opkg update</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/23.05.5/targets/x86/64/packages/Packages.gz</span><br><span class="line">*** Failed to download the package list from https://downloads.openwrt.org/releases/23.05.5/targets/x86/64/packages/Packages.gz</span><br><span class="line">...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/23.05.5/packages/x86_64/telephony/Packages.gz</span><br><span class="line">*** Failed to download the package list from https://downloads.openwrt.org/releases/23.05.5/packages/x86_64/telephony/Packages.gz</span><br><span class="line"></span><br><span class="line">Collected errors:</span><br><span class="line"> * opkg_download: Failed to download https://downloads.openwrt.org/releases/23.05.5/targets/x86/64/packages/Packages.gz, wget returned 4.</span><br><span class="line"> * opkg_download: Check your network settings and connectivity.</span><br><span class="line">...</span><br><span class="line"> * opkg_download: Failed to download https://downloads.openwrt.org/releases/23.05.5/packages/x86_64/telephony/Packages.gz, wget returned 4.</span><br><span class="line"> * opkg_download: Check your network settings and connectivity.</span><br></pre></td></tr></table></figure>

<p>Turn off <strong>IPv6</strong> on router to workaround.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@OpenWRT:~# opkg update</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/23.05.5/targets/x86/64/packages/Packages.gz</span><br><span class="line">Updated list of available packages in /var/opkg-lists/openwrt_core</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/23.05.5/targets/x86/64/packages/Packages.sig</span><br><span class="line">Signature check passed.</span><br><span class="line">...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/23.05.5/packages/x86_64/telephony/Packages.gz</span><br><span class="line">Updated list of available packages in /var/opkg-lists/openwrt_telephony</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/23.05.5/packages/x86_64/telephony/Packages.sig</span><br><span class="line">Signature check passed.</span><br></pre></td></tr></table></figure>

<p>Install <code>OpenWRT2020</code> Theme <em><a target="_blank" rel="noopener" href="https://openwrt.org/docs/guide-user/luci/luci.themes">https://openwrt.org/docs/guide-user/luci/luci.themes</a></em>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@OpenWRT:~# opkg install luci-theme-openwrt-2020</span><br><span class="line">Installing luci-theme-openwrt-2020 (git-24.332.79522-a493155) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/23.05.5/packages/x86_64/luci/luci-theme-openwrt-2020_git-24.332.79522-a493155_all.ipk</span><br><span class="line">Configuring luci-theme-openwrt-2020.</span><br></pre></td></tr></table></figure>

<p>Install Argon Theme <em><a target="_blank" rel="noopener" href="https://github.com/jerrykuku/luci-theme-argon">https://github.com/jerrykuku/luci-theme-argon</a></em>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">root@OpenWRT:~# opkg install luci-compat</span><br><span class="line">Installing luci-compat (git-24.332.79522-a493155) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/23.05.5/packages/x86_64/luci/luci-compat_git-24.332.79522-a493155_all.ipk</span><br><span class="line">Installing liblua5.1.5 (5.1.5-11) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/23.05.5/packages/x86_64/base/liblua5.1.5_5.1.5-11_x86_64.ipk</span><br><span class="line">Installing lua (5.1.5-11) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/23.05.5/packages/x86_64/base/lua_5.1.5-11_x86_64.ipk</span><br><span class="line">Installing luci-lib-nixio (git-24.332.79522-a493155) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/23.05.5/packages/x86_64/luci/luci-lib-nixio_git-24.332.79522-a493155_x86_64.ipk</span><br><span class="line">Installing luci-lib-ip (git-24.332.79522-a493155) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/23.05.5/packages/x86_64/luci/luci-lib-ip_git-24.332.79522-a493155_x86_64.ipk</span><br><span class="line">Installing luci-lib-jsonc (git-24.332.79522-a493155) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/23.05.5/packages/x86_64/luci/luci-lib-jsonc_git-24.332.79522-a493155_x86_64.ipk</span><br><span class="line">Installing liblucihttp-lua (2023-03-15-9b5b683f-1) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/23.05.5/packages/x86_64/luci/liblucihttp-lua_2023-03-15-9b5b683f-1_x86_64.ipk</span><br><span class="line">Installing luci-lib-base (git-24.332.79522-a493155) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/23.05.5/packages/x86_64/luci/luci-lib-base_git-24.332.79522-a493155_all.ipk</span><br><span class="line">Installing libubus-lua (2023-06-05-f787c97b-1) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/23.05.5/packages/x86_64/base/libubus-lua_2023-06-05-f787c97b-1_x86_64.ipk</span><br><span class="line">Installing ucode-mod-lua (1) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/23.05.5/packages/x86_64/luci/ucode-mod-lua_1_x86_64.ipk</span><br><span class="line">Installing luci-lua-runtime (git-24.332.79522-a493155) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/23.05.5/packages/x86_64/luci/luci-lua-runtime_git-24.332.79522-a493155_x86_64.ipk</span><br><span class="line">Configuring liblua5.1.5.</span><br><span class="line">Configuring lua.</span><br><span class="line">Configuring luci-lib-nixio.</span><br><span class="line">Configuring luci-lib-ip.</span><br><span class="line">Configuring luci-lib-jsonc.</span><br><span class="line">Configuring liblucihttp-lua.</span><br><span class="line">Configuring luci-lib-base.</span><br><span class="line">Configuring libubus-lua.</span><br><span class="line">Configuring ucode-mod-lua.</span><br><span class="line">Configuring luci-lua-runtime.</span><br><span class="line">Configuring luci-compat.</span><br><span class="line"></span><br><span class="line">root@OpenWRT:~# opkg install luci-lib-ipkg</span><br><span class="line">Installing luci-lib-ipkg (git-24.332.79522-a493155) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/23.05.5/packages/x86_64/luci/luci-lib-ipkg_git-24.332.79522-a493155_all.ipk</span><br><span class="line">Configuring luci-lib-ipkg.</span><br><span class="line"></span><br><span class="line">root@OpenWRT:~# wget --no-check-certificate -O luci-theme-argon.ipk https://github.com/jerrykuku/luci-theme-argon/releases/download/v2.3.1/luci-theme-argon_2.3.1_all.ipk</span><br><span class="line">root@OpenWRT:~# wget --no-check-certificate -O luci-app-argon-config.ipk https://github.com/jerrykuku/luci-app-argon-config/releases/download/v0.9/luci-app-argon-config_0.9_all.ipk</span><br></pre></td></tr></table></figure>

<p>There are ERRORS:</p>
<ul>
<li><em>&#x2F;&#x2F;usr&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;luci-theme-argon.postinst: .: line 2: can’t open ‘&#x2F;etc&#x2F;uci-defaults&#x2F;30_luci-theme-argon’: No such file or directory</em></li>
<li><em>&#x2F;&#x2F;usr&#x2F;lib&#x2F;opkg&#x2F;info&#x2F;luci-app-argon-config.postinst: .: line 2: can’t open ‘&#x2F;etc&#x2F;uci-defaults&#x2F;luci-argon-config’: No such file or directory</em></li>
</ul>
<p>thrown when try to install these packages.</p>
<p>A workaround solution is modify <strong>&#x2F;lib&#x2F;functions.sh</strong> file, replace line: 282:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">( [ -f &quot;$i&quot; ] &amp;&amp; cd &quot;$(dirname $i)&quot; &amp;&amp; . &quot;$i&quot; ) &amp;&amp; rm -f &quot;$i&quot;</span><br></pre></td></tr></table></figure>

<p>with: </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">( [ -f &quot;$i&quot; ] &amp;&amp; cd &quot;$(dirname $i)&quot; &amp;&amp; . &quot;$i&quot; ) &amp;&amp; echo</span><br></pre></td></tr></table></figure>

<p>temporarily. Then run installation:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@OpenWRT:~# opkg install luci-theme-argon.ipk </span><br><span class="line">Installing luci-theme-argon (2.3.1) to root...</span><br><span class="line">Configuring luci-theme-argon.</span><br><span class="line"></span><br><span class="line">root@OpenWRT:~# opkg install luci-app-argon-config.ipk </span><br><span class="line">Installing luci-app-argon-config (0.9) to root...</span><br><span class="line">Configuring luci-app-argon-config.</span><br></pre></td></tr></table></figure>

<ul>
<li>Upgrade</li>
</ul>
<p>To upgrade all of the <code>OpenWRT</code> packages:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@OpenWRT:~# opkg list-upgradable | cut -f 1 -d &#x27; &#x27; | xargs -r opkg upgrade  </span><br></pre></td></tr></table></figure>


<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>Run an OpenWRT VM on Proxmox VE, <em><a target="_blank" rel="noopener" href="https://i12bretro.github.io/tutorials/0405.html">https://i12bretro.github.io/tutorials/0405.html</a></em></li>
<li>My Mobile HomeLab! (Travel Router with Proxmox, Docker, and OpenWRT), <em><a target="_blank" rel="noopener" href="https://technotim.live/posts/mobile-homelab/">https://technotim.live/posts/mobile-homelab/</a></em></li>
</ul>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Fixing-Multimedia-Audio-Controller-driver-missing-issue-in-Windows-11" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/11/25/Fixing-Multimedia-Audio-Controller-driver-missing-issue-in-Windows-11/">Fixing Multimedia Audio Controller driver missing issue in Windows 11</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-11-25T06:21:43.000Z" itemprop="datePublished">2024-11-25</time>
</span>
      
      
      
<a href="/blog/2024/11/25/Fixing-Multimedia-Audio-Controller-driver-missing-issue-in-Windows-11/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Error thrown while missing <strong>Multimedia Audio Driver</strong> driver in Device Manager in Windows 11:</p>
<p><img src="/blog/img/Windows%20-%20Multimedia%20Audio%20Controller.png" alt="Windows - Multimedia Audio Controller" title="Windows - Multimedia Audio Controller"></p>
<p>when runs on an Intel i3 N305 Mini PC <em><a target="_blank" rel="noopener" href="https://www.aliexpress.com/item/1005007278560105.html">https://www.aliexpress.com/item/1005007278560105.html</a></em> </p>
<p><img src="/blog/img/Intel%20Network%20-%20Mini%20PC.png" alt="Intel Network - Mini PC" title="Intel Network - Mini PC"></p>
<p>Need this handy tool to find all the missing parts:</p>
<p><img src="/blog/img/Windows%20-%20Driver%20Identifier.png" alt="Windows - Driver Identifier" title="Windows - Driver Identifier"></p>
<p><code>Driver Identifier</code>, a digital assistant for your system’s hardware, can scan the device, identifies outdated or missing drivers, and provides a customized list of updates for your specific hardware:</p>
<p><img src="/blog/img/Windows%20-%20Drivers.png" alt="Windows - Drivers" title="Windows - Drivers"></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>DriverIdentifier is a powerful tool that takes the hassle out of managing and updating drivers on your computer, <em><a target="_blank" rel="noopener" href="https://www.driveridentifier.com/">https://www.driveridentifier.com/</a></em></li>
</ul>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Setting-up-DNS-Server-in-OPNsense" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/11/21/Setting-up-DNS-Server-in-OPNsense/">Setting up DNS Server in OPNsense</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-11-20T23:21:28.000Z" itemprop="datePublished">2024-11-21</time>
</span>
      
      
      
<a href="/blog/2024/11/21/Setting-up-DNS-Server-in-OPNsense/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Want to access Homelab network switches’ web based administrator interface in a user friendly way, i.e., access via <a target="_blank" rel="noopener" href="http://tl-sx3016f.local/">http://TL-SX3016F.local/</a>, <a target="_blank" rel="noopener" href="http://tl-sx3008f.local/">http://TL-SX3008F.local/</a> and <a target="_blank" rel="noopener" href="http://mikrotik.local/">http://MikroTik.local/</a>.</p>
<p>In TP-Link Deco, which is the main Homelab network backbone, also provides DHCP service, firstly is to reserve IP addresses for these switches:</p>
<p><img src="/blog/img/DNS%20-%20TP-Link%20Deco%20Reservation.jpg" alt="DNS - TP-Link Deco Reservation" title="DNS - TP-Link Deco Reservation"></p>
<p>Then setup entries in <code>OPNsense Unbound DNS</code> server:</p>
<p><img src="/blog/img/DNS%20-%20Host%20Overrides.png" alt="DNS - Host Overrides" title="DNS - Host Overrides"></p>
<p>Then lookup a host on local network:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/resolv.conf</span><br><span class="line">#</span><br><span class="line"># macOS Notice</span><br><span class="line">#</span><br><span class="line"># This file is not consulted for DNS hostname resolution, address</span><br><span class="line"># resolution, or the DNS query routing mechanism used by most</span><br><span class="line"># processes on this system.</span><br><span class="line">#</span><br><span class="line"># To view the DNS configuration used by this system, use:</span><br><span class="line">#   scutil --dns</span><br><span class="line">#</span><br><span class="line"># SEE ALSO</span><br><span class="line">#   dns-sd(1), scutil(8)</span><br><span class="line">#</span><br><span class="line"># This file is automatically generated.</span><br><span class="line">#</span><br><span class="line">search local</span><br><span class="line">nameserver 2403:5802:8c44:3:be24:11ff:fe21:3ce0</span><br><span class="line">nameserver 192.168.68.1</span><br><span class="line"></span><br><span class="line">$ nslookup MikroTik.local</span><br><span class="line">Server:		2403:5802:8c44:3:be24:11ff:fe21:3ce0</span><br><span class="line">Address:	2403:5802:8c44:3:be24:11ff:fe21:3ce0#53</span><br><span class="line"></span><br><span class="line">Name:	MikroTik.local</span><br><span class="line">Address: 192.168.68.54</span><br></pre></td></tr></table></figure>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Enable-SR-IOV-in-Intel-82599ES-10Gbps-Ethernet-Controller" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/11/08/Enable-SR-IOV-in-Intel-82599ES-10Gbps-Ethernet-Controller/">Enable SR-IOV in Intel 82599ES 10Gbps Ethernet Controller</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-11-08T10:06:48.000Z" itemprop="datePublished">2024-11-08</time>
</span>
      
      
      
<a href="/blog/2024/11/08/Enable-SR-IOV-in-Intel-82599ES-10Gbps-Ethernet-Controller/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><strong>Intel® 82599ES 10Gbps Ethernet Controller</strong> <em><a target="_blank" rel="noopener" href="https://ark.intel.com/content/www/us/en/ark/products/41282/intel-82599es-10-gigabit-ethernet-controller.html">https://ark.intel.com/content/www/us/en/ark/products/41282/intel-82599es-10-gigabit-ethernet-controller.html</a></em> supports <strong>SR-IOV</strong>, which is Intel® Virtualization Technology for Connectivity (VT-c) solution.</p>
<blockquote>
<p><strong>NOTE:</strong> Intel VT Virtualization Features</p>
</blockquote>
<ul>
<li><strong>VT-x</strong>, Intel Virtualization Technology for IA-32 and Intel 64 Processors</li>
<li><strong>VT-d</strong>, Intel Virtualization Technology for Directed I&#x2F;O</li>
<li><strong>VT-c</strong>, Intel Virtualization Technology for Connectivity</li>
</ul>
<p>The following step by step instructions is made in <code>Proxmox</code>.</p>
<p>Intel i3 N305 Mini PC <em><a target="_blank" rel="noopener" href="https://www.aliexpress.com/item/1005007278560105.html">https://www.aliexpress.com/item/1005007278560105.html</a></em> </p>
<p><img src="/blog/img/Intel%20Network%20-%20Mini%20PC.png" alt="Intel Network - Mini PC" title="Intel Network - Mini PC"></p>
<p>equips with two 10G SFP+ (Intel 82599ES) and two 2.5G (Intel i226-V) network cards:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">root@sense:~# lspci -v </span><br><span class="line">...</span><br><span class="line">01:00.0 Ethernet controller: Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection (rev 01)</span><br><span class="line">        Flags: bus master, fast devsel, latency 0, IRQ 16, IOMMU group 12</span><br><span class="line">        Memory at 80a20000 (64-bit, non-prefetchable) [size=128K]</span><br><span class="line">        I/O ports at 3020 [disabled] [size=32]</span><br><span class="line">        Memory at 80a44000 (64-bit, non-prefetchable) [size=16K]</span><br><span class="line">        Capabilities: [40] Power Management version 3</span><br><span class="line">        Capabilities: [50] MSI: Enable- Count=1/1 Maskable+ 64bit+</span><br><span class="line">        Capabilities: [70] MSI-X: Enable+ Count=64 Masked-</span><br><span class="line">        Capabilities: [a0] Express Endpoint, MSI 00</span><br><span class="line">        Capabilities: [e0] Vital Product Data</span><br><span class="line">        Capabilities: [100] Advanced Error Reporting</span><br><span class="line">        Capabilities: [140] Device Serial Number a8-b8-e0-ff-ff-05-96-4d</span><br><span class="line">        Capabilities: [150] Alternative Routing-ID Interpretation (ARI)</span><br><span class="line">        Capabilities: [160] Single Root I/O Virtualization (SR-IOV)</span><br><span class="line">        Kernel driver in use: ixgbe</span><br><span class="line">        Kernel modules: ixgbe</span><br><span class="line"></span><br><span class="line">01:00.1 Ethernet controller: Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection (rev 01)</span><br><span class="line">        Flags: bus master, fast devsel, latency 0, IRQ 17, IOMMU group 13</span><br><span class="line">        Memory at 80a00000 (64-bit, non-prefetchable) [size=128K]</span><br><span class="line">        I/O ports at 3000 [disabled] [size=32]</span><br><span class="line">        Memory at 80a40000 (64-bit, non-prefetchable) [size=16K]</span><br><span class="line">        Capabilities: [40] Power Management version 3</span><br><span class="line">        Capabilities: [50] MSI: Enable- Count=1/1 Maskable+ 64bit+</span><br><span class="line">        Capabilities: [70] MSI-X: Enable+ Count=64 Masked-</span><br><span class="line">        Capabilities: [a0] Express Endpoint, MSI 00</span><br><span class="line">        Capabilities: [e0] Vital Product Data</span><br><span class="line">        Capabilities: [100] Advanced Error Reporting</span><br><span class="line">        Capabilities: [140] Device Serial Number a8-b8-e0-ff-ff-05-96-4d</span><br><span class="line">        Capabilities: [150] Alternative Routing-ID Interpretation (ARI)</span><br><span class="line">        Capabilities: [160] Single Root I/O Virtualization (SR-IOV)</span><br><span class="line">        Kernel driver in use: ixgbe</span><br><span class="line">        Kernel modules: ixgbe</span><br><span class="line"></span><br><span class="line">01:10.0 Ethernet controller: Intel Corporation 82599 Ethernet Controller Virtual Function (rev 01)</span><br><span class="line">        Flags: bus master, fast devsel, latency 0, IOMMU group 18</span><br><span class="line">        Memory at 4017000000 (64-bit, prefetchable) [virtual] [size=16K]</span><br><span class="line">        Memory at 4017100000 (64-bit, prefetchable) [virtual] [size=16K]</span><br><span class="line">        Capabilities: [70] MSI-X: Enable+ Count=3 Masked-</span><br><span class="line">        Capabilities: [a0] Express Endpoint, MSI 00</span><br><span class="line">        Capabilities: [100] Advanced Error Reporting</span><br><span class="line">        Capabilities: [150] Alternative Routing-ID Interpretation (ARI)</span><br><span class="line">        Kernel driver in use: vfio-pci</span><br><span class="line">        Kernel modules: ixgbevf</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">02:00.0 Ethernet controller: Intel Corporation Ethernet Controller I226-V (rev 04)</span><br><span class="line">        Subsystem: Intel Corporation Ethernet Controller I226-V</span><br><span class="line">        Flags: bus master, fast devsel, latency 0, IRQ 18, IOMMU group 14</span><br><span class="line">        Memory at 80600000 (32-bit, non-prefetchable) [size=1M]</span><br><span class="line">        Memory at 80700000 (32-bit, non-prefetchable) [size=16K]</span><br><span class="line">        Capabilities: [40] Power Management version 3</span><br><span class="line">        Capabilities: [50] MSI: Enable- Count=1/1 Maskable+ 64bit+</span><br><span class="line">        Capabilities: [70] MSI-X: Enable+ Count=5 Masked-</span><br><span class="line">        Capabilities: [a0] Express Endpoint, MSI 00</span><br><span class="line">        Capabilities: [100] Advanced Error Reporting</span><br><span class="line">        Capabilities: [140] Device Serial Number a8-b8-e0-ff-ff-05-96-4f</span><br><span class="line">        Capabilities: [1c0] Latency Tolerance Reporting</span><br><span class="line">        Capabilities: [1f0] Precision Time Measurement</span><br><span class="line">        Capabilities: [1e0] L1 PM Substates</span><br><span class="line">        Kernel driver in use: igc</span><br><span class="line">        Kernel modules: igc</span><br><span class="line"></span><br><span class="line">03:00.0 Ethernet controller: Intel Corporation Ethernet Controller I226-V (rev 04)</span><br><span class="line">        Subsystem: Intel Corporation Ethernet Controller I226-V</span><br><span class="line">        Flags: bus master, fast devsel, latency 0, IRQ 16, IOMMU group 15</span><br><span class="line">        Memory at 80400000 (32-bit, non-prefetchable) [size=1M]</span><br><span class="line">        Memory at 80500000 (32-bit, non-prefetchable) [size=16K]</span><br><span class="line">        Capabilities: [40] Power Management version 3</span><br><span class="line">        Capabilities: [50] MSI: Enable- Count=1/1 Maskable+ 64bit+</span><br><span class="line">        Capabilities: [70] MSI-X: Enable+ Count=5 Masked-</span><br><span class="line">        Capabilities: [a0] Express Endpoint, MSI 00</span><br><span class="line">        Capabilities: [100] Advanced Error Reporting</span><br><span class="line">        Capabilities: [140] Device Serial Number a8-b8-e0-ff-ff-05-96-50</span><br><span class="line">        Capabilities: [1c0] Latency Tolerance Reporting</span><br><span class="line">        Capabilities: [1f0] Precision Time Measurement</span><br><span class="line">        Capabilities: [1e0] L1 PM Substates</span><br><span class="line">        Kernel driver in use: igc</span><br><span class="line">        Kernel modules: igc</span><br><span class="line"></span><br><span class="line">04:00.0 Network controller: Intel Corporation Wi-Fi 7(802.11be) AX1775*/AX1790*/BE20*/BE401/BE1750* 2x2 (rev 1a)</span><br><span class="line">        Subsystem: Intel Corporation Wi-Fi 7(802.11be) AX1775*/AX1790*/BE20*/BE401/BE1750* 2x2 (BE200 320MHz [Gale Peak])</span><br><span class="line">        Flags: bus master, fast devsel, latency 0, IRQ 17, IOMMU group 16</span><br><span class="line">        Memory at 80900000 (64-bit, non-prefetchable) [size=16K]</span><br><span class="line">        Capabilities: [40] Power Management version 3</span><br><span class="line">        Capabilities: [50] MSI: Enable- Count=1/1 Maskable- 64bit+</span><br><span class="line">        Capabilities: [70] Express Endpoint, MSI 00</span><br><span class="line">        Capabilities: [b0] MSI-X: Enable+ Count=32 Masked-</span><br><span class="line">        Capabilities: [100] Advanced Error Reporting</span><br><span class="line">        Capabilities: [148] Secondary PCI Express</span><br><span class="line">        Capabilities: [158] Physical Layer 16.0 GT/s &lt;?&gt;</span><br><span class="line">        Capabilities: [17c] Lane Margining at the Receiver &lt;?&gt;</span><br><span class="line">        Capabilities: [188] Latency Tolerance Reporting</span><br><span class="line">        Capabilities: [190] L1 PM Substates</span><br><span class="line">        Capabilities: [1a0] Vendor Specific Information: ID=0002 Rev=4 Len=100 &lt;?&gt;</span><br><span class="line">        Capabilities: [2a0] Data Link Feature &lt;?&gt;</span><br><span class="line">        Capabilities: [2ac] Precision Time Measurement</span><br><span class="line">        Capabilities: [2b8] Vendor Specific Information: ID=0003 Rev=1 Len=054 &lt;?&gt;</span><br><span class="line">        Capabilities: [500] Vendor Specific Information: ID=0023 Rev=1 Len=010 &lt;?&gt;</span><br><span class="line">        Kernel driver in use: iwlwifi</span><br><span class="line">        Kernel modules: iwlwifi</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">root@sense:~# ip a</span><br><span class="line">...</span><br><span class="line">2: enp2s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq master vmbr2 state UP group default qlen 1000</span><br><span class="line">    link/ether a8:b8:e0:05:96:4f brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: enp3s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq master vmbr3 state UP group default qlen 1000</span><br><span class="line">    link/ether a8:b8:e0:05:96:50 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">4: enp1s0f0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq master vmbr0 state UP group default qlen 1000</span><br><span class="line">    link/ether a8:b8:e0:05:96:4d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">5: enp1s0f1: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc mq master vmbr1 state DOWN group default qlen 1000</span><br><span class="line">    link/ether a8:b8:e0:05:96:4e brd ff:ff:ff:ff:ff:ff</span><br><span class="line">7: enp1s0f0v1: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span><br><span class="line">    link/ether 7a:de:19:c7:c2:ce brd ff:ff:ff:ff:ff:ff    </span><br><span class="line">...</span><br><span class="line">22: wlp4s0f0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span><br><span class="line">    link/ether e0:8f:4c:b2:58:95 brd ff:ff:ff:ff:ff:ff</span><br></pre></td></tr></table></figure>

<p>Verify Intel 82599ES network card status:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">root@sense:~# ethtool enp1s0f0</span><br><span class="line">Settings for enp1s0f0:</span><br><span class="line">        Supported ports: [ FIBRE ]</span><br><span class="line">        Supported link modes:   10000baseT/Full</span><br><span class="line">        Supported pause frame use: Symmetric</span><br><span class="line">        Supports auto-negotiation: No</span><br><span class="line">        Supported FEC modes: Not reported</span><br><span class="line">        Advertised link modes:  10000baseT/Full</span><br><span class="line">        Advertised pause frame use: Symmetric</span><br><span class="line">        Advertised auto-negotiation: No</span><br><span class="line">        Advertised FEC modes: Not reported</span><br><span class="line">        Speed: 10000Mb/s</span><br><span class="line">        Duplex: Full</span><br><span class="line">        Auto-negotiation: off</span><br><span class="line">        Port: FIBRE</span><br><span class="line">        PHYAD: 0</span><br><span class="line">        Transceiver: internal</span><br><span class="line">        Supports Wake-on: d</span><br><span class="line">        Wake-on: d</span><br><span class="line">        Current message level: 0x00000007 (7)</span><br><span class="line">                               drv probe link</span><br><span class="line">        Link detected: yes</span><br><span class="line"></span><br><span class="line">root@sense:~# ethtool -i enp1s0f0</span><br><span class="line">driver: ixgbe</span><br><span class="line">version: 6.8.12-2-pve</span><br><span class="line">firmware-version: 0x800003de</span><br><span class="line">expansion-rom-version: </span><br><span class="line">bus-info: 0000:01:00.0</span><br><span class="line">supports-statistics: yes</span><br><span class="line">supports-test: yes</span><br><span class="line">supports-eeprom-access: yes</span><br><span class="line">supports-register-dump: yes</span><br><span class="line">supports-priv-flags: yes</span><br></pre></td></tr></table></figure>

<p>Enable <strong>IOMMU</strong> in <code>Proxmox</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@sense:~# cat /etc/default/grub | grep GRUB_CMDLINE_LINUX_DEFAULT</span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on iommu=pt&quot;</span><br></pre></td></tr></table></figure>

<p>IOMMU PT mode improves the performance of other PCIe devices in the system when passthrough is being used.</p>
<p>Update GRUB:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@sense:~# update-grub</span><br><span class="line">Generating grub configuration file ...</span><br><span class="line">Found linux image: /boot/vmlinuz-6.8.12-2-pve</span><br><span class="line">Found initrd image: /boot/initrd.img-6.8.12-2-pve</span><br><span class="line">Found linux image: /boot/vmlinuz-6.8.4-2-pve</span><br><span class="line">Found initrd image: /boot/initrd.img-6.8.4-2-pve</span><br><span class="line">Found memtest86+ 64bit EFI image: /boot/memtest86+x64.efi</span><br><span class="line">Adding boot menu entry for UEFI Firmware Settings ...</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>Reboot <code>Proxmox</code> and verify <strong>IOMMU</strong> is enabled:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">root@sense:~# dmesg | grep -i IOMMU</span><br><span class="line">[    0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-6.8.12-2-pve root=/dev/mapper/pve-root ro quiet intel_iommu=on iommu=pt</span><br><span class="line">[    0.053988] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-6.8.12-2-pve root=/dev/mapper/pve-root ro quiet intel_iommu=on iommu=pt</span><br><span class="line">[    0.054043] DMAR: IOMMU enabled</span><br><span class="line">[    0.145258] DMAR-IR: IOAPIC id 2 under DRHD base  0xfed91000 IOMMU 1</span><br><span class="line">[    0.403235] pci 0000:00:02.0: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    0.440538] iommu: Default domain type: Translated</span><br><span class="line">[    0.440538] iommu: DMA domain TLB invalidation policy: lazy mode</span><br><span class="line">[    0.483908] DMAR: IOMMU feature fl1gp_support inconsistent</span><br><span class="line">[    0.483909] DMAR: IOMMU feature pgsel_inv inconsistent</span><br><span class="line">[    0.483910] DMAR: IOMMU feature nwfs inconsistent</span><br><span class="line">[    0.483911] DMAR: IOMMU feature dit inconsistent</span><br><span class="line">[    0.483912] DMAR: IOMMU feature sc_support inconsistent</span><br><span class="line">[    0.483912] DMAR: IOMMU feature dev_iotlb_support inconsistent</span><br><span class="line">[    0.493686] pci 0000:00:02.0: Adding to iommu group 0</span><br><span class="line">[    0.493726] pci 0000:00:00.0: Adding to iommu group 1</span><br><span class="line">[    0.493739] pci 0000:00:0d.0: Adding to iommu group 2</span><br><span class="line">[    0.493764] pci 0000:00:14.0: Adding to iommu group 3</span><br><span class="line">[    0.493774] pci 0000:00:14.2: Adding to iommu group 3</span><br><span class="line">[    0.493786] pci 0000:00:16.0: Adding to iommu group 4</span><br><span class="line">[    0.493793] pci 0000:00:17.0: Adding to iommu group 5</span><br><span class="line">[    0.493806] pci 0000:00:1c.0: Adding to iommu group 6</span><br><span class="line">[    0.493820] pci 0000:00:1c.6: Adding to iommu group 7</span><br><span class="line">[    0.493831] pci 0000:00:1d.0: Adding to iommu group 8</span><br><span class="line">[    0.493842] pci 0000:00:1d.1: Adding to iommu group 9</span><br><span class="line">[    0.493859] pci 0000:00:1d.3: Adding to iommu group 10</span><br><span class="line">[    0.493878] pci 0000:00:1f.0: Adding to iommu group 11</span><br><span class="line">[    0.493886] pci 0000:00:1f.3: Adding to iommu group 11</span><br><span class="line">[    0.493895] pci 0000:00:1f.4: Adding to iommu group 11</span><br><span class="line">[    0.493903] pci 0000:00:1f.5: Adding to iommu group 11</span><br><span class="line">[    0.493918] pci 0000:01:00.0: Adding to iommu group 12</span><br><span class="line">[    0.493934] pci 0000:01:00.1: Adding to iommu group 13</span><br><span class="line">[    0.493945] pci 0000:02:00.0: Adding to iommu group 14</span><br><span class="line">[    0.493956] pci 0000:03:00.0: Adding to iommu group 15</span><br><span class="line">[    0.493982] pci 0000:04:00.0: Adding to iommu group 16</span><br><span class="line">[    0.493993] pci 0000:05:00.0: Adding to iommu group 17</span><br><span class="line">[    3.684070] pci 0000:01:10.1: Adding to iommu group 18</span><br><span class="line">[    3.684303] pci 0000:01:10.3: Adding to iommu group 19</span><br><span class="line">[    3.684501] pci 0000:01:10.5: Adding to iommu group 20</span><br><span class="line">[    3.684685] pci 0000:01:10.7: Adding to iommu group 21</span><br><span class="line">[    3.684885] pci 0000:01:11.1: Adding to iommu group 22</span><br><span class="line">[    3.685096] pci 0000:01:11.3: Adding to iommu group 23</span><br><span class="line">[    3.685296] pci 0000:01:11.5: Adding to iommu group 24</span><br><span class="line">[    3.685473] pci 0000:01:11.7: Adding to iommu group 25</span><br><span class="line">[    3.755233] pci 0000:01:10.0: Adding to iommu group 26</span><br><span class="line">[    3.755462] pci 0000:01:10.2: Adding to iommu group 27</span><br><span class="line">[    3.755761] pci 0000:01:10.4: Adding to iommu group 28</span><br><span class="line">[    3.755939] pci 0000:01:10.6: Adding to iommu group 29</span><br><span class="line">[    3.756107] pci 0000:01:11.0: Adding to iommu group 30</span><br><span class="line">[    3.756276] pci 0000:01:11.2: Adding to iommu group 31</span><br><span class="line">[    3.756444] pci 0000:01:11.4: Adding to iommu group 32</span><br><span class="line">[    3.756628] pci 0000:01:11.6: Adding to iommu group 33</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>ATTENTION:</strong>  IOMMU Group not order by PCI BUS IDs</p>
</blockquote>
<p>This is an <strong><em>ISSUE</em></strong> CAN’T setup PCI Device Resource Mappings, because of errors, e.g., “Configuration for iommugroup not correct (‘21’ !&#x3D; ‘’27)” thrown, sometime, after <code>Proxmox</code> reboot! </p>
<p>Work around solution is go to <strong>Resource Mappings</strong> in <code>Proxmox</code>, edit, make no change and save:</p>
<p><img src="/blog/img/Intel%20Network%20-%20Resource%20Mappings.png" alt="Intel Network - Resource Mappings" title="Intel Network - Resource Mappings"></p>
<p>Filter out network card <strong>udev</strong> information, e.g., <strong>enp1s0f1</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">root@sense:~# udevadm info -e </span><br><span class="line">...</span><br><span class="line">P: /devices/pci0000:00/0000:00:1c.0/0000:01:00.1/net/enp1s0f1</span><br><span class="line">M: enp1s0f1</span><br><span class="line">R: 1</span><br><span class="line">U: net</span><br><span class="line">I: 5</span><br><span class="line">E: DEVPATH=/devices/pci0000:00/0000:00:1c.0/0000:01:00.1/net/enp1s0f1</span><br><span class="line">E: SUBSYSTEM=net</span><br><span class="line">E: INTERFACE=enp1s0f1</span><br><span class="line">E: IFINDEX=5</span><br><span class="line">E: USEC_INITIALIZED=2364228</span><br><span class="line">E: ID_NET_NAMING_SCHEME=v252</span><br><span class="line">E: ID_NET_NAME_MAC=enxa8b8e005964e</span><br><span class="line">E: ID_OUI_FROM_DATABASE=Changwang Technology inc.</span><br><span class="line">E: ID_NET_NAME_PATH=enp1s0f1</span><br><span class="line">E: ID_BUS=pci</span><br><span class="line">E: ID_VENDOR_ID=0x8086</span><br><span class="line">E: ID_MODEL_ID=0x10fb</span><br><span class="line">E: ID_PCI_CLASS_FROM_DATABASE=Network controller</span><br><span class="line">E: ID_PCI_SUBCLASS_FROM_DATABASE=Ethernet controller</span><br><span class="line">E: ID_VENDOR_FROM_DATABASE=Intel Corporation</span><br><span class="line">E: ID_MODEL_FROM_DATABASE=82599ES 10-Gigabit SFI/SFP+ Network Connection</span><br><span class="line">E: ID_PATH=pci-0000:01:00.1</span><br><span class="line">E: ID_PATH_TAG=pci-0000_01_00_1</span><br><span class="line">E: ID_NET_DRIVER=ixgbe</span><br><span class="line">E: ID_NET_LINK_FILE=/usr/lib/systemd/network/99-default.link</span><br><span class="line">E: ID_NET_NAME=enp1s0f1</span><br><span class="line">E: SYSTEMD_ALIAS=/sys/subsystem/net/devices/enp1s0f1</span><br><span class="line">E: TAGS=:systemd:</span><br><span class="line">E: CURRENT_TAGS=:systemd:</span><br><span class="line"></span><br><span class="line">P: /devices/pci0000:00/0000:00:1c.0/0000:01:00.1/net/enp1s0f1/ixgbe-mdio-0000:01:00.1</span><br><span class="line">M: ixgbe-mdio-0000:01:00.1</span><br><span class="line">R: 1</span><br><span class="line">U: mdio_bus</span><br><span class="line">E: DEVPATH=/devices/pci0000:00/0000:00:1c.0/0000:01:00.1/net/enp1s0f1/ixgbe-mdio-0000:01:00.1</span><br><span class="line">E: SUBSYSTEM=mdio_bus</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Important information like: <strong>SUBSYSTEM&#x3D;net</strong>, <strong>INTERFACE&#x3D;enp1s0f1</strong>, <strong>ID_NET_DRIVER&#x3D;ixgbe</strong>, <strong>ID_NET_NAME&#x3D;enp1s0f1</strong> …</p>
<p>Assign <strong>8</strong> Virtual Network Cards:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@sense:~# echo 8 &gt; /sys/class/net/enp1s0f0/device/sriov_numvfs </span><br><span class="line">root@sense:~# echo 8 &gt; /sys/class/net/enp1s0f1/device/sriov_numvfs </span><br></pre></td></tr></table></figure>

<p>Verify network cards again:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@sense:~# lspci | grep Ethernet</span><br><span class="line">01:00.0 Ethernet controller: Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection (rev 01)</span><br><span class="line">01:00.1 Ethernet controller: Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection (rev 01)</span><br><span class="line">01:10.0 Ethernet controller: Intel Corporation 82599 Ethernet Controller Virtual Function (rev 01)</span><br><span class="line">...</span><br><span class="line">01:10.7 Ethernet controller: Intel Corporation 82599 Ethernet Controller Virtual Function (rev 01)</span><br><span class="line">01:11.0 Ethernet controller: Intel Corporation 82599 Ethernet Controller Virtual Function (rev 01)</span><br><span class="line">...</span><br><span class="line">01:11.7 Ethernet controller: Intel Corporation 82599 Ethernet Controller Virtual Function (rev 01)</span><br><span class="line">02:00.0 Ethernet controller: Intel Corporation Ethernet Controller I226-V (rev 04)</span><br><span class="line">03:00.0 Ethernet controller: Intel Corporation Ethernet Controller I226-V (rev 04)</span><br></pre></td></tr></table></figure>

<p>Persist number of SR_IOV Virtual Functions after <code>Proxmox</code> reboot:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@sense:~# cat /etc/udev/rules.d/enp.rules </span><br><span class="line">ACTION==&quot;add&quot;, SUBSYSTEM==&quot;net&quot;, ENV&#123;INTERFACE&#125;==&quot;enp1s0f0&quot;, ATTR&#123;device/sriov_numvfs&#125;=&quot;8&quot;</span><br><span class="line">ACTION==&quot;add&quot;, SUBSYSTEM==&quot;net&quot;, ENV&#123;INTERFACE&#125;==&quot;enp1s0f1&quot;, ATTR&#123;device/sriov_numvfs&#125;=&quot;8&quot;</span><br></pre></td></tr></table></figure>

<p>Add Mapped PCI Devices into Virtual Machine in <code>Proxmox</code>:</p>
<p><img src="/blog/img/Intel%20Network%20-%20Mapped%20PCI%20Devices.png" alt="Intel Network - Mapped PCI Devices" title="Intel Network - Mapped PCI Devices"></p>
<p>Virtual Network Cards can be set up as Network Cards, with hardware direct access, from a Network Cards pool (shared by other Virtual Machines), when the first Network Card is available.</p>
<p><img src="/blog/img/Intel%20Network%20-%20Virtual%20Network%20Cards.png" alt="Intel Network - Virtual Network Cards" title="Intel Network - Virtual Network Cards"></p>
<p>Virtual Machine’s <code>Proxmox</code> configuration file:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root@sense:/etc/pve/qemu-server# cat 101.conf</span><br><span class="line">agent: 1</span><br><span class="line">bios: ovmf</span><br><span class="line">boot: order=scsi0;ide2;net0</span><br><span class="line">cores: 8</span><br><span class="line">cpu: x86-64-v2-AES,flags=+aes</span><br><span class="line">efidisk0: local-lvm:vm-101-disk-0,efitype=4m,size=4M</span><br><span class="line">hostpci0: mapping=enp0_vf</span><br><span class="line">hostpci1: mapping=enp1_vf</span><br><span class="line">ide2: local:iso/OPNsense-24.7-dvd-amd64.iso,media=cdrom,size=2131548K</span><br><span class="line">machine: q35</span><br><span class="line">memory: 8192</span><br><span class="line">meta: creation-qemu=9.0.2,ctime=1731054484</span><br><span class="line">name: LINKsense</span><br><span class="line">net0: virtio=BC:24:11:0C:52:4B,bridge=vmbr2,firewall=1,queues=4</span><br><span class="line">net1: virtio=BC:24:11:21:3C:E0,bridge=vmbr3,firewall=1,queues=4</span><br><span class="line">numa: 0</span><br><span class="line">ostype: l26</span><br><span class="line">scsi0: local-lvm:vm-101-disk-1,discard=on,iothread=1,size=128G,ssd=1</span><br><span class="line">scsihw: virtio-scsi-single</span><br><span class="line">smbios1: uuid=3e913d90-c284-47d7-881a-599013fa21a4</span><br><span class="line">sockets: 1</span><br><span class="line">vmgenid: aab228d8-bccc-46c1-b627-927271ad20b6</span><br></pre></td></tr></table></figure>


<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>Overview of the Intel VT Virtualization Features, <em><a target="_blank" rel="noopener" href="https://www.thomas-krenn.com/en/wiki/Overview_of_the_Intel_VT_Virtualization_Features">https://www.thomas-krenn.com/en/wiki/Overview_of_the_Intel_VT_Virtualization_Features</a></em></li>
<li>How to Pass-through PCIe NICs with Proxmox VE on Intel and AMD, <em><a target="_blank" rel="noopener" href="https://www.servethehome.com/how-to-pass-through-pcie-nics-with-proxmox-ve-on-intel-and-amd/">https://www.servethehome.com/how-to-pass-through-pcie-nics-with-proxmox-ve-on-intel-and-amd/</a></em></li>
<li>Persisting SR-IOV virtual functions after reboot, <em><a target="_blank" rel="noopener" href="https://www.reddit.com/r/homelab/comments/hf12mv/persisting_sriov_virtual_functions_after_reboot/">https://www.reddit.com/r/homelab/comments/hf12mv/persisting_sriov_virtual_functions_after_reboot/</a></em></li>
<li>Chapter 11. Managing virtual devices, <em><a target="_blank" rel="noopener" href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/configuring_and_managing_virtualization/managing-virtual-devices_configuring-and-managing-virtualization">https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/configuring_and_managing_virtualization/managing-virtual-devices_configuring-and-managing-virtualization</a></em></li>
</ul>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>



    <nav id="page-nav">

<span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><a class="page-number" href="/blog/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/13/">13</a><a class="extend next" rel="next" href="/blog/page/2/">Next</a>
</nav>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-posts"></i> Recent</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2025/01/25/ZeroTier-on-TrueNAS-Scale/">ZeroTier on TrueNAS Scale</a>
          </li>
        
          <li>
            <a href="/blog/2025/01/22/Xray-X-UI-Reality-protocol-Vision-flow-on-Oracle-Cloud/">Xray, X-UI, Reality protocol, Vision flow on Oracle Cloud</a>
          </li>
        
          <li>
            <a href="/blog/2025/01/22/Xray-X-UI-Reality-protocol-Vision-flow-on-Amazon-Linux/">Xray, X-UI, Reality protocol, Vision flow on Amazon Linux</a>
          </li>
        
          <li>
            <a href="/blog/2024/12/21/How-to-install-and-run-Tailscale-client-on-OpenWrt/">How to install and run Tailscale client on OpenWrt</a>
          </li>
        
          <li>
            <a href="/blog/2024/12/21/How-to-install-and-run-ZeroTier-client-on-OpenWrt/">How to install and run ZeroTier client on OpenWrt</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-archive"></i> Archive</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2025/">2025</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2024/">2024</a><span class="archive-list-count">30</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/">2023</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/">2022</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/">2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/">2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/">2019</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/">2018</a><span class="archive-list-count">31</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/">2017</a><span class="archive-list-count">25</span></li></ul>
    </div>
  </div>


  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-link"></i> Blogroll</h3>
    <div class="widget">
      <ul>
      
        <li>
          <a target="_blank" rel="noopener" href="https://www.linkedin.com/in/terrencemiao/">LinkedIn</a>
        </li>
      
        <li>
          <a target="_blank" rel="noopener" href="https://github.com/TerrenceMiao">GitHub</a>
        </li>
      
        <li>
          <a target="_blank" rel="noopener" href="https://twitter.com/TerrenceMiao">Twitter</a>
        </li>
      
      </ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <a id="totop" href="#top"></a>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <p>
        <a href="/blog/sitemap.xml">Site Map</a>
        <span> | </span><a href="/blog/atom.xml">Subscribe to this site</a>
        <span> | </span><a href="/blog/about/">Contact the blogger</a>
      </p>
      
        <p>
          <i class="fa fa-visitors"></i>
          <i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>
          ，
          <i class="fa fa-views"></i>
          <i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>
        </p>
      
      <p>
        <span>Copyright &copy; 2025 Terrence Miao.</span>
        <span>Theme by <a href="https://github.com/chaooo/hexo-theme-BlueLake/" target="_blank">BlueLake.</a></span>
        <span>Powered by <a href="https://hexo.io/" target="_blank">Hexo.</a></span>
      </p>
    </div>
  </div>
</footer>

    </div>
  </div>
  
<script src="/blog/js/jquery-3.4.1.min.js"></script>


<script src="/blog/js/search.json.js"></script>


  
<script src="/blog/fancybox/jquery.fancybox.min.js"></script>




<script src="/blog/js/script.js"></script>






  
<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>








  



  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>
  <script src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML" async type="text/javascript"></script>

</body>
</html>