<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=330279473"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '330279473');
</script>
<!-- End Google Analytics -->

  
  <title>Terrence Miao&#39;s Adventures</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
    <meta name="description" content="Veni, vidi, vici">
  
  
  
    <link rel="alternate" href="/blog/atom.xml" title="Terrence Miao's Adventures" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/blog/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/blog/css/style.css">

  
    
<link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.min.css">

  
  
  
  
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7274218747178099" crossorigin="anonymous"></script>
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">Terrence Miao&#39;s Adventures</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/blog/" id="subtitle">A journey of a thousand miles begins with a single step</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/blog/."><i class="fa fa-home"></i> Home</a>
        
          <a class="main-nav-link" href="/blog/archives/"><i class="fa fa-archive"></i> Archive</a>
        
          <a class="main-nav-link" href="/blog/about/"><i class="fa fa-user"></i> About</a>
        
          <a class="main-nav-link" href="/blog/atom.xml"><i class="fa fa-rss"></i> RSS</a>
        
      </nav>
    </div>
    <div id="search-form">
      <div id="result-mask" class="hide"></div>
      <label><input id="search-key" type="text" autocomplete="off" placeholder="search"></label>
      <div id="result-wrap" class="hide">
        <div id="search-result"></div>
      </div>
      <div class="hide">
        <template id="search-tpl">
          <div class="item">
            <a href="/{path}" title="{title}">
              <div class="title">{title}</div>
              <div class="time">{date}</div>
              <div class="tags">{tags}</div>
            </a>
          </div>
        </template>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  <article id="post-How-to-enable-SMB-Direct-client-server-in-Windows-11-Pro-for-Workstations" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/09/14/How-to-enable-SMB-Direct-client-server-in-Windows-11-Pro-for-Workstations/">How to enable SMB Direct client/server in Windows 11 Pro for Workstations</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-09-14T07:52:08.000Z" itemprop="datePublished">2024-09-14</time>
</span>
      
      
      
<a href="/blog/2024/09/14/How-to-enable-SMB-Direct-client-server-in-Windows-11-Pro-for-Workstations/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>In <code>Windows 11 Pro Station</code>:</p>
<p><img src="/blog/img/Windows%2011%20Pro%20for%20Workstations.png" alt="Windows 11 Pro for Workstations" title="Windows 11 Pro for Workstations"></p>
<p>Open Windows Terminal as Administrator.</p>
<p>Enable SMB Direct:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Enable-WindowsOptionalFeature -Online -FeatureName SMBDirect</span><br><span class="line">Path          :</span><br><span class="line">Online        : True</span><br><span class="line">RestartNeeded : False</span><br></pre></td></tr></table></figure>

<p>Enable SMB Multichannel on the client-side:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Set-SmbClientConfiguration -EnableMultiChannel $true</span><br><span class="line">Confirm</span><br><span class="line">Are you sure you want to perform this action?</span><br><span class="line">Performing operation &#x27;Modify&#x27; on Target &#x27;SMB Client Configuration&#x27;.</span><br><span class="line">[Y] Yes  [A] Yes to All  [N] No  [L] No to All  [S] Suspend  [?] Help (default is &quot;Y&quot;):</span><br><span class="line"></span><br><span class="line">PS C:\&gt; Get-SmbClientConfiguration</span><br><span class="line">...</span><br><span class="line">EnableMultiChannel                    : True</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Enable SMB Multichannel on the server-side:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Set-SmbServerConfiguration -EnableMultiChannel $true</span><br><span class="line">Confirm</span><br><span class="line">Are you sure you want to perform this action?</span><br><span class="line">Performing operation &#x27;Modify&#x27; on Target &#x27;SMB Server Configuration&#x27;.</span><br><span class="line">[Y] Yes  [A] Yes to All  [N] No  [L] No to All  [S] Suspend  [?] Help (default is &quot;Y&quot;):</span><br><span class="line"></span><br><span class="line">PS C:\&gt; Get-SmbServerConfiguration</span><br><span class="line">...</span><br><span class="line">EnableMultiChannel                     : True</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Enable RDMA for a specific interface:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Enable-NetAdapterRDMA Mellanox</span><br></pre></td></tr></table></figure>

<p>Verify which state of operability SMB Direct is currently configured to:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Get-WindowsOptionalFeature -Online -FeatureName SMBDirect</span><br><span class="line">FeatureName      : SmbDirect</span><br><span class="line">DisplayName      : SMB Direct</span><br><span class="line">Description      : Remote Direct Memory Access (RDMA) support for the SMB 3.x file sharing protocol</span><br><span class="line">RestartRequired  : Possible</span><br><span class="line">State            : Enabled</span><br><span class="line">CustomProperties :</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Get-SmbClientNetworkInterface</span><br><span class="line">Interface Index RSS Capable RDMA Capable Speed       IpAddresses                                 Friendly Name</span><br><span class="line">--------------- ----------- ------------ -----       -----------                                 -------------</span><br><span class="line">22              True        True         100 Gbps    &#123;fe80::708:c529:1bcb:2432, 192.168.68.67&#125;   Mellanox</span><br><span class="line"></span><br><span class="line">PS C:\&gt; Get-SmbServerNetworkInterface</span><br><span class="line">Scope Name Interface Index RSS Capable RDMA Capable Speed    IpAddress</span><br><span class="line">---------- --------------- ----------- ------------ -----    ---------</span><br><span class="line">*          22              True        True         100 Gbps fe80::708:c529:1bcb:2432</span><br><span class="line">*          22              True        True         100 Gbps 192.168.68.67</span><br></pre></td></tr></table></figure>

<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>SMB Direct, <em><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows-server/storage/file-server/smb-direct">https://learn.microsoft.com/en-us/windows-server/storage/file-server/smb-direct</a></em></li>
</ul>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Fixing-TrueNAS-SMB-IP-binding" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/09/14/Fixing-TrueNAS-SMB-IP-binding/">Fixing TrueNAS SMB IP binding</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-09-14T02:37:53.000Z" itemprop="datePublished">2024-09-14</time>
</span>
      
      
      
<a href="/blog/2024/09/14/Fixing-TrueNAS-SMB-IP-binding/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>After changing network settings, <code>TrueNAS</code> IP address has been updated. If modify SMB configuration, error like:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smb_update.bindip.0: IP address [192.168.0.51] is not a configured address for this server</span><br></pre></td></tr></table></figure>

<p>thrown.</p>
<p>To reset and clean up already bind IP, login TrueNAS Console and run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">root@TrueNAS[~]# midclt call smb.update &#x27;&#123;&quot;bindip&quot;: []&#125;&#x27;</span><br><span class="line">&#123;</span><br><span class="line">    &quot;id&quot;: 1,</span><br><span class="line">    &quot;netbiosname&quot;: &quot;TRUENAS&quot;,</span><br><span class="line">    &quot;netbiosalias&quot;: [],</span><br><span class="line">    &quot;workgroup&quot;: &quot;IGLOO STUDIO&quot;,</span><br><span class="line">    &quot;description&quot;: &quot;TrueNAS Server&quot;,</span><br><span class="line">    &quot;unixcharset&quot;: &quot;UTF-8&quot;,</span><br><span class="line">    &quot;loglevel&quot;: &quot;MINIMUM&quot;,</span><br><span class="line">    &quot;syslog&quot;: false,</span><br><span class="line">    &quot;aapl_extensions&quot;: true,</span><br><span class="line">    &quot;Localmaster&quot;: true,</span><br><span class="line">    &quot;guest&quot;: &quot;nobody&quot;,</span><br><span class="line">    &quot;filemask&quot;&#x27;: &quot;&quot;,</span><br><span class="line">    &quot;dirmask&quot;&#x27;: &quot;&quot;,</span><br><span class="line">    &quot;smb_options&quot;: &quot;&quot;,</span><br><span class="line">    &quot;bindip&quot;: [],</span><br><span class="line">    &quot;cifs_SID&quot;: &quot;S-1-5-21-2487580926-3122677641-100607549&quot;,</span><br><span class="line">    &quot;ntImv1_auth&quot;: false,</span><br><span class="line">    &quot;enable_smb1&quot;: false,</span><br><span class="line">    &quot;admin_group&quot;: null,</span><br><span class="line">    &quot;next_rid&quot;: 0,</span><br><span class="line">    &quot;multichannel&quot;: true,</span><br><span class="line">    &quot;netbiosname_local&quot;: &quot;TRUENAS&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>then can modify SMB configuration successfully.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>Help with SMB IP binding, <em><a target="_blank" rel="noopener" href="https://www.reddit.com/r/freenas/comments/fovpfz/help_with_smb_ip_binding">https://www.reddit.com/r/freenas/comments/fovpfz/help_with_smb_ip_binding</a></em></li>
</ul>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Running-MacOS-on-Proxmox" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/09/08/Running-MacOS-on-Proxmox/">Running MacOS on Proxmox</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-09-08T01:34:16.000Z" itemprop="datePublished">2024-09-08</time>
</span>
      
      
      
<a href="/blog/2024/09/08/Running-MacOS-on-Proxmox/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Following the instructions to run the latest MacOS, <em>Sonoma 14.6.1</em>, on Proxmox - <a target="_blank" rel="noopener" href="https://klabsdev.com/definitive-guide-to-running-macos-in-proxmox">The Definitive Guide to Running MacOS in Proxmox</a>.</p>
<p><img src="/blog/img/Proxmox%20-%20MacOS.png" alt="Proxmox - MacOS" title="Proxmox - MacOS"></p>
<p>A few more put on notes:</p>
<ul>
<li>You can login with <code>Apple ID</code></li>
<li>Modify <code>config.plist</code> file under EFI folder -&gt; OC folder, change the default Screen Resolution from <code>1080P</code> <strong>1920x1080@32</strong> to <code>2K</code> <strong>2560x1440@32</strong>. Look more information in <code>Configuration.pdf</code> file in <a target="_blank" rel="noopener" href="https://github.com/thenickdude/KVM-Opencore/releases"><strong>KVM-Opencore</strong> release</a></li>
</ul>
<p>Connect with <strong>Apple Remote Desktop</strong>, so can use exact same Apple Keyboard mapping:</p>
<p><img src="/blog/img/Proxmox%20-%20Apple%20Remote%20Desktop.png" alt="Proxmox - Apple Remote Desktop" title="Proxmox - Apple Remote Desktop"></p>
<p>Current <a target="_blank" rel="noopener" href="https://github.com/thenickdude/KVM-Opencore"><strong>KVM-Opencore</strong></a> hasn’t setup support for Audio device and GPU accelerator.</p>
<p>Also try to setup <a target="_blank" rel="noopener" href="https://parsec.app/"><strong>Parsec</strong></a> in MacOS on Proxmox, without success.</p>
<p><img src="/blog/img/Proxmox%20-%20Parsec.png" alt="Proxmox - Parsec" title="Proxmox - Parsec"></p>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Setup-MikroTik-CRS504-4XQ-IN-and-run-a-speed-test" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/09/02/Setup-MikroTik-CRS504-4XQ-IN-and-run-a-speed-test/">Setup MikroTik CRS504-4XQ-IN and run a speed test</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-09-02T04:17:37.000Z" itemprop="datePublished">2024-09-02</time>
</span>
      
      
      
<a href="/blog/2024/09/02/Setup-MikroTik-CRS504-4XQ-IN-and-run-a-speed-test/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><code>MikroTik CRS504-4XQ-IN</code>, the Cloud Switch can handle FOUR QSFP28 100Gbps ports, equal to 16 x 25Gbps bandwidth.</p>
<p><img src="/blog/img/MikroTik%20-%20Interfaces.png" alt="MikroTik - Interfaces" title="MikroTik - Interfaces"></p>
<p>Setup single link mode, only the first QSFP28 sub-interface needs to be configured, while the remaining three sub-interfaces should remain enabled. For example, connect <code>Mellanox MCX455A-ECAT ConnectX-4 InfiniBand/Ethernet adapter card (EDR IB 100Gbps and 100GbE, single-port QSFP28, PCIe 3.0x16)</code> using <code>ONTi DAC QSFP28 100Gbps</code> cable to the switch.</p>
<p>Change <strong>FEC Mode</strong> to <code>fec91</code>.</p>
<p><em>Ethernet Forward Error Correction (FEC) is a technique used to improve the reliability of data transmission over Ethernet networks by detecting and correcting errors in data packets. The two most common types of FEC used in Ethernet networks are CL74 and CL91.</em></p>
<p><em>CL74 and CL91 refer to two different types of FEC codes, each with its own characteristics and performance. Here’s a brief comparison between the two:</em></p>
<p><em>Code Rate:</em></p>
<p><em>CL91 has a higher code rate of 91.6%, which means that only 8.4% of the data transmitted is used for error correction.</em></p>
<p>In addition, setup the swith port connected to <code>ONTi QSFP28 40Gbps TO 4SFP+</code> breakout cable:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -l admin MikroTik.local</span><br><span class="line"></span><br><span class="line">[admin@MikroTik] &gt; /interface ethernet set qsfp28-1-1 auto-negotiation=no speed=10G-baseCR</span><br><span class="line">[admin@MikroTik] &gt; /interface ethernet set qsfp28-1-2 auto-negotiation=no speed=10G-baseCR</span><br><span class="line">[admin@MikroTik] &gt; /interface ethernet set qsfp28-1-3 auto-negotiation=no speed=10G-baseCR</span><br><span class="line">[admin@MikroTik] &gt; /interface ethernet set qsfp28-1-4 auto-negotiation=no speed=10G-baseCR</span><br></pre></td></tr></table></figure>

<h2 id="Speed-test"><a href="#Speed-test" class="headerlink" title="Speed test"></a>Speed test</h2><p>In <code>iperf3</code> server, run listens to 4 ports to manage connections in parallel:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ iperf3 -s -p 5201 &amp; iperf3 -s -p 5202 &amp; iperf3 -s -p 5203 &amp; iperf3 -s -p 5204 &amp;</span><br></pre></td></tr></table></figure>

<p>In a MacBook Pro with WiFi-6 connection, run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ iperf3 -c MikroTik.local -p 5201 -P 4 -t 1000</span><br></pre></td></tr></table></figure>

<p>In a Mac Studio with 10Gbps Ethernet connection, run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ iperf3 -c MikroTik.local -p 5202 -P 8 -t 1000 -B 192.168.0.104</span><br></pre></td></tr></table></figure>

<p>In a Windows 11 PC with 100Gbps Ethernet connection, run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ iperf3 -c MikroTik.local -p 5203 -P 2 -t 1000</span><br></pre></td></tr></table></figure>

<p>Check the speed on switch console:</p>
<p><img src="/blog/img/MikroTik%20-%20Speed.png" alt="MikroTik - Speed" title="MikroTik - Speed"></p>
<p>and in graph:</p>
<p><img src="/blog/img/MikroTik%20-%20Performance.png" alt="MikroTik - Performance" title="MikroTik - Performance"></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>MikroTik wired interface compatibility, <em><a target="_blank" rel="noopener" href="https://help.mikrotik.com/docs/display/ROS/MikroTik+wired+interface+compatibility">https://help.mikrotik.com/docs/display/ROS/MikroTik+wired+interface+compatibility</a></em></li>
<li>MikroTik RouterOS, <em><a target="_blank" rel="noopener" href="https://help.mikrotik.com/docs/display/ROS/RouterOS">https://help.mikrotik.com/docs/display/ROS/RouterOS</a></em></li>
<li>MikroTik CRS504-4XQ-IN Quick Guide, <em><a target="_blank" rel="noopener" href="https://help.mikrotik.com/docs/display/QG/Quick+Guide+-+CRS504-4XQ-IN">https://help.mikrotik.com/docs/display/QG/Quick+Guide+-+CRS504-4XQ-IN</a></em></li>
<li>FEC (Forward Error Correction), <em><a target="_blank" rel="noopener" href="https://www.reddit.com/r/fortinet/comments/127z3wd/fec_forward_error_correction/">https://www.reddit.com/r/fortinet/comments/127z3wd/fec_forward_error_correction/</a></em></li>
</ul>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Setup-network-bond-in-Synology-NAS" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/08/11/Setup-network-bond-in-Synology-NAS/">Setup network bond in Synology NAS</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-08-11T05:45:25.000Z" itemprop="datePublished">2024-08-11</time>
</span>
      
      
      
<a href="/blog/2024/08/11/Setup-network-bond-in-Synology-NAS/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Synology NAS DS920+ with two build-in 1Gbps ethernet adapters, and two 2.5Gbps USB 3.0 Ethernet Adapters. Now setup network bond &#x2F; link aggregation on them.</p>
<ul>
<li>Enable Network Link Aggregation Mode</li>
</ul>
<p><img src="/blog/img/Synology%20-%20Network%20Link%20Aggregation.png" alt="Synology - Network Link Aggregation Mode" title="Synology - Network Link Aggregation Mode"></p>
<ul>
<li>Pickup network devices into bond</li>
</ul>
<p><img src="/blog/img/Synology%20-%20Physical%20devices.png" alt="Synology - Physical devices" title="Synology - Physical devices"></p>
<ul>
<li>Setup network</li>
</ul>
<p><img src="/blog/img/Synology%20-%20Physical%20devices%20network%20setup.png" alt="Synology - Physical devices network setup" title="Synology - Physical devices network setup"></p>
<ul>
<li>Accept network interface change after network bond</li>
</ul>
<p><img src="/blog/img/Synology%20-%20Bond%20warning%20message.png" alt="Synology - Bond warning message" title="Synology - Bond warning message"></p>
<ul>
<li>Network bonded</li>
</ul>
<p><img src="/blog/img/Synology%20-%20Network%20bonded.png" alt="Synology - Network bonded" title="Synology - Network bonded"></p>
<ul>
<li>Network bond service order</li>
</ul>
<p><img src="/blog/img/Synology%20-%20Network%20bonded.png" alt="Synology - Network bond service order" title="Synology - Network bond service order"></p>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Setup-TrueNAS-Network-and-Link-Aggregation" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/08/09/Setup-TrueNAS-Network-and-Link-Aggregation/">Setup TrueNAS Network and Link Aggregation</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-08-08T15:03:40.000Z" itemprop="datePublished">2024-08-09</time>
</span>
      
      
      
<a href="/blog/2024/08/09/Setup-TrueNAS-Network-and-Link-Aggregation/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Two network adapters have been setup with DHCP allocated addresses:</p>
<ol>
<li><code>ens18</code> 192.168.0.246</li>
<li><code>ens19</code> 192.168.0.105</li>
</ol>
<ul>
<li>Create a Network Link Aggregation Interface</li>
</ul>
<p><img src="/blog/img/TrueNAS%20-%20Link%20Aggregation.png" alt="TrueNAS - Link Aggregation" title="TrueNAS - Link Aggregation"></p>
<p>After Link Aggregation Interface <code>bond1</code> created, original two network adapters <code>ens18</code> and <code>ens19</code> IP addresses are gone. <code>bond1</code> with the ONLY ONE network interface address for <code>TrueNAS</code>.</p>
<p><img src="/blog/img/TrueNAS%20-%20Network.png" alt="TrueNAS - Network" title="TrueNAS - Network"></p>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Samba-setup-and-share-in-TrueNAS" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/08/07/Samba-setup-and-share-in-TrueNAS/">Samba setup and share in TrueNAS</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-08-07T12:19:00.000Z" itemprop="datePublished">2024-08-07</time>
</span>
      
      
      
<a href="/blog/2024/08/07/Samba-setup-and-share-in-TrueNAS/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><code>TrueNAS</code> installed and a few steps to setup to let users access shared <code>Samba</code> directories.</p>
<ul>
<li>Enable <code>SMB</code> Samba service in <code>TrueNAS</code></li>
</ul>
<p><img src="/blog/img/TrueNAS%20-%20Enable%20SMB%20service.png" alt="TrueNAS - Enable SMB service" title="TrueNAS - Enable SMB service"></p>
<p><img src="/blog/img/TrueNAS%20-%20SMB%20Settings.png" alt="TrueNAS - SMB Settings" title="TrueNAS - SMB Settings"></p>
<ul>
<li>Create an user account with home directory and all access permisssions</li>
</ul>
<p><img src="/blog/img/TrueNAS%20-%20Create%20user.png" alt="TrueNAS - Create user" title="TrueNAS - Create user"></p>
<ul>
<li>Share <code>TrueNAS</code> pool created</li>
</ul>
<p><img src="/blog/img/TrueNAS%20-%20Sharing.png" alt="TrueNAS - Sharing" title="TrueNAS - Sharing"></p>
<p>Then can access shared directory from <code>TrunNAS</code> in both Windows and Mac:</p>
<p><img src="/blog/img/TrueNAS%20-%20Access.png" alt="TrueNAS - Access" title="TrueNAS - Access"></p>
<p>Make sure there is NO a lock icon on the folder (can unlock the folder in MacOS Finder)</p>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Increase-decrease-and-resize-Proxmox-disk-volume" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/08/07/Increase-decrease-and-resize-Proxmox-disk-volume/">Increase, decrease and resize Proxmox disk volume</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-08-07T03:29:22.000Z" itemprop="datePublished">2024-08-07</time>
</span>
      
      
      
<a href="/blog/2024/08/07/Increase-decrease-and-resize-Proxmox-disk-volume/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>After a default installation, a tiny disk space given to <code>Proxmox</code> root volume. Insufficient disk space issue raised up after several VMs installed and backup made, as iinstallation image files <code>*.ISO</code> and backup all put into root volume.</p>
<p>In <code>storage.cfg</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# cat /etc/pve/storage.cfg</span><br><span class="line">dir: local</span><br><span class="line">        path /var/lib/vz</span><br><span class="line">        content iso,vztmpl,backup</span><br><span class="line"></span><br><span class="line">lvmthin: local-lvm</span><br><span class="line">        thinpool data</span><br><span class="line">        vgname pve</span><br><span class="line">        content rootdir,images</span><br></pre></td></tr></table></figure>

<p>Run <code>lvdisplay</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lvdisplay</span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Name                data</span><br><span class="line">  VG Name                pve</span><br><span class="line">  # open                 0</span><br><span class="line">  LV Size                &lt;3.58 TiB</span><br><span class="line"></span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/pve/swap</span><br><span class="line">  LV Name                swap</span><br><span class="line">  VG Name                pve</span><br><span class="line">  LV Status              available</span><br><span class="line">  # open                 2</span><br><span class="line">  LV Size                8.00 GiB</span><br><span class="line"></span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/pve/root</span><br><span class="line">  LV Name                root</span><br><span class="line">  VG Name                pve</span><br><span class="line">  LV Status              available</span><br><span class="line">  # open                 1</span><br><span class="line">  LV Size                &lt;112.25 GiB</span><br></pre></td></tr></table></figure>

<p>Solution is to decrease the size of <code>pve/data</code> volume, as this volume doesn’t support reducing thin pools in size yet, and then to increase the size of <code>pdev/root</code> volume.</p>
<p>Backup all VMs, then remove <code>pve/data</code> volume:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lvremove pve/data</span><br><span class="line">Removing pool pve/data will remove 7 dependent volume(s). Proceed? [y/n]: y</span><br></pre></td></tr></table></figure>

<p>Based on the disk space has just released, increase the size of <code>pdev/root</code> volume, <strong>20%</strong> for current FREE space in this case:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lvextend -l +20%FREE /dev/pve/root</span><br><span class="line">  Size of logical volume pve/root changed from &lt;112.25 GiB (28735 extents) to &lt;851.09 GiB (217878 extents).</span><br><span class="line">  Logical volume pve/root successfully resized.</span><br><span class="line"></span><br><span class="line">root@pve:~# resize2fs /dev/pve/root</span><br><span class="line">resize2fs 1.47.0 (5-Feb-2023)</span><br><span class="line">Filesystem at /dev/pve/root is mounted on /; on-line resizing required</span><br><span class="line">old_desc_blocks = 15, new_desc_blocks = 107</span><br><span class="line">The filesystem on /dev/pve/root is now 223107072 (4k) blocks long.</span><br></pre></td></tr></table></figure>

<p>Create a new <code>pve/data</code> volume:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lvcreate -L2920G -ndata pve</span><br><span class="line">  Logical volume &quot;data&quot; created.</span><br></pre></td></tr></table></figure>

<p>Check free disk space:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# vgdisplay</span><br><span class="line">  --- Volume group ---</span><br><span class="line">  VG Name               pve</span><br><span class="line">  System ID</span><br><span class="line">  Format                lvm2</span><br><span class="line">  Metadata Areas        1</span><br><span class="line">  Metadata Sequence No  126</span><br><span class="line">  VG Access             read/write</span><br><span class="line">  VG Status             resizable</span><br><span class="line">  MAX LV                0</span><br><span class="line">  Cur LV                3</span><br><span class="line">  Open LV               2</span><br><span class="line">  Max PV                0</span><br><span class="line">  Cur PV                1</span><br><span class="line">  Act PV                1</span><br><span class="line">  VG Size               &lt;3.73 TiB</span><br><span class="line">  PE Size               4.00 MiB</span><br><span class="line">  Total PE              976498</span><br><span class="line">  Alloc PE / Size       967446 / 3.69 TiB</span><br><span class="line">  Free  PE / Size       9052 / &lt;35.36 GiB</span><br><span class="line">  VG UUID               UEsIZR-TBsz-UYlP-u2FO-2AbC-uq4d-vcb35f</span><br></pre></td></tr></table></figure>

<p>Create thin pool volume of the metadata, usually size of 1% of <code>pve/data</code> volume:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lvconvert --type thin-pool --poolmetadatasize 36G pve/data</span><br><span class="line">  Reducing pool metadata size 36.00 GiB to maximum usable size &lt;15.88 GiB.</span><br><span class="line">  Thin pool volume with chunk size 64.00 KiB can address at most &lt;15.88 TiB of data.</span><br><span class="line">  WARNING: Converting pve/data to thin pool&#x27;s data volume with metadata wiping.</span><br><span class="line">  THIS WILL DESTROY CONTENT OF LOGICAL VOLUME (filesystem etc.)</span><br><span class="line">Do you really want to convert pve/data? [y/n]: y</span><br><span class="line">  Converted pve/data to thin pool.</span><br></pre></td></tr></table></figure>

<p>Verify current disk volumes, <code>pve/root</code> disk volume has more space now:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# df -h</span><br><span class="line">Filesystem            Size  Used Avail Use% Mounted on</span><br><span class="line">udev                   16G     0   16G   0% /dev</span><br><span class="line">tmpfs                 3.2G  1.8M  3.2G   1% /run</span><br><span class="line">/dev/mapper/pve-root  841G   71G  736G   9% /</span><br><span class="line">tmpfs                  16G   46M   16G   1% /dev/shm</span><br><span class="line">tmpfs                 5.0M     0  5.0M   0% /run/lock</span><br><span class="line">efivarfs               192K  114K   74K  61% /sys/firmware/efi/efivars</span><br><span class="line">/dev/nvme3n1p2       1022M   12M 1011M   2% /boot/efi</span><br><span class="line">/dev/fuse             128M   20K  128M   1% /etc/pve</span><br><span class="line">tmpfs                 3.2G     0  3.2G   0% /run/user/0</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lsblk</span><br><span class="line">NAME                         MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">sda                            8:0    0 223.6G  0 disk</span><br><span class="line">├─sda1                         8:1    0   100M  0 part</span><br><span class="line">├─sda2                         8:2    0    16M  0 part</span><br><span class="line">├─sda3                         8:3    0 120.3G  0 part</span><br><span class="line">├─sda4                         8:4    0   625M  0 part</span><br><span class="line">└─sda5                         8:5    0 102.5G  0 part</span><br><span class="line">nvme2n1                      259:0    0   3.6T  0 disk</span><br><span class="line">nvme4n1                      259:1    0   3.6T  0 disk</span><br><span class="line">nvme0n1                      259:2    0   3.6T  0 disk</span><br><span class="line">nvme1n1                      259:3    0   3.6T  0 disk</span><br><span class="line">nvme5n1                      259:4    0   3.6T  0 disk</span><br><span class="line">nvme3n1                      259:5    0   3.7T  0 disk</span><br><span class="line">├─nvme3n1p1                  259:6    0  1007K  0 part</span><br><span class="line">├─nvme3n1p2                  259:7    0     1G  0 part /boot/efi</span><br><span class="line">└─nvme3n1p3                  259:8    0   3.7T  0 part</span><br><span class="line">  ├─pve-swap                 252:0    0     8G  0 lvm  [SWAP]</span><br><span class="line">  ├─pve-root                 252:1    0 854.7G  0 lvm  /</span><br><span class="line">  ├─pve-data_tmeta           252:2    0  15.9G  0 lvm</span><br><span class="line">  │ └─pve-data-tpool         252:4    0   2.9T  0 lvm</span><br><span class="line">  │   ├─pve-data             252:5    0   2.9T  1 lvm</span><br><span class="line">  │   ├─pve-vm--100--disk--0 252:6    0   240G  0 lvm</span><br><span class="line">  │   ├─pve-vm--101--disk--0 252:7    0     4M  0 lvm</span><br><span class="line">  │   ├─pve-vm--101--disk--1 252:8    0   240G  0 lvm</span><br><span class="line">  │   ├─pve-vm--101--disk--2 252:9    0     4M  0 lvm</span><br><span class="line">  │   ├─pve-vm--102--disk--0 252:10   0     4M  0 lvm</span><br><span class="line">  │   ├─pve-vm--102--disk--1 252:11   0   240G  0 lvm</span><br><span class="line">  │   └─pve-vm--102--disk--2 252:12   0     4M  0 lvm</span><br><span class="line">  └─pve-data_tdata           252:3    0   2.9T  0 lvm</span><br><span class="line">    └─pve-data-tpool         252:4    0   2.9T  0 lvm</span><br><span class="line">      ├─pve-data             252:5    0   2.9T  1 lvm</span><br><span class="line">      ├─pve-vm--100--disk--0 252:6    0   240G  0 lvm</span><br><span class="line">      ├─pve-vm--101--disk--0 252:7    0     4M  0 lvm</span><br><span class="line">      ├─pve-vm--101--disk--1 252:8    0   240G  0 lvm</span><br><span class="line">      ├─pve-vm--101--disk--2 252:9    0     4M  0 lvm</span><br><span class="line">      ├─pve-vm--102--disk--0 252:10   0     4M  0 lvm</span><br><span class="line">      ├─pve-vm--102--disk--1 252:11   0   240G  0 lvm</span><br><span class="line">      └─pve-vm--102--disk--2 252:12   0     4M  0 lvm</span><br><span class="line"></span><br><span class="line">root@pve:~# lvs</span><br><span class="line">  LV            VG  Attr       LSize    Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  data          pve twi-aotz--    2.85t             3.19   0.32</span><br><span class="line">  root          pve -wi-ao---- &lt;854.69g</span><br><span class="line">  swap          pve -wi-ao----    8.00g</span><br><span class="line">  vm-100-disk-0 pve Vwi-a-tz--  240.00g data        10.38</span><br><span class="line">  vm-101-disk-0 pve Vwi-a-tz--    4.00m data        14.06</span><br><span class="line">  vm-101-disk-1 pve Vwi-a-tz--  240.00g data        19.50</span><br><span class="line">  vm-101-disk-2 pve Vwi-a-tz--    4.00m data        1.56</span><br><span class="line">  vm-102-disk-0 pve Vwi-a-tz--    4.00m data        14.06</span><br><span class="line">  vm-102-disk-1 pve Vwi-a-tz--  240.00g data        8.98</span><br><span class="line">  vm-102-disk-2 pve Vwi-a-tz--    4.00m data        1.56</span><br></pre></td></tr></table></figure>

<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>Reduce size of local-lvm <em><a target="_blank" rel="noopener" href="https://forum.proxmox.com/threads/reduce-size-of-local-lvm.78676/">https://forum.proxmox.com/threads/reduce-size-of-local-lvm.78676/</a></em></li>
</ul>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Proxmox-and-SR-IOV-support-for-Intel-GPU-and-Mellonax-network-adapter" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/08/04/Proxmox-and-SR-IOV-support-for-Intel-GPU-and-Mellonax-network-adapter/">Proxmox and SR-IOV support for Intel GPU and Mellonax network adapter</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-08-04T01:56:12.000Z" itemprop="datePublished">2024-08-04</time>
</span>
      
      
      
<a href="/blog/2024/08/04/Proxmox-and-SR-IOV-support-for-Intel-GPU-and-Mellonax-network-adapter/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li><p>Enable <code>VT-d</code> for IOMMU (（Input Output Memory Management Unit) services, and <code>SR-IOV</code> in motherboard BIOS in Chipset, e.g. <em>ASRock Z790 Riptide WiFi</em>.</p>
</li>
<li><p>Enable <code>SR-IOV</code> for Mellonax network adapter e.g. <em>Mellanox ConnectX-4 MCX455A-ECAT PCIe x16 3.0 100GBe VPI EDR IB</em> in the same motherboard BIOS.</p>
</li>
<li><p>Add Proxmox No Subscription URL:</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# cat /etc/apt/sources.list</span><br><span class="line">deb http://ftp.au.debian.org/debian bookworm main contrib</span><br><span class="line"></span><br><span class="line">deb http://ftp.au.debian.org/debian bookworm-updates main contrib</span><br><span class="line"></span><br><span class="line"># security updates</span><br><span class="line">deb http://security.debian.org bookworm-security main contrib</span><br><span class="line"></span><br><span class="line"># Proxmox VE pve-no-subscription repository provided by proxmox.com,</span><br><span class="line"># NOT recommended for production use</span><br><span class="line">deb http://download.proxmox.com/debian/pve bookworm pve-no-subscription</span><br></pre></td></tr></table></figure>

<p>and run packages update:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# apt update</span><br></pre></td></tr></table></figure>

<p>and install all build tools:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# apt install build-* dkms</span><br></pre></td></tr></table></figure>

<ul>
<li>Set&#x2F;Pin Proxmox kernel version:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# proxmox-boot-tool kernel pin 6.8.4-2-pve</span><br><span class="line">Setting &#x27;6.8.4-2-pve&#x27; as grub default entry and running update-grub.</span><br><span class="line">Generating grub configuration file ...</span><br><span class="line">Found linux image: /boot/vmlinuz-6.8.4-2-pve</span><br><span class="line">Found initrd image: /boot/initrd.img-6.8.4-2-pve</span><br><span class="line">Found memtest86+ 64bit EFI image: /boot/memtest86+x64.efi</span><br><span class="line">Adding boot menu entry for UEFI Firmware Settings ...</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>and verify Proxmox kernal version:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# proxmox-boot-tool kernel list</span><br><span class="line">Manually selected kernels:</span><br><span class="line">None.</span><br><span class="line"></span><br><span class="line">Automatically selected kernels:</span><br><span class="line">6.8.4-2-pve</span><br><span class="line"></span><br><span class="line">Pinned kernel:</span><br><span class="line">6.8.4-2-pve</span><br></pre></td></tr></table></figure>

<ul>
<li>Install Proxmox kernel headers source code package:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# apt install proxmox-headers-6.8.4-2-pve</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree... Done</span><br><span class="line">Reading state information... Done</span><br><span class="line">The following NEW packages will be installed:</span><br><span class="line">  proxmox-headers-6.8.4-2-pve</span><br><span class="line">0 upgraded, 1 newly installed, 0 to remove and 39 not upgraded.</span><br><span class="line">Need to get 13.7 MB of archives.</span><br><span class="line">After this operation, 97.0 MB of additional disk space will be used.</span><br><span class="line">Get:1 http://download.proxmox.com/debian/pve bookworm/pve-no-subscription amd64 proxmox-headers-6.8.4-2-pve amd64 6.8.4-2 [13.7 MB]</span><br><span class="line">Fetched 13.7 MB in 1s (23.8 MB/s)</span><br><span class="line">Selecting previously unselected package proxmox-headers-6.8.4-2-pve.</span><br><span class="line">(Reading database ... 70448 files and directories currently installed.)</span><br><span class="line">Preparing to unpack .../proxmox-headers-6.8.4-2-pve_6.8.4-2_amd64.deb ...</span><br><span class="line">Unpacking proxmox-headers-6.8.4-2-pve (6.8.4-2) ...</span><br><span class="line">Setting up proxmox-headers-6.8.4-2-pve (6.8.4-2) ...</span><br></pre></td></tr></table></figure>

<ul>
<li>Download <code>Linux i915 driver with SR-IOV</code> support for Linux kernel:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# git clone https://github.com/strongtz/i915-sriov-dkms</span><br></pre></td></tr></table></figure>

<p>and change into the cloned repository and run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~/i915-sriov-dkms# cat VERSION</span><br><span class="line">2024.07.24</span><br><span class="line"></span><br><span class="line">root@pve:~/i915-sriov-dkms# dkms add .</span><br><span class="line">Creating symlink /var/lib/dkms/i915-sriov-dkms/2024.07.24/source -&gt; /usr/src/i915-sriov-dkms-2024.07.24</span><br></pre></td></tr></table></figure>

<p>and build, install <code>i915-sriov-dkms</code> Linux kernel module:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~/i915-sriov-dkms# dkms install -m i915-sriov-dkms -v $(cat VERSION) --force</span><br><span class="line">Sign command: /lib/modules/6.8.4-2-pve/build/scripts/sign-file</span><br><span class="line">Signing key: /var/lib/dkms/mok.key</span><br><span class="line">Public certificate (MOK): /var/lib/dkms/mok.pub</span><br><span class="line">Certificate or key are missing, generating self signed certificate for MOK...</span><br><span class="line"></span><br><span class="line">Building module:</span><br><span class="line">Cleaning build area...</span><br><span class="line">make -j20 KERNELRELEASE=6.8.4-2-pve -C /lib/modules/6.8.4-2-pve/build M=/var/lib/dkms/i915-sriov-dkms/2024.07.24/build.......</span><br><span class="line">Signing module /var/lib/dkms/i915-sriov-dkms/2024.07.24/build/i915.ko</span><br><span class="line">Cleaning build area...</span><br><span class="line"></span><br><span class="line">i915.ko:</span><br><span class="line">Running module version sanity check.</span><br><span class="line"> - Original module</span><br><span class="line"> - Installation</span><br><span class="line">   - Installing to /lib/modules/6.8.4-2-pve/updates/dkms/</span><br><span class="line">depmod...</span><br></pre></td></tr></table></figure>

<p>and enable <code>i915-sriov-dkms</code> module with upto maximum <strong>7</strong> VFS (Virtual File System) in Linux kernel:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# cat /etc/default/grub | grep GRUB_CMDLINE_LINUX_DEFAULT</span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on i915.enable_guc=3 i915.max_vfs=7&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>Reboot Proxmox:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lspci | grep VGA</span><br><span class="line">00:02.0 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br><span class="line">00:02.1 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br><span class="line">00:02.2 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br><span class="line">00:02.3 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br><span class="line">00:02.4 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br><span class="line">00:02.5 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br><span class="line">00:02.6 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br><span class="line">00:02.7 VGA compatible controller: Intel Corporation Raptor Lake-S GT1 [UHD Graphics 770] (rev 04)</span><br></pre></td></tr></table></figure>

<p>First VGA <code>00:02.0</code> is the <strong>REAL</strong> GPU. Other <strong>7</strong> are <strong>Virtual</strong> ones.</p>
<p>Verify IOMMU has been enabled:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# dmesg | grep -i iommu</span><br><span class="line">[    0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-6.8.4-2-pve root=/dev/mapper/pve-root ro quiet intel_iommu=on i915.enable_guc=3 i915.max_vfs=7</span><br><span class="line">[    0.036486] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-6.8.4-2-pve root=/dev/mapper/pve-root ro quiet intel_iommu=on i915.enable_guc=3 i915.max_vfs=7</span><br><span class="line">[    0.036515] DMAR: IOMMU enabled</span><br><span class="line">[    0.090320] DMAR-IR: IOAPIC id 2 under DRHD base  0xfed91000 IOMMU 1</span><br><span class="line">[    0.244292] pci 0000:00:02.0: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    0.270125] iommu: Default domain type: Translated</span><br><span class="line">[    0.270125] iommu: DMA domain TLB invalidation policy: lazy mode</span><br><span class="line">[    0.303735] DMAR: IOMMU feature fl1gp_support inconsistent</span><br><span class="line">[    0.303735] DMAR: IOMMU feature pgsel_inv inconsistent</span><br><span class="line">[    0.303736] DMAR: IOMMU feature nwfs inconsistent</span><br><span class="line">[    0.303736] DMAR: IOMMU feature dit inconsistent</span><br><span class="line">[    0.303737] DMAR: IOMMU feature sc_support inconsistent</span><br><span class="line">[    0.303737] DMAR: IOMMU feature dev_iotlb_support inconsistent</span><br><span class="line">[    0.304175] pci 0000:00:02.0: Adding to iommu group 0</span><br><span class="line">[    0.304544] pci 0000:00:00.0: Adding to iommu group 1</span><br><span class="line">[    0.304554] pci 0000:00:01.0: Adding to iommu group 2</span><br><span class="line">[    0.304562] pci 0000:00:01.1: Adding to iommu group 3</span><br><span class="line">[    0.304570] pci 0000:00:06.0: Adding to iommu group 4</span><br><span class="line">[    0.304582] pci 0000:00:14.0: Adding to iommu group 5</span><br><span class="line">[    0.304589] pci 0000:00:14.2: Adding to iommu group 5</span><br><span class="line">[    0.304598] pci 0000:00:15.0: Adding to iommu group 6</span><br><span class="line">[    0.304607] pci 0000:00:16.0: Adding to iommu group 7</span><br><span class="line">[    0.304614] pci 0000:00:17.0: Adding to iommu group 8</span><br><span class="line">[    0.304630] pci 0000:00:1a.0: Adding to iommu group 9</span><br><span class="line">[    0.304641] pci 0000:00:1b.0: Adding to iommu group 10</span><br><span class="line">[    0.304651] pci 0000:00:1c.0: Adding to iommu group 11</span><br><span class="line">[    0.304662] pci 0000:00:1c.1: Adding to iommu group 12</span><br><span class="line">[    0.304671] pci 0000:00:1c.2: Adding to iommu group 13</span><br><span class="line">[    0.304681] pci 0000:00:1c.3: Adding to iommu group 14</span><br><span class="line">[    0.304692] pci 0000:00:1c.4: Adding to iommu group 15</span><br><span class="line">[    0.304703] pci 0000:00:1d.0: Adding to iommu group 16</span><br><span class="line">[    0.304721] pci 0000:00:1f.0: Adding to iommu group 17</span><br><span class="line">[    0.304728] pci 0000:00:1f.3: Adding to iommu group 17</span><br><span class="line">[    0.304735] pci 0000:00:1f.4: Adding to iommu group 17</span><br><span class="line">[    0.304742] pci 0000:00:1f.5: Adding to iommu group 17</span><br><span class="line">[    0.304750] pci 0000:01:00.0: Adding to iommu group 18</span><br><span class="line">[    0.304758] pci 0000:02:00.0: Adding to iommu group 19</span><br><span class="line">[    0.304765] pci 0000:03:00.0: Adding to iommu group 20</span><br><span class="line">[    0.304781] pci 0000:04:00.0: Adding to iommu group 21</span><br><span class="line">[    0.304791] pci 0000:05:00.0: Adding to iommu group 22</span><br><span class="line">[    0.304801] pci 0000:06:00.0: Adding to iommu group 23</span><br><span class="line">[    0.304810] pci 0000:07:00.0: Adding to iommu group 24</span><br><span class="line">[    0.304834] pci 0000:08:00.0: Adding to iommu group 25</span><br><span class="line">[    0.304845] pci 0000:09:00.0: Adding to iommu group 26</span><br><span class="line">[    0.304857] pci 0000:0a:00.0: Adding to iommu group 27</span><br><span class="line">[    0.304866] pci 0000:0b:00.0: Adding to iommu group 28</span><br><span class="line">[    4.659395] pci 0000:00:02.1: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    4.659438] pci 0000:00:02.1: Adding to iommu group 29</span><br><span class="line">[    4.664441] pci 0000:00:02.2: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    4.664479] pci 0000:00:02.2: Adding to iommu group 30</span><br><span class="line">[    4.667692] pci 0000:00:02.3: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    4.667727] pci 0000:00:02.3: Adding to iommu group 31</span><br><span class="line">[    4.671096] pci 0000:00:02.4: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    4.671129] pci 0000:00:02.4: Adding to iommu group 32</span><br><span class="line">[    4.673545] pci 0000:00:02.5: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    4.673572] pci 0000:00:02.5: Adding to iommu group 33</span><br><span class="line">[    4.676357] pci 0000:00:02.6: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    4.676402] pci 0000:00:02.6: Adding to iommu group 34</span><br><span class="line">[    4.679192] pci 0000:00:02.7: DMAR: Skip IOMMU disabling for graphics</span><br><span class="line">[    4.679221] pci 0000:00:02.7: Adding to iommu group 35</span><br></pre></td></tr></table></figure>

<ul>
<li>Enable Virtual GPU for <code>Windows 11</code> VM in Proxmox</li>
</ul>
<p>Add a PCI device for <code>Windows 11</code> VM, and choose one Virtual GPU:</p>
<p><img src="/blog/img/Proxmox%20-%20Windows%2011,%20PCI%20device.png" alt="Proxmox - Windows 11, PCI device" title="Proxmox - Windows 11, PCI device"></p>
<p>Enable <code>Primary GPU</code> and <code>PCI Express</code> in options:</p>
<p><img src="/blog/img/Proxmox%20-%20Windows%2011,%20Primary%20GPU%20and%20PCI%20Express.png" alt="Proxmox - Windows 11, Primary GPU and PCI Express" title="Proxmox - Windows 11, Primary GPU and PCI Express"></p>
<p>Choose <code>none</code> in Display and <code>host</code> in Processors options for <code>Windows 11</code> VM:</p>
<p><img src="/blog/img/Proxmox%20-%20Windows%2011,%20Display.png" alt="Proxmox - Windows 11, Display" title="Proxmox - Windows 11, Display"></p>
<p><img src="/blog/img/Proxmox%20-%20Windows%2011,%20Display%20none.png" alt="Proxmox - Windows 11, Display none" title="Proxmox - Windows 11, Display none"></p>
<p>Start <code>Windows 11</code> VM, login with <code>Microsoft Remote Desktop</code> <em><a target="_blank" rel="noopener" href="https://apps.microsoft.com/detail/9wzdncrfj3ps">https://apps.microsoft.com/detail/9wzdncrfj3ps</a></em> and a Virtual GPU is available now. Run <code>Task Manager</code> and check CPU and GPU load:</p>
<p><img src="/blog/img/Proxmox%20-%20Windows%2011,%20Performance.png" alt="Proxmox - Windows 11, Performance" title="Proxmox - Windows 11, Performance"></p>
<ul>
<li>Enable Virtual GPU for <code>Ubuntu</code> VM in Proxmox</li>
</ul>
<p>Ubuntu version 22.04.4 for desktop.</p>
<p>Add a PCI device for <code>Ubuntu</code> VM, and choose one Virtual GPU; Enable <code>Primary GPU</code> and <code>PCI Express</code> in options; Choose <code>none</code> in Display and <code>host</code> in Processors options:</p>
<p><img src="/blog/img/Proxmox%20-%20Ubuntu.png" alt="Proxmox - Ubuntu" title="Proxmox - Ubuntu"></p>
<p>Setup remote desktop connection to Ubuntu:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@nucleus:~# apt install ubuntu-desktop</span><br><span class="line"></span><br><span class="line">root@nucleus:~# apt install xrdp</span><br><span class="line"></span><br><span class="line">root@nucleus:~# systemctl enable xrdp</span><br></pre></td></tr></table></figure>

<p><img src="/blog/img/Proxmox%20-%20Remote%20Desktop.png" alt="Proxmox - Remote Desktop" title="Proxmox - Remote Desktop"></p>
<ul>
<li>Fix Remote Desktop audio over HDMI issue with the script, enable the sound redirection:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terrence@nucleus:~$ ./xrdp-installer-1.5.1.sh -s</span><br></pre></td></tr></table></figure>

<p>then reboot VM.</p>
<p><img src="/blog/img/Proxmox%20-%20Ubuntu%20Remote%20Desktop.png" alt="Proxmox - Ubuntu Remote Desktop" title="Proxmox - Ubuntu Remote Desktop"></p>
<p>Now Audio device becomes xrdp input &#x2F; output.</p>
<ul>
<li>Windows Server 2022</li>
</ul>
<p>Windows Server 2022 is similar to Windows 11 setup in Proxmox. A few issues like <strong>GPU</strong>:</p>
<p><img src="/blog/img/Proxmox%20-%20Windows%20Server%202022,%20GPU.png" alt="Proxmox - Windows Server 2022, GPU" title="Proxmox - Windows Server 2022, GPU"></p>
<p>just disable GPU then enable it, it will work correctly.</p>
<p>And no sound after installation, but can enable <strong>Windows Audio Service</strong> and choose <strong>Remote Audio</strong>:</p>
<p><img src="/blog/img/Proxmox%20-%20Windows%20Server%202022,%20Sound.png" alt="Proxmox - Windows Server 2022, Sound" title="Proxmox - Windows Server 2022, Sound"></p>
<p>then audio over HDMI to remote desktop can work.</p>
<p>In addition, can setup User Auto Logon after Windows Server 2022 startup. And check Windows license by running:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\Administrator&gt; slmgr -dlv</span><br></pre></td></tr></table></figure>

<p>Now can remote desktop access Ubuntu, Windows 11 and Windows Server 2022 VMs both run in Proxmox:</p>
<p><img src="/blog/img/Proxmox%20-%20Ubuntu%20and%20Windows.jpg" alt="Proxmox - Ubuntu and Windows" title="Proxmox - Ubuntu and Windows"></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>最新保姆级 PVE 8 安装教程！虚拟机 PCIE 设备及 SR-IOV 核显直通，最多分配7个虚拟化单独核显！最强虚拟机！<em><a target="_blank" rel="noopener" href="https://v2rayssr.com/pve.html">https://v2rayssr.com/pve.html</a></em></li>
<li>PVE 8.1 下部署 Intel 集显虚拟化驱动 <em><a target="_blank" rel="noopener" href="https://zoe.red/2023/38.html">https://zoe.red/2023/38.html</a></em></li>
<li>定制 OVMF 固件实现 PVE 8 环境 UEFI 模式直通 Intel 核显并显示 BIOS 适用于 intel 6-13 代处理器 PVE 8 核显直通画面 Windows 10 and MacOS 系统画面显示教程，可以外接显示器 <em><a target="_blank" rel="noopener" href="https://imacos.top/2023/10/09/152/">https://imacos.top/2023/10/09/152/</a></em></li>
<li>PVE 下如何启用 PCI 直通显卡 GPU&#x2F;iGPU&#x2F;USB&#x2F;声卡 AUDIO 等硬件直通教程 <em><a target="_blank" rel="noopener" href="https://imacos.top/2023/07/31/pci/">https://imacos.top/2023/07/31/pci/</a></em></li>
<li>Enable &amp; Using vGPU Passthrough <em><a target="_blank" rel="noopener" href="https://gist.github.com/scyto/e4e3de35ee23fdb4ae5d5a3b85c16ed3">https://gist.github.com/scyto/e4e3de35ee23fdb4ae5d5a3b85c16ed3</a></em></li>
<li>Proxmox VE: Passthrough with Intel Integrated Graphics Card Alder Lake Architecture | vGPU, VT-d, SR-IOV <em><a target="_blank" rel="noopener" href="https://github.com/kamilllooo/Proxmox">https://github.com/kamilllooo/Proxmox</a></em></li>
<li>Remote Desktop connection from Mac to Ubuntu <em><a target="_blank" rel="noopener" href="https://askubuntu.com/questions/893831/remote-desktop-connection-from-mac-to-ubuntu">https://askubuntu.com/questions/893831/remote-desktop-connection-from-mac-to-ubuntu</a></em></li>
<li>xRDP – Easy install xRDP on Ubuntu 20.04,22.04,23.XX,24.04 (Script Version 1.5.1) <em><a target="_blank" rel="noopener" href="https://c-nergy.be/blog/?p=19814">https://c-nergy.be/blog/?p=19814</a></em></li>
<li>Autologon User at Startup in Windows Server <em><a target="_blank" rel="noopener" href="https://jc-lan.org/2022/06/02/autologon-user-at-startup-in-windows-server/">https://jc-lan.org/2022/06/02/autologon-user-at-startup-in-windows-server/</a></em></li>
<li>Windows Server 2022 audio available but not playing <em><a target="_blank" rel="noopener" href="https://answers.microsoft.com/en-us/windowserver/forum/all/windows-server-2022-audio-available-but-not/eca821f1-7b4a-4293-8273-fda49dd0e9d4">https://answers.microsoft.com/en-us/windowserver/forum/all/windows-server-2022-audio-available-but-not/eca821f1-7b4a-4293-8273-fda49dd0e9d4</a></em></li>
</ul>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-The-solution-making-old-Intel-10Gbps-network-adapter-work-in-Windows-11" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/05/20/The-solution-making-old-Intel-10Gbps-network-adapter-work-in-Windows-11/">The solution making old Intel 10Gbps network adapter work in Windows 11</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-05-20T12:27:09.000Z" itemprop="datePublished">2024-05-20</time>
</span>
      
      
      
<a href="/blog/2024/05/20/The-solution-making-old-Intel-10Gbps-network-adapter-work-in-Windows-11/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Buy some old Intel 10Gbps network adapter, <code>X520</code>, <code>X540</code> … from AliExpress <em><a target="_blank" rel="noopener" href="https://aliexpress.com/">https://aliexpress.com/</a></em>, and install old Intel network adapter driver for Windows 10 and make it working in Windows 11. The example is install version 25.0 Intel network adapter driver, <em><a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/download/18293/29648/intel-network-adapter-driver-for-windows-10.html">https://www.intel.com/content/www/us/en/download/18293/29648/intel-network-adapter-driver-for-windows-10.html</a></em>, to get it to work in Windows 11:</p>
<ul>
<li><p>Intel network adapters supported Operating Systems, <em><a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/support/articles/000025890/ethernet-products.html">https://www.intel.com/content/www/us/en/support/articles/000025890/ethernet-products.html</a></em></p>
</li>
<li><p>Buy dual ports 10Gbps network adapter</p>
</li>
<li><p>Install the network adapter in PCIE slot directly to the CPU</p>
</li>
<li><p>Enable SMB Multichannel</p>
</li>
<li><p>Enable Jumbo Frames</p>
</li>
</ul>
<iframe width="560" height="315" src="https://www.youtube.com/embed/WDPblqez00s?si=fs4-wswGT5AzDWMK&amp;start=222" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>



    <nav id="page-nav">

<span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><a class="page-number" href="/blog/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/11/">11</a><a class="extend next" rel="next" href="/blog/page/2/">Next</a>
</nav>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-posts"></i> Recent</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2024/09/14/How-to-enable-SMB-Direct-client-server-in-Windows-11-Pro-for-Workstations/">How to enable SMB Direct client/server in Windows 11 Pro for Workstations</a>
          </li>
        
          <li>
            <a href="/blog/2024/09/14/Fixing-TrueNAS-SMB-IP-binding/">Fixing TrueNAS SMB IP binding</a>
          </li>
        
          <li>
            <a href="/blog/2024/09/08/Running-MacOS-on-Proxmox/">Running MacOS on Proxmox</a>
          </li>
        
          <li>
            <a href="/blog/2024/09/02/Setup-MikroTik-CRS504-4XQ-IN-and-run-a-speed-test/">Setup MikroTik CRS504-4XQ-IN and run a speed test</a>
          </li>
        
          <li>
            <a href="/blog/2024/08/11/Setup-network-bond-in-Synology-NAS/">Setup network bond in Synology NAS</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-archive"></i> Archive</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2024/">2024</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/">2023</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/">2022</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/">2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/">2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/">2019</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/">2018</a><span class="archive-list-count">31</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/">2017</a><span class="archive-list-count">25</span></li></ul>
    </div>
  </div>


  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-link"></i> Blogroll</h3>
    <div class="widget">
      <ul>
      
        <li>
          <a target="_blank" rel="noopener" href="https://www.linkedin.com/in/terrencemiao/">LinkedIn</a>
        </li>
      
        <li>
          <a target="_blank" rel="noopener" href="https://github.com/TerrenceMiao">GitHub</a>
        </li>
      
        <li>
          <a target="_blank" rel="noopener" href="https://twitter.com/TerrenceMiao">Twitter</a>
        </li>
      
      </ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <a id="totop" href="#top"></a>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <p>
        <a href="/blog/sitemap.xml">Site Map</a>
        <span> | </span><a href="/blog/atom.xml">Subscribe to this site</a>
        <span> | </span><a href="/blog/about/">Contact the blogger</a>
      </p>
      
        <p>
          <i class="fa fa-visitors"></i>
          <i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>
          ，
          <i class="fa fa-views"></i>
          <i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>
        </p>
      
      <p>
        <span>Copyright &copy; 2024 Terrence Miao.</span>
        <span>Theme by <a href="https://github.com/chaooo/hexo-theme-BlueLake/" target="_blank">BlueLake.</a></span>
        <span>Powered by <a href="https://hexo.io/" target="_blank">Hexo.</a></span>
      </p>
    </div>
  </div>
</footer>

    </div>
  </div>
  
<script src="/blog/js/jquery-3.4.1.min.js"></script>


<script src="/blog/js/search.json.js"></script>


  
<script src="/blog/fancybox/jquery.fancybox.min.js"></script>




<script src="/blog/js/script.js"></script>






  
<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>








  



  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>
  <script src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML" async type="text/javascript"></script>

</body>
</html>