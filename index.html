<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=330279473"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '330279473');
</script>
<!-- End Google Analytics -->

  
  <title>Terrence Miao&#39;s Adventures</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
    <meta name="description" content="Veni, vidi, vici">
  
  
  
    <link rel="alternate" href="/blog/atom.xml" title="Terrence Miao's Adventures" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/blog/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/blog/css/style.css">

  
    
<link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.min.css">

  
  
  
  
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7274218747178099" crossorigin="anonymous"></script>
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">Terrence Miao&#39;s Adventures</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/blog/" id="subtitle">A journey of a thousand miles begins with a single step</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/blog/."><i class="fa fa-home"></i> Home</a>
        
          <a class="main-nav-link" href="/blog/archives/"><i class="fa fa-archive"></i> Archive</a>
        
          <a class="main-nav-link" href="/blog/about/"><i class="fa fa-user"></i> About</a>
        
          <a class="main-nav-link" href="/blog/atom.xml"><i class="fa fa-rss"></i> RSS</a>
        
      </nav>
    </div>
    <div id="search-form">
      <div id="result-mask" class="hide"></div>
      <label><input id="search-key" type="text" autocomplete="off" placeholder="search"></label>
      <div id="result-wrap" class="hide">
        <div id="search-result"></div>
      </div>
      <div class="hide">
        <template id="search-tpl">
          <div class="item">
            <a href="/{path}" title="{title}">
              <div class="title">{title}</div>
              <div class="time">{date}</div>
              <div class="tags">{tags}</div>
            </a>
          </div>
        </template>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  <article id="post-Proxmox-VE-Helper-Scripts" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/09/27/Proxmox-VE-Helper-Scripts/">Proxmox VE Helper Scripts</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-09-27T12:58:54.000Z" itemprop="datePublished">2024-09-27</time>
</span>
      
      
      
<a href="/blog/2024/09/27/Proxmox-VE-Helper-Scripts/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Run <code>Proxmox VE Post Install</code> script:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bash -c &quot;$(wget -qLO - https://github.com/tteck/Proxmox/raw/main/misc/post-pve-install.sh)&quot;</span><br></pre></td></tr></table></figure>

<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>Proxmox VE Helper-Scripts, <em><a target="_blank" rel="noopener" href="https://tteck.github.io/Proxmox">https://tteck.github.io/Proxmox</a></em></li>
<li>Virtualizing OPNsense on Proxmox as Your Primary Router, <em><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=VcTGKBHcqmk">https://www.youtube.com/watch?v=VcTGKBHcqmk</a></em></li>
</ul>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Running-a-Mac-app-from-Unidentified-Developer-on-MacOS-Sequoia" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/09/19/Running-a-Mac-app-from-Unidentified-Developer-on-MacOS-Sequoia/">Running a Mac app from Unidentified Developer on MacOS Sequoia</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-09-19T00:16:23.000Z" itemprop="datePublished">2024-09-19</time>
</span>
      
      
      
<a href="/blog/2024/09/19/Running-a-Mac-app-from-Unidentified-Developer-on-MacOS-Sequoia/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Latest <code>MacOS Sequoia</code> has made another security enforcement. To open and run a Mac application, e.g. <code>VLC</code> nightly build at <em><a target="_blank" rel="noopener" href="https://nightlies.videolan.org/">https://nightlies.videolan.org/</a></em>, <strong>Unidentified Developer</strong> , the following steps can take.</p>
<ul>
<li>Enable “Allow Applications from Anywhere”</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">base ~</span><br><span class="line">sudo spctl --master-disable</span><br><span class="line">Password:</span><br><span class="line">Globally disabling the assessment system needs to be confirmed in System Settings.</span><br></pre></td></tr></table></figure>

<p>Go to <strong>System Settings</strong> -&gt; <strong>Privacy &amp; Security</strong>, select “Allow Applications from Anywhere”:</p>
<p><img src="/blog/img/MacOS%20-%20Allow%20Applications%20from%20Anywhere.png" alt="MacOS - Allow Applications from Anywhere" title="MacOS - Allow Applications from Anywhere"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">base ~</span><br><span class="line">sudo spctl --master-enable</span><br><span class="line">Password:</span><br><span class="line">This operation is no longer supported. Please see the man page for more information.</span><br></pre></td></tr></table></figure>

<ul>
<li>Disable MacOS Quarantine on the application</li>
</ul>
<p>In this case application <code>VLC</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">base ~</span><br><span class="line">xattr -dr com.apple.quarantine /Applications/VLC.app</span><br></pre></td></tr></table></figure>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Configure-and-setup-Mellanox-network-adapter" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/09/17/Configure-and-setup-Mellanox-network-adapter/">Configure and setup Mellanox network adapter</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-09-17T01:42:01.000Z" itemprop="datePublished">2024-09-17</time>
</span>
      
      
      
<a href="/blog/2024/09/17/Configure-and-setup-Mellanox-network-adapter/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>A <em>Mellanox ConnectX-4 MCX455A-ECAT PCIe x16 3.0 100GBe VPI EDR IB</em> network adapter. Enable <code>VT-d</code>(Intel Virtualization Technology for Directed I&#x2F;O), <code>SR-IOV</code> (Single Root IO Virtualization), and the number of Virtual Functions in Chipset and Network in BIOS.</p>
<h2 id="Configuration-and-Setup"><a href="#Configuration-and-Setup" class="headerlink" title="Configuration and Setup"></a>Configuration and Setup</h2><p>Go to NVIDIA Firmware Tools (MFT) <em><a target="_blank" rel="noopener" href="https://network.nvidia.com/products/adapter-software/firmware-tools/">https://network.nvidia.com/products/adapter-software/firmware-tools/</a></em> and download the <code>MFT</code>; go to Updating Firmware for ConnectX®-4 VPI PCI Express Adapter Cards (InfiniBand, Ethernet, VPI) <em><a target="_blank" rel="noopener" href="https://network.nvidia.com/support/firmware/connectx4ib/">https://network.nvidia.com/support/firmware/connectx4ib/</a></em> and download the updated firmware e.g. <code>mft-4.26.1-6-x86_64-deb.tgz</code>.</p>
<p>After installation, start up <strong>Mellanox Software Tools</strong> service:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# mst start</span><br><span class="line">Starting MST (Mellanox Software Tools) driver set</span><br><span class="line">Loading MST PCI module - Success</span><br><span class="line">Loading MST PCI configuration module - Success</span><br><span class="line">Create devices</span><br><span class="line">Unloading MST PCI module (unused) - Success</span><br></pre></td></tr></table></figure>

<p>Check status:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# mst status</span><br><span class="line">MST modules:</span><br><span class="line">------------</span><br><span class="line">    MST PCI module is not loaded</span><br><span class="line">    MST PCI configuration module loaded</span><br><span class="line"></span><br><span class="line">MST devices:</span><br><span class="line">------------</span><br><span class="line">/dev/mst/mt4115_pciconf0         - PCI configuration cycles access.</span><br><span class="line">                                   domain:bus:dev.fn=0000:06:00.0 addr.reg=88 data.reg=92 cr_bar.gw_offset=-1</span><br><span class="line">                                   Chip revision is: 00</span><br></pre></td></tr></table></figure>

<p>Query Mellanox network adapter:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# flint -d /dev/mst/mt4115_pciconf0 query</span><br><span class="line">Image type:            FS3</span><br><span class="line">FW Version:            12.28.2006</span><br><span class="line">FW Release Date:       15.9.2020</span><br><span class="line">Product Version:       12.28.2006</span><br><span class="line">Rom Info:              type=UEFI version=14.21.17 cpu=AMD64</span><br><span class="line">                       type=PXE version=3.6.102 cpu=AMD64</span><br><span class="line">Description:           UID                GuidsNumber</span><br><span class="line">Base GUID:             ec0d9a030076eae2        4</span><br><span class="line">Base MAC:              ec0d9a76eae2            4</span><br><span class="line">Image VSD:             N/A</span><br><span class="line">Device VSD:            N/A</span><br><span class="line">PSID:                  LNV2180110032</span><br><span class="line">Security Attributes:   N/A</span><br></pre></td></tr></table></figure>

<p>Check Mellanox network adapter configuration:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# mlxconfig -d /dev/mst/mt4115_pciconf0 query</span><br><span class="line">Device #1:</span><br><span class="line">----------</span><br><span class="line"></span><br><span class="line">Device type:        ConnectX4</span><br><span class="line">Name:               00KH925_Ax</span><br><span class="line">Description:        Mellanox ConnectX-4 EDR IB VPI Single-port x16 PCIe 3.0 HCA</span><br><span class="line">Device:             /dev/mst/mt4115_pciconf0</span><br><span class="line"></span><br><span class="line">Configurations:</span><br><span class="line">        LINK_TYPE_P1                                ETH(2)</span><br><span class="line">        SRIOV_EN                                    True(1)</span><br><span class="line">        NUM_OF_VFS                                  8</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Verify network adapter configuration:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">terrence@pve:~# ethtool enp1s0np0</span><br><span class="line">Settings for enp1s0np0:</span><br><span class="line">	Supported ports: [ Backplane ]</span><br><span class="line">	Supported link modes:   1000baseKX/Full</span><br><span class="line">	                        10000baseKR/Full</span><br><span class="line">	                        40000baseKR4/Full</span><br><span class="line">	                        40000baseCR4/Full</span><br><span class="line">	                        40000baseSR4/Full</span><br><span class="line">	                        40000baseLR4/Full</span><br><span class="line">	                        56000baseKR4/Full</span><br><span class="line">	                        25000baseCR/Full</span><br><span class="line">	                        25000baseKR/Full</span><br><span class="line">	                        25000baseSR/Full</span><br><span class="line">	                        50000baseCR2/Full</span><br><span class="line">	                        50000baseKR2/Full</span><br><span class="line">	                        100000baseKR4/Full</span><br><span class="line">	                        100000baseSR4/Full</span><br><span class="line">	                        100000baseCR4/Full</span><br><span class="line">	                        100000baseLR4_ER4/Full</span><br><span class="line">	Supported pause frame use: Symmetric</span><br><span class="line">	Supports auto-negotiation: Yes</span><br><span class="line">	Supported FEC modes: None	 RS	 BASER</span><br><span class="line">	Advertised link modes:  1000baseKX/Full</span><br><span class="line">	                        10000baseKR/Full</span><br><span class="line">	                        40000baseKR4/Full</span><br><span class="line">	                        40000baseCR4/Full</span><br><span class="line">	                        40000baseSR4/Full</span><br><span class="line">	                        40000baseLR4/Full</span><br><span class="line">	                        56000baseKR4/Full</span><br><span class="line">	                        25000baseCR/Full</span><br><span class="line">	                        25000baseKR/Full</span><br><span class="line">	                        25000baseSR/Full</span><br><span class="line">	                        50000baseCR2/Full</span><br><span class="line">	                        50000baseKR2/Full</span><br><span class="line">	                        100000baseKR4/Full</span><br><span class="line">	                        100000baseSR4/Full</span><br><span class="line">	                        100000baseCR4/Full</span><br><span class="line">	                        100000baseLR4_ER4/Full</span><br><span class="line">	Advertised pause frame use: Symmetric</span><br><span class="line">	Advertised auto-negotiation: Yes</span><br><span class="line">	Advertised FEC modes: RS</span><br><span class="line">	Speed: 100000Mb/s</span><br><span class="line">	Duplex: Full</span><br><span class="line">	Auto-negotiation: on</span><br><span class="line">	Port: Direct Attach Copper</span><br><span class="line">	PHYAD: 0</span><br><span class="line">	Transceiver: internal</span><br><span class="line">	Link detected: yes</span><br></pre></td></tr></table></figure>

<h2 id="Virtualization"><a href="#Virtualization" class="headerlink" title="Virtualization"></a>Virtualization</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lspci | grep Mellanox</span><br><span class="line">06:00.0 Ethernet controller: Mellanox Technologies MT27700 Family [ConnectX-4]</span><br><span class="line"></span><br><span class="line">root@pve:~# ip link show</span><br><span class="line">...</span><br><span class="line">4: enp1s0np0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq master vmbr2 state UP mode DEFAULT group default qlen 1000</span><br><span class="line">    link/ether ec:0d:9a:76:eb:2a brd ff:ff:ff:ff:ff:ff</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Write to the sysfs file the number of Virtual Functions:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# echo 8 &gt; /sys/class/infiniband/mlx5_0/device/sriov_numvfs</span><br></pre></td></tr></table></figure>

<p>Verify that the Virtual Functions were created:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# lspci | grep Mellanox</span><br><span class="line">01:00.0 Ethernet controller: Mellanox Technologies MT27700 Family [ConnectX-4]</span><br><span class="line">01:00.1 Ethernet controller: Mellanox Technologies MT27700 Family [ConnectX-4 Virtual Function]</span><br><span class="line">01:00.2 Ethernet controller: Mellanox Technologies MT27700 Family [ConnectX-4 Virtual Function]</span><br><span class="line">01:00.3 Ethernet controller: Mellanox Technologies MT27700 Family [ConnectX-4 Virtual Function]</span><br><span class="line">01:00.4 Ethernet controller: Mellanox Technologies MT27700 Family [ConnectX-4 Virtual Function]</span><br><span class="line">01:00.5 Ethernet controller: Mellanox Technologies MT27700 Family [ConnectX-4 Virtual Function]</span><br><span class="line">01:00.6 Ethernet controller: Mellanox Technologies MT27700 Family [ConnectX-4 Virtual Function]</span><br><span class="line">01:00.7 Ethernet controller: Mellanox Technologies MT27700 Family [ConnectX-4 Virtual Function]</span><br><span class="line">01:01.0 Ethernet controller: Mellanox Technologies MT27700 Family [ConnectX-4 Virtual Function]</span><br><span class="line"></span><br><span class="line">root@pve:~# ip link show</span><br><span class="line">...</span><br><span class="line">4: enp1s0np0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq master vmbr2 state UP mode DEFAULT group default qlen 1000</span><br><span class="line">    link/ether ec:0d:9a:76:eb:2a brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    vf 0     link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff, spoof checking off, link-state auto, trust off, query_rss off</span><br><span class="line">    vf 1     link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff, spoof checking off, link-state auto, trust off, query_rss off</span><br><span class="line">    vf 2     link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff, spoof checking off, link-state auto, trust off, query_rss off</span><br><span class="line">    vf 3     link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff, spoof checking off, link-state auto, trust off, query_rss off</span><br><span class="line">    vf 4     link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff, spoof checking off, link-state auto, trust off, query_rss off</span><br><span class="line">    vf 5     link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff, spoof checking off, link-state auto, trust off, query_rss off</span><br><span class="line">    vf 6     link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff, spoof checking off, link-state auto, trust off, query_rss off</span><br><span class="line">    vf 7     link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff, spoof checking off, link-state auto, trust off, query_rss off</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="Persistence"><a href="#Persistence" class="headerlink" title="Persistence"></a>Persistence</h2><p>Print out device information:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# udevadm info /sys/class/infiniband/mlx5_0</span><br><span class="line">P: /devices/pci0000:00/0000:00:01.0/0000:01:00.0/infiniband/mlx5_0</span><br><span class="line">M: mlx5_0</span><br><span class="line">R: 0</span><br><span class="line">U: infiniband</span><br><span class="line">E: DEVPATH=/devices/pci0000:00/0000:00:01.0/0000:01:00.0/infiniband/mlx5_0</span><br><span class="line">E: SUBSYSTEM=infiniband</span><br><span class="line">E: NAME=mlx5_0</span><br></pre></td></tr></table></figure>

<p>Make the network adapter Virtual Functions persistent after reboot:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# cat /etc/udev/rules.d/mlx.rules</span><br><span class="line">ACTION==&quot;add&quot;, SUBSYSTEM==&quot;infiniband&quot;, ENV&#123;NAME&#125;==&quot;mlx5_0&quot;, ATTR&#123;device/sriov_numvfs&#125;=&quot;8&quot;</span><br></pre></td></tr></table></figure>

<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>Mellanox ConnectX-4 100Gb NIC Firmware Update and Ethernet Mode, <em><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=D1qN7Qg3bSg">https://www.youtube.com/watch?v=D1qN7Qg3bSg</a></em></li>
<li>Single Root IO Virtualization (SR-IOV), <em><a target="_blank" rel="noopener" href="https://docs.nvidia.com/networking/display/mlnxofedv53100143/single+root+io+virtualization+(sr-iov)">https://docs.nvidia.com/networking/display/mlnxofedv53100143/single+root+io+virtualization+(sr-iov)</a></em></li>
<li>Persisting SR-IOV virtual functions after reboot, <em><a target="_blank" rel="noopener" href="https://www.reddit.com/r/homelab/comments/hf12mv/persisting_sriov_virtual_functions_after_reboot/">https://www.reddit.com/r/homelab/comments/hf12mv/persisting_sriov_virtual_functions_after_reboot/</a></em></li>
<li>PCI Device Assignment with SR-IOV Devices, <em><a target="_blank" rel="noopener" href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/7/html/virtualization_deployment_and_administration_guide/sect-pci_devices-pci_passthrough">https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/7/html/virtualization_deployment_and_administration_guide/sect-pci_devices-pci_passthrough</a></em></li>
<li>100 Gbe &amp; TrueNAS Scale 23.10 iSCSI - Performance Unleashed, <em><a target="_blank" rel="noopener" href="https://forum.level1techs.com/t/100-gbe-truenas-scale-23-10-iscsi-performance-unleashed/206452">https://forum.level1techs.com/t/100-gbe-truenas-scale-23-10-iscsi-performance-unleashed/206452</a></em></li>
</ul>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Create-Storage-Pool-in-Windows-Server-2022" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/09/15/Create-Storage-Pool-in-Windows-Server-2022/">Create Storage Pool in Windows Server 2022</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-09-15T11:39:18.000Z" itemprop="datePublished">2024-09-15</time>
</span>
      
      
      
<a href="/blog/2024/09/15/Create-Storage-Pool-in-Windows-Server-2022/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><img src="/blog/img/Storage%20Pool%20-%20Create.png" alt="Storage Pool - Create" title="Storage Pool - Create"></p>
<p><img src="/blog/img/Storage%20Pool%20-%20Physical%20Disks.png" alt="Storage Pool - Physical Disks" title="Storage Pool - Physical Disks"></p>
<p><img src="/blog/img/Storage%20Pool%20-%20Storage%20Layout.png" alt="Storage Pool - Storage Layout" title="Storage Pool - Storage Layout"></p>
<p><img src="/blog/img/Storage%20Pool%20-%20Virtual%20Disk.png" alt="Storage Pool - Virtual Disk" title="Storage Pool - Virtual Disk"></p>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Fix-network-object-name-already-existed-issue-in-Windows" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/09/15/Fix-network-object-name-already-existed-issue-in-Windows/">Fix network object name already existed issue in Windows</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-09-15T11:18:03.000Z" itemprop="datePublished">2024-09-15</time>
</span>
      
      
      
<a href="/blog/2024/09/15/Fix-network-object-name-already-existed-issue-in-Windows/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>When rename a network adapter in <code>Windows</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Rename-NetAdapter -Name Ethernet -NewName Mellanox</span><br></pre></td></tr></table></figure>

<p>an error <strong>Rename-NetAdapter : {Object Exists} An attempt was made to create an object and the object name already existed</strong> thrown.</p>
<p>Work around solution is:</p>
<ol>
<li>Open <strong>Device Manager</strong> in Windows Control Panel</li>
<li>Under menu <strong>View</strong> enable <strong>Show hidden devices</strong></li>
<li>Uninstall the old network adapter with the old name</li>
<li>Then rename the network adapter again</li>
</ol>
<p><img src="/blog/img/Rename%20Network%20in%20Windows.png" alt="Rename Network in Windows" title="Rename Network in Windows"></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>Registry mismatch Get-NetAdapter, <em><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/42220423/registry-mismatch-get-netadapter">https://stackoverflow.com/questions/42220423/registry-mismatch-get-netadapter</a></em></li>
</ul>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-How-to-enable-SMB-Direct-client-server-in-Windows-11-Pro-for-Workstations" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/09/14/How-to-enable-SMB-Direct-client-server-in-Windows-11-Pro-for-Workstations/">How to enable SMB Direct client/server in Windows 11 Pro for Workstations</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-09-14T07:52:08.000Z" itemprop="datePublished">2024-09-14</time>
</span>
      
      
      
<a href="/blog/2024/09/14/How-to-enable-SMB-Direct-client-server-in-Windows-11-Pro-for-Workstations/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>In <code>Windows 11 Pro Station</code>, a <em>Mellanox ConnectX-4 MCX455A-ECAT PCIe x16 3.0 100GBe VPI EDR IB network adatper</em>, goes to support <strong>SMB Direct</strong>, client and server side <strong>SMB Multichannel</strong> and <strong>RDMA</strong> (Remote Direct Memory Access):</p>
<p><img src="/blog/img/Windows%2011%20Pro%20for%20Workstations.png" alt="Windows 11 Pro for Workstations" title="Windows 11 Pro for Workstations"></p>
<p>Open Windows Terminal as Administrator.</p>
<p>Enable SMB Direct:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Enable-WindowsOptionalFeature -Online -FeatureName SMBDirect</span><br><span class="line">Path          :</span><br><span class="line">Online        : True</span><br><span class="line">RestartNeeded : False</span><br></pre></td></tr></table></figure>

<p>Enable SMB Multichannel on the client-side:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Set-SmbClientConfiguration -EnableMultiChannel $true</span><br><span class="line">Confirm</span><br><span class="line">Are you sure you want to perform this action?</span><br><span class="line">Performing operation &#x27;Modify&#x27; on Target &#x27;SMB Client Configuration&#x27;.</span><br><span class="line">[Y] Yes  [A] Yes to All  [N] No  [L] No to All  [S] Suspend  [?] Help (default is &quot;Y&quot;):</span><br><span class="line"></span><br><span class="line">PS C:\&gt; Get-SmbClientConfiguration</span><br><span class="line">...</span><br><span class="line">EnableMultiChannel                    : True</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Enable SMB Multichannel on the server-side:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Set-SmbServerConfiguration -EnableMultiChannel $true</span><br><span class="line">Confirm</span><br><span class="line">Are you sure you want to perform this action?</span><br><span class="line">Performing operation &#x27;Modify&#x27; on Target &#x27;SMB Server Configuration&#x27;.</span><br><span class="line">[Y] Yes  [A] Yes to All  [N] No  [L] No to All  [S] Suspend  [?] Help (default is &quot;Y&quot;):</span><br><span class="line"></span><br><span class="line">PS C:\&gt; Get-SmbServerConfiguration</span><br><span class="line">...</span><br><span class="line">EnableMultiChannel                     : True</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Enable RDMA for a specific interface:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Enable-NetAdapterRDMA Mellanox</span><br></pre></td></tr></table></figure>

<p>Verify which state of operability SMB Direct is currently configured to:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Get-WindowsOptionalFeature -Online -FeatureName SMBDirect</span><br><span class="line">FeatureName      : SmbDirect</span><br><span class="line">DisplayName      : SMB Direct</span><br><span class="line">Description      : Remote Direct Memory Access (RDMA) support for the SMB 3.x file sharing protocol</span><br><span class="line">RestartRequired  : Possible</span><br><span class="line">State            : Enabled</span><br><span class="line">CustomProperties :</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Get-SmbClientNetworkInterface</span><br><span class="line">Interface Index RSS Capable RDMA Capable Speed       IpAddresses                                 Friendly Name</span><br><span class="line">--------------- ----------- ------------ -----       -----------                                 -------------</span><br><span class="line">22              True        True         100 Gbps    &#123;fe80::708:c529:1bcb:2432, 192.168.68.67&#125;   Mellanox</span><br><span class="line"></span><br><span class="line">PS C:\&gt; Get-SmbServerNetworkInterface</span><br><span class="line">Scope Name Interface Index RSS Capable RDMA Capable Speed    IpAddress</span><br><span class="line">---------- --------------- ----------- ------------ -----    ---------</span><br><span class="line">*          22              True        True         100 Gbps fe80::708:c529:1bcb:2432</span><br><span class="line">*          22              True        True         100 Gbps 192.168.68.67</span><br></pre></td></tr></table></figure>

<p>Have a look <code>TrueNAS</code> disk speed benchmark, over a 100Gbps ethernet network, from <code>Windows 11 Pro for Workstations</code> with <strong>SMB Direct</strong>, client&#x2F;server <strong>SMB Multichannel</strong> and <strong>RDMA</strong> enabled:</p>
<p><img src="/blog/img/TrueNAS%20disk%20speed%20benchmark.png" alt="TrueNAS disk speed benchmark" title="TrueNAS disk speed benchmark"></p>
<p>In <code>Windows Server 2022</code>, with SMB shared folder in <strong>Storage Spaces</strong>:</p>
<p><img src="/blog/img/Windows%20Server%202022.png" alt="Windows Server 2022" title="Windows Server 2022"></p>
<p>Run Windows Powershell as <strong>Administrator</strong> user , which <strong>RDMA Capable</strong> are all True for both SMB client&#x2F;server:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Windows PowerShell</span><br><span class="line">Copyright (C) Microsoft Corporation. All rights reserved.</span><br><span class="line">Install the latest PowerShell for new features and improvements! https://aka.ms/PSWindows</span><br><span class="line"></span><br><span class="line">PS C:\Users\Administrator&gt; Get-SmbServerNetworkInterface</span><br><span class="line">Scope Name Interface Index RSS Capable RDMA Capable Speed    IpAddress</span><br><span class="line">---------- --------------- ----------- ------------ -----    ---------</span><br><span class="line">*          5               True        True         100 Gbps fe80::9ee0:7f4c:5128:863b</span><br><span class="line">*          5               True        True         100 Gbps 192.168.68.66</span><br><span class="line"></span><br><span class="line">PS C:\Users\Administrator&gt; Get-SmbClientNetworkInterface</span><br><span class="line">Interface Index RSS Capable RDMA Capable Speed    IpAddresses                                Friendly Name</span><br><span class="line">--------------- ----------- ------------ -----    -----------                                -------------</span><br><span class="line">5               True        True         100 Gbps &#123;fe80::9ee0:7f4c:5128:863b, 192.168.68.66&#125; Mellanox</span><br></pre></td></tr></table></figure>

<p>Have a look <code>Windows Server 2022</code> disk speed benchmark, over a 100Gbps ethernet network, from <code>Windows 11 Pro for Workstations</code> with <strong>SMB Direct</strong>, client&#x2F;server <strong>SMB Multichannel</strong> and <strong>RDMA</strong> enabled:</p>
<p><img src="/blog/img/Windows%20Server%202022%20disk%20speed%20benchmark.png" alt="Windows Server 2022 disk speed benchmark" title="Windows Server 2022 disk speed benchmark"></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>SMB Direct, <em><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows-server/storage/file-server/smb-direct">https://learn.microsoft.com/en-us/windows-server/storage/file-server/smb-direct</a></em></li>
<li>100 Gbe &amp; TrueNAS Scale 23.10 iSCSI - Performance Unleashed, <em><a target="_blank" rel="noopener" href="https://forum.level1techs.com/t/100-gbe-truenas-scale-23-10-iscsi-performance-unleashed/206452">https://forum.level1techs.com/t/100-gbe-truenas-scale-23-10-iscsi-performance-unleashed/206452</a></em></li>
</ul>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Fixing-TrueNAS-SMB-IP-binding" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/09/14/Fixing-TrueNAS-SMB-IP-binding/">Fixing TrueNAS SMB IP binding</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-09-14T02:37:53.000Z" itemprop="datePublished">2024-09-14</time>
</span>
      
      
      
<a href="/blog/2024/09/14/Fixing-TrueNAS-SMB-IP-binding/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>After changing network settings, <code>TrueNAS</code> IP address has been updated. If modify SMB configuration, error like:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smb_update.bindip.0: IP address [192.168.0.51] is not a configured address for this server</span><br></pre></td></tr></table></figure>

<p>thrown.</p>
<p>To reset and clean up already bind IP, login TrueNAS Console and run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">root@TrueNAS[~]# midclt call smb.update &#x27;&#123;&quot;bindip&quot;: []&#125;&#x27;</span><br><span class="line">&#123;</span><br><span class="line">    &quot;id&quot;: 1,</span><br><span class="line">    &quot;netbiosname&quot;: &quot;TRUENAS&quot;,</span><br><span class="line">    &quot;netbiosalias&quot;: [],</span><br><span class="line">    &quot;workgroup&quot;: &quot;IGLOO STUDIO&quot;,</span><br><span class="line">    &quot;description&quot;: &quot;TrueNAS Server&quot;,</span><br><span class="line">    &quot;unixcharset&quot;: &quot;UTF-8&quot;,</span><br><span class="line">    &quot;loglevel&quot;: &quot;MINIMUM&quot;,</span><br><span class="line">    &quot;syslog&quot;: false,</span><br><span class="line">    &quot;aapl_extensions&quot;: true,</span><br><span class="line">    &quot;Localmaster&quot;: true,</span><br><span class="line">    &quot;guest&quot;: &quot;nobody&quot;,</span><br><span class="line">    &quot;filemask&quot;&#x27;: &quot;&quot;,</span><br><span class="line">    &quot;dirmask&quot;&#x27;: &quot;&quot;,</span><br><span class="line">    &quot;smb_options&quot;: &quot;&quot;,</span><br><span class="line">    &quot;bindip&quot;: [],</span><br><span class="line">    &quot;cifs_SID&quot;: &quot;S-1-5-21-2487580926-3122677641-100607549&quot;,</span><br><span class="line">    &quot;ntImv1_auth&quot;: false,</span><br><span class="line">    &quot;enable_smb1&quot;: false,</span><br><span class="line">    &quot;admin_group&quot;: null,</span><br><span class="line">    &quot;next_rid&quot;: 0,</span><br><span class="line">    &quot;multichannel&quot;: true,</span><br><span class="line">    &quot;netbiosname_local&quot;: &quot;TRUENAS&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>then can modify SMB configuration successfully.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>Help with SMB IP binding, <em><a target="_blank" rel="noopener" href="https://www.reddit.com/r/freenas/comments/fovpfz/help_with_smb_ip_binding">https://www.reddit.com/r/freenas/comments/fovpfz/help_with_smb_ip_binding</a></em></li>
</ul>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Running-MacOS-on-Proxmox" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/09/08/Running-MacOS-on-Proxmox/">Running MacOS on Proxmox</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-09-08T01:34:16.000Z" itemprop="datePublished">2024-09-08</time>
</span>
      
      
      
<a href="/blog/2024/09/08/Running-MacOS-on-Proxmox/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Following the instructions to run the latest MacOS, <em>Sonoma 14.6.1</em>, on Proxmox - <a target="_blank" rel="noopener" href="https://klabsdev.com/definitive-guide-to-running-macos-in-proxmox">The Definitive Guide to Running MacOS in Proxmox</a>.</p>
<p><img src="/blog/img/Proxmox%20-%20MacOS.png" alt="Proxmox - MacOS" title="Proxmox - MacOS"></p>
<p>A few more put on notes:</p>
<ul>
<li>You can login with <code>Apple ID</code></li>
<li>Modify <code>config.plist</code> file under EFI folder -&gt; OC folder, change the default Screen Resolution from <code>1080P</code> <strong>1920x1080@32</strong> to <code>2K</code> <strong>2560x1440@32</strong>. Look more information in <code>Configuration.pdf</code> file in <a target="_blank" rel="noopener" href="https://github.com/thenickdude/KVM-Opencore/releases"><strong>KVM-Opencore</strong> release</a></li>
</ul>
<p>Connect with <strong>Apple Remote Desktop</strong>, so can use exact same Apple Keyboard mapping:</p>
<p><img src="/blog/img/Proxmox%20-%20Apple%20Remote%20Desktop.png" alt="Proxmox - Apple Remote Desktop" title="Proxmox - Apple Remote Desktop"></p>
<p>Current <a target="_blank" rel="noopener" href="https://github.com/thenickdude/KVM-Opencore"><strong>KVM-Opencore</strong></a> hasn’t setup support for Audio device and GPU accelerator.</p>
<p>Also try to setup <a target="_blank" rel="noopener" href="https://parsec.app/"><strong>Parsec</strong></a> in MacOS on Proxmox, without success.</p>
<p><img src="/blog/img/Proxmox%20-%20Parsec.png" alt="Proxmox - Parsec" title="Proxmox - Parsec"></p>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Setup-MikroTik-CRS504-4XQ-IN-and-run-a-speed-test" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/09/02/Setup-MikroTik-CRS504-4XQ-IN-and-run-a-speed-test/">Setup MikroTik CRS504-4XQ-IN and run a speed test</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-09-02T04:17:37.000Z" itemprop="datePublished">2024-09-02</time>
</span>
      
      
      
<a href="/blog/2024/09/02/Setup-MikroTik-CRS504-4XQ-IN-and-run-a-speed-test/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><code>MikroTik CRS504-4XQ-IN</code>, the Cloud Switch can handle FOUR QSFP28 100Gbps ports, equal to 16 x 25Gbps bandwidth.</p>
<p><img src="/blog/img/MikroTik%20-%20Interfaces.png" alt="MikroTik - Interfaces" title="MikroTik - Interfaces"></p>
<p>Setup single link mode, only the first QSFP28 sub-interface needs to be configured, while the remaining three sub-interfaces should remain enabled. For example, connect <code>Mellanox MCX455A-ECAT ConnectX-4 InfiniBand/Ethernet adapter card (EDR IB 100Gbps and 100GbE, single-port QSFP28, PCIe 3.0x16)</code> using <code>ONTi DAC QSFP28 100Gbps</code> cable to the switch.</p>
<p>Change <strong>FEC Mode</strong> to <code>fec91</code>.</p>
<p><em>Ethernet Forward Error Correction (FEC) is a technique used to improve the reliability of data transmission over Ethernet networks by detecting and correcting errors in data packets. The two most common types of FEC used in Ethernet networks are CL74 and CL91.</em></p>
<p><em>CL74 and CL91 refer to two different types of FEC codes, each with its own characteristics and performance. Here’s a brief comparison between the two:</em></p>
<p><em>Code Rate:</em></p>
<p><em>CL91 has a higher code rate of 91.6%, which means that only 8.4% of the data transmitted is used for error correction.</em></p>
<p>In addition, setup the swith port connected to <code>ONTi QSFP28 40Gbps TO 4SFP+</code> breakout cable:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -l admin MikroTik.local</span><br><span class="line"></span><br><span class="line">[admin@MikroTik] &gt; /interface ethernet set qsfp28-1-1 auto-negotiation=no speed=10G-baseCR</span><br><span class="line">[admin@MikroTik] &gt; /interface ethernet set qsfp28-1-2 auto-negotiation=no speed=10G-baseCR</span><br><span class="line">[admin@MikroTik] &gt; /interface ethernet set qsfp28-1-3 auto-negotiation=no speed=10G-baseCR</span><br><span class="line">[admin@MikroTik] &gt; /interface ethernet set qsfp28-1-4 auto-negotiation=no speed=10G-baseCR</span><br></pre></td></tr></table></figure>

<h2 id="Speed-test"><a href="#Speed-test" class="headerlink" title="Speed test"></a>Speed test</h2><p>In <code>iperf3</code> server, run listens to 4 ports to manage connections in parallel:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ iperf3 -s -p 5201 &amp; iperf3 -s -p 5202 &amp; iperf3 -s -p 5203 &amp; iperf3 -s -p 5204 &amp;</span><br></pre></td></tr></table></figure>

<p>In a MacBook Pro with WiFi-6 connection, run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ iperf3 -c MikroTik.local -p 5201 -P 4 -t 1000</span><br></pre></td></tr></table></figure>

<p>In a Mac Studio with 10Gbps Ethernet connection, run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ iperf3 -c MikroTik.local -p 5202 -P 8 -t 1000 -B 192.168.0.104</span><br></pre></td></tr></table></figure>

<p>In a Windows 11 PC with 100Gbps Ethernet connection, run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ iperf3 -c MikroTik.local -p 5203 -P 2 -t 1000</span><br></pre></td></tr></table></figure>

<p>Check the speed on switch console:</p>
<p><img src="/blog/img/MikroTik%20-%20Speed.png" alt="MikroTik - Speed" title="MikroTik - Speed"></p>
<p>and in graph:</p>
<p><img src="/blog/img/MikroTik%20-%20Performance.png" alt="MikroTik - Performance" title="MikroTik - Performance"></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li>MikroTik wired interface compatibility, <em><a target="_blank" rel="noopener" href="https://help.mikrotik.com/docs/display/ROS/MikroTik+wired+interface+compatibility">https://help.mikrotik.com/docs/display/ROS/MikroTik+wired+interface+compatibility</a></em></li>
<li>MikroTik RouterOS, <em><a target="_blank" rel="noopener" href="https://help.mikrotik.com/docs/display/ROS/RouterOS">https://help.mikrotik.com/docs/display/ROS/RouterOS</a></em></li>
<li>MikroTik CRS504-4XQ-IN Quick Guide, <em><a target="_blank" rel="noopener" href="https://help.mikrotik.com/docs/display/QG/Quick+Guide+-+CRS504-4XQ-IN">https://help.mikrotik.com/docs/display/QG/Quick+Guide+-+CRS504-4XQ-IN</a></em></li>
<li>FEC (Forward Error Correction), <em><a target="_blank" rel="noopener" href="https://www.reddit.com/r/fortinet/comments/127z3wd/fec_forward_error_correction/">https://www.reddit.com/r/fortinet/comments/127z3wd/fec_forward_error_correction/</a></em></li>
</ul>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Setup-network-bond-in-Synology-NAS" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/08/11/Setup-network-bond-in-Synology-NAS/">Setup network bond in Synology NAS</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2024-08-11T05:45:25.000Z" itemprop="datePublished">2024-08-11</time>
</span>
      
      
      
<a href="/blog/2024/08/11/Setup-network-bond-in-Synology-NAS/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Synology NAS DS920+ with two build-in 1Gbps ethernet adapters, and two 2.5Gbps USB 3.0 Ethernet Adapters. Now setup network bond &#x2F; link aggregation on them.</p>
<ul>
<li>Enable Network Link Aggregation Mode</li>
</ul>
<p><img src="/blog/img/Synology%20-%20Network%20Link%20Aggregation.png" alt="Synology - Network Link Aggregation Mode" title="Synology - Network Link Aggregation Mode"></p>
<ul>
<li>Pickup network devices into bond</li>
</ul>
<p><img src="/blog/img/Synology%20-%20Physical%20devices.png" alt="Synology - Physical devices" title="Synology - Physical devices"></p>
<ul>
<li>Setup network</li>
</ul>
<p><img src="/blog/img/Synology%20-%20Physical%20devices%20network%20setup.png" alt="Synology - Physical devices network setup" title="Synology - Physical devices network setup"></p>
<ul>
<li>Accept network interface change after network bond</li>
</ul>
<p><img src="/blog/img/Synology%20-%20Bond%20warning%20message.png" alt="Synology - Bond warning message" title="Synology - Bond warning message"></p>
<ul>
<li>Network bonded</li>
</ul>
<p><img src="/blog/img/Synology%20-%20Network%20bonded.png" alt="Synology - Network bonded" title="Synology - Network bonded"></p>
<ul>
<li>Network bond service order</li>
</ul>
<p><img src="/blog/img/Synology%20-%20Network%20bonded.png" alt="Synology - Network bond service order" title="Synology - Network bond service order"></p>

        
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          


        </div>
      
      
      
    </footer>
  </div>
</article>



    <nav id="page-nav">

<span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><a class="page-number" href="/blog/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/11/">11</a><a class="extend next" rel="next" href="/blog/page/2/">Next</a>
</nav>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-posts"></i> Recent</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2024/09/27/Proxmox-VE-Helper-Scripts/">Proxmox VE Helper Scripts</a>
          </li>
        
          <li>
            <a href="/blog/2024/09/19/Running-a-Mac-app-from-Unidentified-Developer-on-MacOS-Sequoia/">Running a Mac app from Unidentified Developer on MacOS Sequoia</a>
          </li>
        
          <li>
            <a href="/blog/2024/09/17/Configure-and-setup-Mellanox-network-adapter/">Configure and setup Mellanox network adapter</a>
          </li>
        
          <li>
            <a href="/blog/2024/09/15/Create-Storage-Pool-in-Windows-Server-2022/">Create Storage Pool in Windows Server 2022</a>
          </li>
        
          <li>
            <a href="/blog/2024/09/15/Fix-network-object-name-already-existed-issue-in-Windows/">Fix network object name already existed issue in Windows</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-archive"></i> Archive</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2024/">2024</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/">2023</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/">2022</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/">2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/">2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/">2019</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/">2018</a><span class="archive-list-count">31</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/">2017</a><span class="archive-list-count">25</span></li></ul>
    </div>
  </div>


  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-link"></i> Blogroll</h3>
    <div class="widget">
      <ul>
      
        <li>
          <a target="_blank" rel="noopener" href="https://www.linkedin.com/in/terrencemiao/">LinkedIn</a>
        </li>
      
        <li>
          <a target="_blank" rel="noopener" href="https://github.com/TerrenceMiao">GitHub</a>
        </li>
      
        <li>
          <a target="_blank" rel="noopener" href="https://twitter.com/TerrenceMiao">Twitter</a>
        </li>
      
      </ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <a id="totop" href="#top"></a>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <p>
        <a href="/blog/sitemap.xml">Site Map</a>
        <span> | </span><a href="/blog/atom.xml">Subscribe to this site</a>
        <span> | </span><a href="/blog/about/">Contact the blogger</a>
      </p>
      
        <p>
          <i class="fa fa-visitors"></i>
          <i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>
          ，
          <i class="fa fa-views"></i>
          <i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>
        </p>
      
      <p>
        <span>Copyright &copy; 2024 Terrence Miao.</span>
        <span>Theme by <a href="https://github.com/chaooo/hexo-theme-BlueLake/" target="_blank">BlueLake.</a></span>
        <span>Powered by <a href="https://hexo.io/" target="_blank">Hexo.</a></span>
      </p>
    </div>
  </div>
</footer>

    </div>
  </div>
  
<script src="/blog/js/jquery-3.4.1.min.js"></script>


<script src="/blog/js/search.json.js"></script>


  
<script src="/blog/fancybox/jquery.fancybox.min.js"></script>




<script src="/blog/js/script.js"></script>






  
<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>








  



  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>
  <script src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML" async type="text/javascript"></script>

</body>
</html>